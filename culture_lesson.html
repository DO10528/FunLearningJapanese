<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>合戦 - 戦国・日本語伝</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<link href="https://fonts.googleapis.com/css2?family=Yuji+Syuku&family=Zen+Maru+Gothic:wght@700&display=swap" rel="stylesheet">
<style>
    body {
        font-family: 'Zen Maru Gothic', sans-serif;
        background-color: #333;
        background-image: linear-gradient(rgba(0,0,0,0.6), rgba(0,0,0,0.6)), url('https://www.transparenttextures.com/patterns/shattered-island.png');
        color: white; margin: 0; padding: 0;
        height: 100vh; height: 100dvh;
        display: flex; flex-direction: column; align-items: center;
        overflow: hidden;
    }

    .battle-header {
        width: 100%; padding: 10px 15px; background: rgba(0,0,0,0.8);
        display: flex; justify-content: space-between; align-items: center;
        border-bottom: 2px solid #b71c1c; box-sizing: border-box;
    }
    .level-badge {
        font-family: 'Yuji Syuku', serif; font-size: 1.2em; color: #ffd700;
        text-shadow: 2px 2px 0 #b71c1c;
    }
    .retreat-btn {
        color: white; text-decoration: none; border: 1px solid #fff;
        padding: 5px 10px; border-radius: 5px; font-size: 0.9em;
    }

    .main-area {
        flex-grow: 1; width: 100%; max-width: 600px;
        display: flex; flex-direction: column; justify-content: center; align-items: center;
        padding: 20px; box-sizing: border-box; position: relative;
    }

    /* 学習（巻物） */
    .scroll-paper {
        background: #fdf5e6; color: #333;
        width: 100%; padding: 30px 20px;
        border-radius: 5px; box-shadow: 0 0 20px rgba(255, 215, 0, 0.3);
        text-align: center; border-top: 10px solid #5d4037; border-bottom: 10px solid #5d4037;
        box-sizing: border-box;
    }
    .card-img { font-size: 5em; color: #1a237e; margin-bottom: 10px; }
    .card-word { font-size: 2.5em; font-family: 'Yuji Syuku', serif; margin: 0; }
    .card-en { font-size: 1.2em; color: #666; margin-top: 5px; }
    
    /* クイズ */
    .quiz-title-overlay {
        position: absolute; top: 0; left: 0; width: 100%; height: 100%;
        display: flex; justify-content: center; align-items: center;
        background: rgba(0,0,0,0.7); z-index: 50;
        animation: fadeOut 2.5s forwards; pointer-events: none;
    }
    .quiz-title-text {
        font-family: 'Yuji Syuku', serif; font-size: 4em; color: #ffeb3b;
        text-shadow: 4px 4px 0 #b71c1c;
        animation: zoomIn 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
    }

    @keyframes zoomIn { from { transform: scale(0); opacity: 0; } to { transform: scale(1); opacity: 1; } }
    @keyframes fadeOut { 0%, 70% { opacity: 1; } 100% { opacity: 0; display: none; } }

    .quiz-grid { 
        display: grid; grid-template-columns: 1fr 1fr; gap: 15px; width: 100%; margin-top: 20px; 
    }
    .quiz-btn {
        background: #fff; border: 4px solid #5d4037;
        border-radius: 10px; padding: 10px;
        display: flex; flex-direction: column; align-items: center; justify-content: center;
        cursor: pointer; position: relative; color: #333;
        min-height: 100px; /* スマホで見やすく */
        transition: transform 0.1s;
    }
    .quiz-btn:active { transform: scale(0.95); background: #eee; }
    
    .quiz-btn.slashed { border-color: #2e7d32; background: #e8f5e9; }
    .quiz-btn.wrong { border-color: #b71c1c; background: #ffebee; }
    .quiz-btn i { font-size: 2.5em; margin-bottom: 10px; color: #1a237e; }
    .quiz-btn span { font-weight: bold; font-size: 1.2em; text-align: center; }

    .next-btn {
        margin-top: 30px; padding: 15px 50px;
        background: #b71c1c; color: #fff; font-family: 'Yuji Syuku', serif; font-size: 1.5em;
        border: 2px solid #ffd700; border-radius: 30px; cursor: pointer;
        box-shadow: 0 4px 10px rgba(0,0,0,0.3);
    }
    .next-btn:active { transform: translateY(2px); }

    /* 獲得モーダル */
    .loot-modal {
        position: fixed; top: 0; left: 0; width: 100%; height: 100%;
        background: rgba(0,0,0,0.95); z-index: 200;
        display: none; flex-direction: column; justify-content: center; align-items: center;
        color: white; text-align: center; padding: 20px; box-sizing: border-box;
    }
    .loot-item { font-size: 6em; margin: 20px 0; animation: popIn 0.5s; filter: drop-shadow(0 0 10px #ffd700); }
    .loot-name { font-size: 2em; font-family: 'Yuji Syuku', serif; color: #ffeb3b; margin-bottom: 10px; }
    @keyframes popIn { from{transform:scale(0)} to{transform:scale(1)} }

    .hidden { display: none !important; }
</style>
</head>
<body>

<div class="battle-header">
    <div class="level-badge" id="level-display">出陣</div>
    <a href="culture_map.html" class="retreat-btn">撤退</a>
</div>

<div class="main-area">
    <div id="learn-area" class="scroll-paper">
        <i id="learn-img" class="fa-solid fa-question card-img"></i>
        <h1 id="learn-jp" class="card-word">...</h1>
        <div id="learn-en" class="card-en">...</div>
        <button class="next-btn" style="margin-top:20px; width:60px; height:60px; padding:0; border-radius:50%;" onclick="playAudio()">
            <i class="fa-solid fa-volume-high"></i>
        </button>
    </div>

    <div id="quiz-area" class="hidden" style="width:100%;">
        <div class="quiz-title-overlay" id="quiz-overlay">
            <div class="quiz-title-text">いざ、勝負！</div>
        </div>

        <div style="text-align:center; margin-bottom:20px;">
             <button onclick="playQuizAudio()" style="background:#ffca28; border:none; padding:10px 20px; border-radius:20px; font-weight:bold; cursor:pointer; font-size:1.1em; color:#333;">
                <i class="fa-solid fa-volume-high"></i> 音をきく
            </button>
        </div>
        <div class="quiz-grid" id="quiz-options"></div>
    </div>

    <button id="action-btn" class="next-btn" onclick="nextStep()">次へ</button>
</div>

<div class="loot-modal" id="loot-modal">
    <h1 style="color:#f44336; font-family:'Yuji Syuku', serif; font-size:3em; margin:0;">勝利!!</h1>
    <div id="item-view" class="hidden">
        <div class="loot-item" id="loot-icon"></div>
        <div class="loot-name" id="loot-name"></div>
        <p style="font-size:1.2em;">戦利品を獲得しました</p>
    </div>
    <button class="next-btn" onclick="goBackToMap()">凱旋する</button>
</div>

<script type="module" src="js/firebase-config.js"></script>

</body>
</html>