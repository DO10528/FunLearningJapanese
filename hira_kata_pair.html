<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>ã²ã‚‰ã‚«ã‚¿ã‚ã‚ã› - FunLearnJP</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<link href="https://fonts.googleapis.com/css2?family=Zen+Maru+Gothic:wght@500;700;900&family=Klee+One:wght@600&display=swap" rel="stylesheet">

<style>
    /* --- å…±é€šè¨­å®š (é’ãƒ»ç™½åŸºèª¿ã«ä¿®æ­£) --- */
    :root {
        --primary: #00bcd4; /* ã‚·ã‚¢ãƒ³ */
        --secondary: #0097a7; /* æ¿ƒã„ã‚·ã‚¢ãƒ³ (å½±ã‚„æ ç·šç”¨) */
        --accent: #ff4081; /* ãƒ”ãƒ³ã‚¯ (ã‚¢ã‚¯ã‚»ãƒ³ãƒˆ) */
        --bg-color: #e0f7fa; /* è–„ã„æ°´è‰²èƒŒæ™¯ */
        --text-color: #333; /* æ¿ƒã„ã‚°ãƒ¬ãƒ¼ãƒ†ã‚­ã‚¹ãƒˆ */
        --shadow: 0 4px 8px rgba(0,0,0,0.1); /* ã‚·ãƒ³ãƒ—ãƒ«ã§æŸ”ã‚‰ã‹ã„å½± */
    }

    *, *::before, *::after { box-sizing: border-box; }

    body {
        font-family: 'Zen Maru Gothic', sans-serif;
        background-color: var(--bg-color);
        /* èƒŒæ™¯ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’å‰Šé™¤ */
        color: var(--text-color);
        margin: 0; padding: 0;
        min-height: 100vh;
        display: flex; flex-direction: column;
        overflow-x: hidden;
        user-select: none;
        touch-action: manipulation;
    }

    /* ãƒ˜ãƒƒãƒ€ãƒ¼ (é’åŸºèª¿) */
    header {
        background: #FFF;
        border-bottom: 3px solid var(--primary);
        padding: 10px 20px;
        display: flex; justify-content: space-between; align-items: center;
        box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        z-index: 100;
    }
    .logo { font-size: 1.4em; font-weight: 900; color: var(--primary); text-decoration: none; display: flex; gap: 8px; align-items: center; }
    .level-badge { 
        background: var(--primary); color: #FFF; 
        padding: 5px 15px; border-radius: 20px; font-weight: bold;
        box-shadow: none; border: none;
    }

    /* ãƒ¡ã‚¤ãƒ³ã‚¨ãƒªã‚¢ */
    .game-container {
        flex-grow: 1;
        display: flex; flex-direction: column; align-items: center;
        padding: 15px;
        width: 100%; max-width: 800px; margin: 0 auto;
    }

    /* ã‚¿ã‚¤ãƒˆãƒ« (ã‚·ãƒ³ãƒ—ãƒ«ã«) */
    .game-title {
        font-size: 1.8em; font-weight: 900; color: var(--text-color);
        text-align: center; margin-bottom: 20px;
        text-shadow: none;
    }

    /* --- ã‚²ãƒ¼ãƒ ç›¤é¢ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ --- */
    .board {
        display: flex;
        justify-content: center;
        width: 100%;
        gap: 15px;
        margin-bottom: 20px;
        align-items: stretch;
    }

    /* å·¦å³ã®ãƒ—ãƒ¼ãƒ« (é‡ãªã‚Šä¿®æ­£ã¨ãƒ‡ã‚¶ã‚¤ãƒ³å¤‰æ›´) */
    .pool-column {
        display: flex; flex-direction: column;
        width: 95px; /* å°‘ã—å¹…åºƒã« */
        align-items: center;
        background: #FFF;
        border: 2px solid var(--primary); /* é’æ  */
        border-radius: 15px;
        padding: 0; /* ãƒ˜ãƒƒãƒ€ãƒ¼ã‚’å†…åŒ…ã™ã‚‹ãŸã‚ãƒ‘ãƒ‡ã‚£ãƒ³ã‚°ã‚’ã‚¼ãƒ­ã« */
        min-height: 350px;
        box-shadow: var(--shadow);
        overflow: hidden; /* è§’ä¸¸ã‹ã‚‰ã¯ã¿å‡ºã•ãªã„ã‚ˆã†ã« */
    }
    /* ãƒ—ãƒ¼ãƒ«ãƒ˜ãƒƒãƒ€ãƒ¼ (é…ç½®ä¿®æ­£ï¼šçµ¶å¯¾é…ç½®ã‚’ã‚„ã‚ã‚‹) */
    .pool-header {
        background: var(--primary); /* é’èƒŒæ™¯ */
        color: #FFF;
        font-weight: 900;
        padding: 8px 0;
        text-align: center;
        width: 100%;
        /* position: absolute; ã‚’å‰Šé™¤ã—ã¦é€šå¸¸ã®é…ç½®ã« */
        box-shadow: none;
        border-radius: 0;
    }
    /* ãƒ—ãƒ¼ãƒ«ã‚¨ãƒªã‚¢ (ä½™ç™½èª¿æ•´) */
    .pool-area { 
        margin-top: 0; 
        padding: 15px 10px; /* å†…éƒ¨ã«ãƒ‘ãƒ‡ã‚£ãƒ³ã‚°ã‚’è¿½åŠ  */
        width: 100%; display: flex; flex-direction: column; gap: 10px; align-items: center; flex-grow: 1;
    }

    /* ä¸­å¤®ã®ãƒšã‚¢ãƒªãƒ³ã‚°ã‚¨ãƒªã‚¢ */
    .center-area {
        flex-grow: 1;
        max-width: 280px;
        display: flex; flex-direction: column;
        gap: 12px;
        padding: 10px;
        background: rgba(255,255,255,0.5);
        border-radius: 20px;
        border: 2px dashed var(--primary); /* é’ç ´ç·š */
    }

    /* ãƒšã‚¢ã‚’ä½œã‚‹è¡Œ */
    .pair-row {
        display: flex;
        justify-content: center; align-items: center;
        background: #FFF;
        border-radius: 12px;
        padding: 5px;
        border: 2px solid var(--secondary); /* æ¿ƒã„é’æ  */
        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        gap: 10px;
        height: 70px;
    }

    .pair-divider {
        color: var(--secondary); font-size: 1.5em; font-weight: bold;
        text-shadow: none;
    }

    /* --- ã‚¢ã‚¤ãƒ†ãƒ ã¨ã‚¹ãƒ­ãƒƒãƒˆ --- */
    .slot {
        width: 55px; height: 55px;
        background: #F5F5F5;
        border: 2px dashed #CCC;
        border-radius: 10px;
        display: flex; justify-content: center; align-items: center;
        transition: all 0.2s;
    }
    .slot.drag-over { background: #b2ebf2; border-color: var(--primary); border-style: solid; transform: scale(1.05); }
    
    .pool-slot { border: none; background: transparent; }

    /* ãƒ‰ãƒ©ãƒƒã‚°ã™ã‚‹æ–‡å­—ãƒãƒƒãƒ— (å…ƒã®é…è‰²ã«æˆ»ã™) */
    .char-chip {
        width: 55px; height: 55px;
        background: #FFF;
        border-radius: 10px;
        border: 2px solid; 
        box-shadow: 0 3px 6px rgba(0,0,0,0.15); /* ã‚·ãƒ³ãƒ—ãƒ«ãªå½± */
        display: flex; justify-content: center; align-items: center;
        font-family: 'Klee One', cursive; 
        font-size: 2rem;
        font-weight: 600;
        cursor: grab;
        touch-action: none; z-index: 10;
        transition: transform 0.1s;
    }
    
    /* ã²ã‚‰ãŒãªï¼šèµ¤ç³» */
    .char-hira { color: #d81b60; border-color: #f8bbd0; } 
    /* ã‚«ã‚¿ã‚«ãƒŠï¼šé’ç³» */
    .char-kata { color: #1565c0; border-color: #bbdefb; } 

    .char-chip:active { transform: scale(1.1); cursor: grabbing; z-index: 100; box-shadow: 0 5px 10px rgba(0,0,0,0.2); }

    /* ãƒ‰ãƒ©ãƒƒã‚°ä¸­ã®ã‚´ãƒ¼ã‚¹ãƒˆ */
    .ghost {
        position: fixed; pointer-events: none; z-index: 1000;
        opacity: 0.8; transform: scale(1.1); box-shadow: 0 10px 20px rgba(0,0,0,0.2);
    }

    /* --- ãƒœã‚¿ãƒ³ã‚¨ãƒªã‚¢ (é’åŸºèª¿) --- */
    .controls {
        width: 100%; text-align: center; margin-top: auto; padding-bottom: 20px;
    }
    .check-btn {
        background-color: var(--primary); /* é’ */
        color: white;
        border: none;
        border-bottom: 4px solid var(--secondary); /* æ¿ƒã„é’å½± */
        padding: 12px 40px;
        border-radius: 50px;
        font-size: 1.6em;
        font-weight: 900;
        font-family: 'Zen Maru Gothic', sans-serif;
        box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        cursor: pointer;
        transition: all 0.1s;
        text-shadow: none;
    }
    .check-btn:active { transform: translateY(3px); border-bottom-width: 1px; box-shadow: 0 2px 4px rgba(0,0,0,0.2); }

    /* ãƒ¢ãƒ¼ãƒ€ãƒ« (é’åŸºèª¿) */
    .modal-overlay {
        position: fixed; top: 0; left: 0; width: 100%; height: 100%;
        background: rgba(0,0,0,0.6); backdrop-filter: blur(3px);
        display: none; justify-content: center; align-items: center; z-index: 2000;
    }
    .modal-content {
        background: #FFF; padding: 40px; border-radius: 25px;
        text-align: center; animation: popIn 0.3s;
        border: 3px solid var(--primary); /* é’æ  */
        box-shadow: var(--shadow);
    }
    .modal-content h2 { 
        color: var(--primary); /* é’æ–‡å­— */
        font-size: 2.2em; margin: 0 0 20px 0; font-weight: 900;
        text-shadow: none;
    }
    .next-btn {
        background: var(--primary); /* é’ */
        color: white; border: none; 
        border-bottom: 4px solid var(--secondary); /* æ¿ƒã„é’å½± */
        padding: 12px 35px;
        font-size: 1.3em; font-weight: bold; border-radius: 12px; cursor: pointer;
        font-family: 'Zen Maru Gothic', sans-serif;
        text-shadow: none;
        transition: all 0.1s;
    }
    .next-btn:active { transform: translateY(3px); border-bottom-width: 1px; }

    @keyframes popIn { 0% { transform: scale(0.8); opacity: 0; } 100% { transform: scale(1); opacity: 1; } }

    /* ã‚¹ãƒãƒ›å¾®èª¿æ•´ */
    @media (max-width: 500px) {
        .board { gap: 10px; }
        .pool-column { width: 85px; }
        .center-area { max-width: 230px; } 
        .slot, .char-chip { width: 50px; height: 50px; font-size: 1.6rem; border-width: 2px; }
        .pair-row { height: 60px; gap: 5px; border-width: 2px; }
        .check-btn { font-size: 1.4em; padding: 10px 30px; border-bottom-width: 3px; }
        .game-title { font-size: 1.5em; margin-bottom: 15px; }
    }
</style>
</head>
<body>

<header>
    <a href="index.html" class="logo"><i class="fa-solid fa-shapes"></i> FunLearnJP</a>
    <div class="level-badge" id="level-indicator">ãƒ¬ãƒ™ãƒ« 1</div>
</header>

<div class="game-container">
    
    <h1 class="game-title">ã²ã‚‰ãŒãª ã¨ ã‚«ã‚¿ã‚«ãƒŠ ã‚’ ã‚ã‚ã›ã‚ˆã†ï¼</h1>

    <div class="board">
        <div class="pool-column">
            <div class="pool-header">ã²ã‚‰ãŒãª</div>
            <div id="hira-pool" class="pool-area"></div>
        </div>

        <div class="center-area" id="pair-rows">
            </div>

        <div class="pool-column">
            <div class="pool-header">ã‚«ã‚¿ã‚«ãƒŠ</div>
            <div id="kata-pool" class="pool-area"></div>
        </div>
    </div>

    <div class="controls">
        <button class="check-btn" onclick="checkAnswer()">ã“ãŸãˆã‚ã‚ã›ï¼</button>
    </div>
</div>

<div id="success-modal" class="modal-overlay">
    <div class="modal-content">
        <h2>ã ã„ã›ã„ã‹ã„ï¼ğŸ‰</h2>
        <button class="next-btn" onclick="nextLevel()">ã¤ãã® ãƒ¬ãƒ™ãƒ«ã¸ Go!</button>
    </div>
</div>

<audio id="snd-correct" src="assets/sounds/seikai.mp3"></audio>
<audio id="snd-incorrect" src="assets/sounds/bubu.mp3"></audio>

<script>
    // --- ãƒ‡ãƒ¼ã‚¿å®šç¾© (å…¨10ãƒ¬ãƒ™ãƒ« - å¤‰æ›´ãªã—) ---
    const levels = [
        { id: 1, chars: [ {h:'ã‚',k:'ã‚¢'}, {h:'ã„',k:'ã‚¤'}, {h:'ã†',k:'ã‚¦'}, {h:'ãˆ',k:'ã‚¨'}, {h:'ãŠ',k:'ã‚ª'} ] },
        { id: 2, chars: [ {h:'ã‹',k:'ã‚«'}, {h:'ã',k:'ã‚­'}, {h:'ã',k:'ã‚¯'}, {h:'ã‘',k:'ã‚±'}, {h:'ã“',k:'ã‚³'} ] },
        { id: 3, chars: [ {h:'ã•',k:'ã‚µ'}, {h:'ã—',k:'ã‚·'}, {h:'ã™',k:'ã‚¹'}, {h:'ã›',k:'ã‚»'}, {h:'ã',k:'ã‚½'} ] },
        { id: 4, chars: [ {h:'ãŸ',k:'ã‚¿'}, {h:'ã¡',k:'ãƒ'}, {h:'ã¤',k:'ãƒ„'}, {h:'ã¦',k:'ãƒ†'}, {h:'ã¨',k:'ãƒˆ'} ] },
        { id: 5, chars: [ {h:'ãª',k:'ãƒŠ'}, {h:'ã«',k:'ãƒ‹'}, {h:'ã¬',k:'ãƒŒ'}, {h:'ã­',k:'ãƒ'}, {h:'ã®',k:'ãƒ'} ] },
        { id: 6, chars: [ {h:'ã¯',k:'ãƒ'}, {h:'ã²',k:'ãƒ’'}, {h:'ãµ',k:'ãƒ•'}, {h:'ã¸',k:'ãƒ˜'}, {h:'ã»',k:'ãƒ›'} ] },
        { id: 7, chars: [ {h:'ã¾',k:'ãƒ'}, {h:'ã¿',k:'ãƒŸ'}, {h:'ã‚€',k:'ãƒ '}, {h:'ã‚',k:'ãƒ¡'}, {h:'ã‚‚',k:'ãƒ¢'} ] },
        { id: 8, chars: [ {h:'ã‚„',k:'ãƒ¤'}, {h:'ã‚†',k:'ãƒ¦'}, {h:'ã‚ˆ',k:'ãƒ¨'} ] }, 
        { id: 9, chars: [ {h:'ã‚‰',k:'ãƒ©'}, {h:'ã‚Š',k:'ãƒª'}, {h:'ã‚‹',k:'ãƒ«'}, {h:'ã‚Œ',k:'ãƒ¬'}, {h:'ã‚',k:'ãƒ­'} ] },
        { id: 10, chars: [ {h:'ã‚',k:'ãƒ¯'}, {h:'ã‚’',k:'ãƒ²'}, {h:'ã‚“',k:'ãƒ³'} ] } 
    ];

    let currentLevelIndex = 0;
    const hiraPool = document.getElementById('hira-pool');
    const kataPool = document.getElementById('kata-pool');
    const pairArea = document.getElementById('pair-rows');
    const levelIndicator = document.getElementById('level-indicator');
    const modal = document.getElementById('success-modal');
    
    const sndCorrect = document.getElementById('snd-correct');
    const sndIncorrect = document.getElementById('snd-incorrect');

    // --- åˆæœŸåŒ– ---
    function initGame() {
        loadLevel(currentLevelIndex);
    }

    function loadLevel(idx) {
        // ãƒªã‚»ãƒƒãƒˆ
        hiraPool.innerHTML = '';
        kataPool.innerHTML = '';
        pairArea.innerHTML = '';
        modal.style.display = 'none';
        
        if (idx >= levels.length) {
            alert("å…¨ãƒ¬ãƒ™ãƒ«ã‚¯ãƒªã‚¢ï¼ãŠã‚ã§ã¨ã†ï¼");
            currentLevelIndex = 0;
            loadLevel(0);
            return;
        }

        const levelData = levels[idx];
        levelIndicator.textContent = `ãƒ¬ãƒ™ãƒ« ${levelData.id}`;

        // ä¸­å¤®ã®è¡Œã‚’ä½œæˆ
        levelData.chars.forEach((_, i) => {
            const row = document.createElement('div');
            row.className = 'pair-row';
            const hSlot = createSlot('hira-slot');
            const div = document.createElement('div');
            div.className = 'pair-divider';
            div.textContent = '=';
            const kSlot = createSlot('kata-slot');
            
            row.appendChild(hSlot);
            row.appendChild(div);
            row.appendChild(kSlot);
            pairArea.appendChild(row);
        });

        // ãƒãƒƒãƒ—ä½œæˆ (ã‚·ãƒ£ãƒƒãƒ•ãƒ«)
        const hiraChips = [...levelData.chars].sort(() => Math.random() - 0.5);
        const kataChips = [...levelData.chars].sort(() => Math.random() - 0.5);

        // ãƒ—ãƒ¼ãƒ«ã«é…ç½®
        hiraChips.forEach(c => createChip(c.h, 'hira', c.k, hiraPool));
        kataChips.forEach(c => createChip(c.k, 'kata', c.h, kataPool));
    }

    function createSlot(type) {
        const slot = document.createElement('div');
        slot.className = `slot ${type}`;
        return slot;
    }

    function createChip(text, type, pairValue, container) {
        const chip = document.createElement('div');
        chip.className = `char-chip char-${type}`;
        chip.textContent = text;
        chip.dataset.value = text;
        chip.dataset.pair = pairValue;
        chip.dataset.type = type;

        // ãƒ—ãƒ¼ãƒ«å†…ã®ã‚¹ãƒ­ãƒƒãƒˆã«å…¥ã‚Œã¦é…ç½®
        const poolSlot = createSlot('pool-slot');
        poolSlot.appendChild(chip);
        container.appendChild(poolSlot);

        // ãƒ‰ãƒ©ãƒƒã‚°ã‚¤ãƒ™ãƒ³ãƒˆè¨­å®š
        setupDrag(chip);
    }

    // --- ãƒ‰ãƒ©ãƒƒã‚°ï¼†ãƒ‰ãƒ­ãƒƒãƒ—åˆ¶å¾¡ (å¤‰æ›´ãªã—) ---
    let draggedItem = null;
    let touchOffsetX = 0;
    let touchOffsetY = 0;
    let ghost = null;
    let originSlot = null;

    function setupDrag(el) {
        el.addEventListener('mousedown', startDrag);
        el.addEventListener('touchstart', startDrag, {passive: false});
    }

    function startDrag(e) {
        e.preventDefault();
        draggedItem = e.target;
        originSlot = draggedItem.parentElement;

        const clientX = e.touches ? e.touches[0].clientX : e.clientX;
        const clientY = e.touches ? e.touches[0].clientY : e.clientY;
        const rect = draggedItem.getBoundingClientRect();
        touchOffsetX = clientX - rect.left;
        touchOffsetY = clientY - rect.top;

        ghost = draggedItem.cloneNode(true);
        ghost.className += ' ghost';
        ghost.style.width = rect.width + 'px';
        ghost.style.height = rect.height + 'px';
        document.body.appendChild(ghost);
        moveGhost(clientX, clientY);

        draggedItem.style.opacity = '0.3';

        document.addEventListener('mousemove', onMove);
        document.addEventListener('mouseup', onEnd);
        document.addEventListener('touchmove', onMove, {passive: false});
        document.addEventListener('touchend', onEnd);
    }

    function onMove(e) {
        e.preventDefault();
        const clientX = e.touches ? e.touches[0].clientX : e.clientX;
        const clientY = e.touches ? e.touches[0].clientY : e.clientY;
        moveGhost(clientX, clientY);

        const target = getTargetSlot(clientX, clientY);
        document.querySelectorAll('.slot').forEach(s => s.classList.remove('drag-over'));
        if (target && isValidDrop(target, draggedItem)) {
            target.classList.add('drag-over');
        }
    }

    function moveGhost(x, y) {
        if(ghost) {
            ghost.style.left = (x - touchOffsetX) + 'px';
            ghost.style.top = (y - touchOffsetY) + 'px';
        }
    }

    function onEnd(e) {
        document.removeEventListener('mousemove', onMove);
        document.removeEventListener('mouseup', onEnd);
        document.removeEventListener('touchmove', onMove);
        document.removeEventListener('touchend', onEnd);
        
        if(ghost) ghost.remove();
        ghost = null;
        
        draggedItem.style.opacity = '1';

        const clientX = e.changedTouches ? e.changedTouches[0].clientX : e.clientX;
        const clientY = e.changedTouches ? e.changedTouches[0].clientY : e.clientY;
        const target = getTargetSlot(clientX, clientY);

        document.querySelectorAll('.slot').forEach(s => s.classList.remove('drag-over'));

        if (target && isValidDrop(target, draggedItem)) {
            if (target.children.length > 0) {
                const existing = target.children[0];
                originSlot.appendChild(existing);
            }
            target.appendChild(draggedItem);
            playClickSound();
        }
        draggedItem = null;
    }

    function getTargetSlot(x, y) {
        const el = document.elementFromPoint(x, y);
        if (!el) return null;
        return el.closest('.slot');
    }

    function isValidDrop(slot, item) {
        if (slot.classList.contains('pool-slot')) return true;
        if (slot.classList.contains('hira-slot') && item.dataset.type === 'hira') return true;
        if (slot.classList.contains('kata-slot') && item.dataset.type === 'kata') return true;
        return false;
    }

    function playClickSound() {
        // ä»»æ„ã§ã‚¯ãƒªãƒƒã‚¯éŸ³ã‚’è¿½åŠ å¯èƒ½
    }

    // --- åˆ¤å®šãƒ­ã‚¸ãƒƒã‚¯ (å¤‰æ›´ãªã—) ---
    window.checkAnswer = () => {
        const rows = document.querySelectorAll('.pair-row');
        let allCorrect = true;
        let isFull = true;

        rows.forEach(row => {
            const hSlot = row.querySelector('.hira-slot');
            const kSlot = row.querySelector('.kata-slot');
            if (hSlot.children.length === 0 || kSlot.children.length === 0) {
                isFull = false;
            }
        });

        if (!isFull) {
            sndIncorrect.currentTime = 0;
            sndIncorrect.play();
            return; 
        }

        rows.forEach(row => {
            const hItem = row.querySelector('.hira-slot').children[0];
            const kItem = row.querySelector('.kata-slot').children[0];
            if (hItem.dataset.pair !== kItem.dataset.value) {
                allCorrect = false;
            }
        });

        if (allCorrect) {
            sndCorrect.currentTime = 0;
            sndCorrect.play();
            modal.style.display = 'flex'; 
        } else {
            sndIncorrect.currentTime = 0;
            sndIncorrect.play();
        }
    };

    window.nextLevel = () => {
        currentLevelIndex++;
        loadLevel(currentLevelIndex);
    };

    // é–‹å§‹
    window.onload = initGame;

</script>

</body>
</html>