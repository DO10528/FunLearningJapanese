<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>看板サバイバル - Sign Reader</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<link href="https://fonts.googleapis.com/css2?family=Zen+Maru+Gothic:wght@400;700;900&display=swap" rel="stylesheet">

<style>
    /* --- 共通設定 --- */
    :root {
        --primary: #5c7aff;
        --accent: #ffcc5c;
        --bg-color: #f4f7fc;
        --text-color: #333;
        --danger-color: #ef5350;
        --timer-color: #ff9800;
    }

    *, *::before, *::after { box-sizing: border-box; }

    body {
        font-family: 'Zen Maru Gothic', sans-serif;
        background-color: var(--bg-color);
        color: var(--text-color);
        margin: 0; padding: 0; padding-bottom: 100px;
        min-height: 100vh;
        display: flex; flex-direction: column;
        -webkit-tap-highlight-color: transparent;
    }

    /* ヘッダー */
    header {
        background: linear-gradient(135deg, #5c7aff 0%, #4facfe 100%);
        color: white; padding: 15px 20px; width: 100%;
        display: flex; justify-content: space-between; align-items: center;
        box-shadow: 0 4px 15px rgba(92, 122, 255, 0.3);
        position: sticky; top: 0; z-index: 100;
    }
    .logo { font-size: 1.2em; font-weight: 900; display: flex; align-items: center; gap: 10px; text-decoration: none; color: white; }
    
    /* 画面コンテナ */
    .screen { display: none; padding: 20px; width: 100%; max-width: 600px; margin: 0 auto; animation: fadeIn 0.4s ease-out; }
    .screen.active { display: block; }
    @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

    /* 戻るボタン */
    .btn-back-nav {
        background: rgba(255,255,255,0.2); border: 1px solid rgba(255,255,255,0.5);
        color: white; padding: 5px 12px; border-radius: 20px; cursor: pointer; font-size: 0.9em; font-weight: bold;
    }

    /* --- 看板・標識デザイン (CSSで再現) --- */
    .sign-display-area {
        height: 220px; display: flex; justify-content: center; align-items: center;
        background: #e0e0e0; border-radius: 20px; margin-bottom: 20px;
        position: relative; overflow: hidden; border: 4px solid #fff; box-shadow: inset 0 0 20px rgba(0,0,0,0.1);
    }

    /* 1. 止まれ (逆三角形) */
    .sign-stop {
        width: 0; height: 0;
        border-left: 70px solid transparent;
        border-right: 70px solid transparent;
        border-top: 120px solid #d32f2f;
        position: relative; filter: drop-shadow(0 5px 5px rgba(0,0,0,0.3));
    }
    .sign-stop::after {
        content: "止まれ"; position: absolute; top: -110px; left: -50px;
        width: 100px; text-align: center; color: white; font-weight: 900; font-size: 1.8em;
    }
    
    /* 2. 非常口 (緑の長方形) */
    .sign-exit {
        width: 200px; height: 100px; background: #007934;
        display: flex; align-items: center; justify-content: space-between; padding: 10px;
        color: white; font-weight: bold; border-radius: 5px; box-shadow: 0 5px 10px rgba(0,0,0,0.2);
    }
    .sign-exit i { font-size: 3em; margin-right: 10px; }
    .sign-exit span { font-size: 1.5em; writing-mode: vertical-rl; }

    /* 3. トイレ (ピクトグラム) */
    .sign-toilet {
        background: white; padding: 10px 30px; border: 2px solid #333; border-radius: 10px;
        display: flex; gap: 20px; font-size: 4em; box-shadow: 0 5px 10px rgba(0,0,0,0.1);
    }
    
    /* 4. 立入禁止 (黄色と黒) */
    .sign-danger {
        background: repeating-linear-gradient(45deg, #fdd835, #fdd835 15px, #212121 15px, #212121 30px);
        padding: 15px; border: 4px solid #212121; width: 220px; text-align: center;
        box-shadow: 0 5px 10px rgba(0,0,0,0.3);
    }
    .sign-danger-inner {
        background: white; padding: 10px; font-weight: 900; font-size: 1.5em; color: #d32f2f; border: 2px solid #212121;
    }

    /* 5. 準備中/営業中 (木の看板風) */
    .sign-wood {
        background: #8d6e63; color: white; padding: 20px 10px; width: 120px; height: 180px;
        writing-mode: vertical-rl; font-size: 2em; font-weight: 900; border-radius: 10px;
        border: 4px solid #5d4037; box-shadow: 0 5px 15px rgba(0,0,0,0.3);
        display: flex; align-items: center; justify-content: center; font-family: "Zen Maru Gothic";
    }

    /* 6. その他汎用 */
    .sign-generic {
        background: white; border: 5px solid #d32f2f; color: #d32f2f;
        width: 150px; height: 150px; border-radius: 50%; display: flex;
        justify-content: center; align-items: center; font-size: 4em;
        position: relative; box-shadow: 0 5px 10px rgba(0,0,0,0.2);
    }
    .sign-generic.blue { border-color: #1976d2; color: #1976d2; }
    .sign-generic.square { border-radius: 10px; width: 200px; height: auto; padding: 20px; font-size: 2em; font-weight: 900; }

    /* --- 練習リスト --- */
    .practice-grid {
        display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px; margin-bottom: 20px;
    }
    .practice-item {
        background: white; border-radius: 10px; padding: 10px; text-align: center;
        box-shadow: 0 2px 5px rgba(0,0,0,0.05); display: flex; flex-direction: column; align-items: center; gap: 5px;
    }
    .practice-label { font-size: 1.1em; font-weight: bold; color: #333; margin-top: 5px; }
    
    /* --- ゲーム UI --- */
    .timer-container {
        width: 100%; height: 15px; background: #ddd; border-radius: 10px; overflow: hidden; margin-bottom: 20px;
    }
    .timer-bar {
        height: 100%; width: 100%; background: var(--timer-color); transition: width 0.1s linear;
    }
    .timer-bar.danger { background: var(--danger-color); }

    .choice-grid {
        display: grid; grid-template-columns: 1fr 1fr; gap: 15px;
    }
    .btn-choice {
        background: white; border: none; padding: 15px; border-radius: 15px;
        font-size: 1.1em; font-weight: 900; color: #444; /* 英語のみなので少し強調 */
        box-shadow: 0 5px 0 #ddd; cursor: pointer; transition: transform 0.1s;
        min-height: 80px; display: flex; justify-content: center; align-items: center;
        text-align: center; line-height: 1.2;
    }
    .btn-choice:active { transform: translateY(4px); box-shadow: 0 1px 0 #ddd; }

    /* --- レベル選択 --- */
    .level-list { display: flex; flex-direction: column; gap: 15px; }
    .level-card {
        background: white; border-radius: 15px; padding: 20px; display: flex; align-items: center; gap: 15px;
        box-shadow: 0 4px 10px rgba(0,0,0,0.05); cursor: pointer; transition: transform 0.1s;
        border-left: 6px solid #ccc;
    }
    .level-card:active { transform: scale(0.98); }
    .lvl-info h3 { margin: 0; font-size: 1.1em; }
    .lvl-info p { margin: 5px 0 0; font-size: 0.85em; color: #777; }

    /* 固定フッター */
    .fixed-footer {
        position: fixed; bottom: 0; left: 0; width: 100%;
        background: white; padding: 15px;
        box-shadow: 0 -4px 15px rgba(0,0,0,0.1); text-align: center; z-index: 200;
    }
    .btn-start {
        background: var(--primary); color: white; border: none;
        padding: 15px 40px; border-radius: 50px; font-weight: 900; font-size: 1.2em;
        width: 100%; max-width: 300px; cursor: pointer; box-shadow: 0 4px 0 #3949ab;
    }
    .btn-start:active { transform: translateY(3px); box-shadow: none; }

    /* 結果画面 */
    .result-score { font-size: 4em; color: var(--primary); font-weight: 900; margin: 10px 0; }
    .feedback-overlay {
        position: absolute; top: 0; left: 0; right: 0; bottom: 0;
        display: flex; justify-content: center; align-items: center;
        font-size: 8em; font-weight: 900; opacity: 0; pointer-events: none; z-index: 50;
    }
    @keyframes popFeedback { 0% { opacity: 0; transform: scale(0.5); } 50% { opacity: 1; transform: scale(1.2); } 100% { opacity: 0; transform: scale(1); } }

</style>
</head>
<body>

<header>
    <a href="index.html" class="logo"><i class="fa-solid fa-person-walking-luggage"></i> 看板サバイバル</a>
    <button class="btn-back-nav" onclick="goBack()"><i class="fa-solid fa-arrow-left"></i> もどる</button>
</header>

<div id="screen-practice" class="screen active">
    <div style="text-align:center; margin-bottom:20px;">
        <h2><i class="fa-solid fa-book-open"></i> 日本のサイン図鑑</h2>
        <p>形と色で覚えましょう！</p>
    </div>

    <div id="practice-container" class="practice-grid"></div>

    <div style="height:80px;"></div>
</div>

<div id="footer-start" class="fixed-footer">
    <button class="btn-start" onclick="showScreen('screen-level')">
        <i class="fa-solid fa-gamepad"></i> ゲームスタート
    </button>
</div>

<div id="screen-level" class="screen">
    <h2 style="text-align:center; margin-bottom:20px;">レベルを選んでね</h2>
    <div class="level-list">
        <div class="level-card" style="border-color:#4caf50;" onclick="startGame(1)">
            <div class="lvl-icon" style="color:#4caf50;"><i class="fa-solid fa-child-reaching"></i></div>
            <div class="lvl-info">
                <h3>Level 1: Survival</h3>
                <p>トイレ、非常口、立入禁止など。</p>
            </div>
        </div>
        <div class="level-card" style="border-color:#ff9800;" onclick="startGame(2)">
            <div class="lvl-icon" style="color:#ff9800;"><i class="fa-solid fa-shop"></i></div>
            <div class="lvl-info">
                <h3>Level 2: In Town</h3>
                <p>営業中、止まれ、押す/引くなど。</p>
            </div>
        </div>
        <div class="level-card" style="border-color:#2196f3;" onclick="startGame(3)">
            <div class="lvl-icon" style="color:#2196f3;"><i class="fa-solid fa-gavel"></i></div>
            <div class="lvl-info">
                <h3>Level 3: Rules</h3>
                <p>撮影禁止、土足厳禁、禁煙など。</p>
            </div>
        </div>
        <div class="level-card" style="border-color:#9c27b0;" onclick="startGame(4)">
            <div class="lvl-icon" style="color:#9c27b0;"><i class="fa-solid fa-torii-gate"></i></div>
            <div class="lvl-info">
                <h3>Level 4: Culture</h3>
                <p>温泉、交番、郵便局など。</p>
            </div>
        </div>
    </div>
</div>

<div id="screen-game" class="screen">
    <div style="display:flex; justify-content:space-between; margin-bottom:5px; font-weight:bold;">
        <span><i class="fa-regular fa-clock"></i> Time Limit</span>
        <span>Q <span id="q-current">1</span> / 10</span>
    </div>
    <div class="timer-container"><div id="timer-bar" class="timer-bar"></div></div>

    <div class="sign-display-area" id="sign-display">
        </div>

    <div class="choice-grid" id="choice-container"></div>

    <div id="feedback" class="feedback-overlay"></div>
</div>

<div id="screen-result" class="screen" style="text-align:center; padding-top:40px;">
    <h2>Result</h2>
    <div class="result-score"><span id="final-score">0</span><span style="font-size:0.5em;">/10</span></div>
    <p id="result-msg" style="font-size:1.2em; font-weight:bold; margin-bottom:30px;">...</p>
    
    <button class="btn-start" onclick="showScreen('screen-level')">Play Again</button>
    <br><br>
    <button class="btn-back-nav" style="background:#999; border:none; width:100%; max-width:300px; padding:15px;" onclick="showScreen('screen-practice')">
        Back to List
    </button>
</div>

<script>
    // --- データセット (英語削除版) ---
    const signsData = {
        1: [ // 初級
            { id: 'stop', html: '<div class="sign-stop"></div>', en: 'Stop' },
            { id: 'exit', html: '<div class="sign-exit"><i class="fa-solid fa-person-running"></i><span>非常口</span></div>', en: 'Emergency Exit' },
            { id: 'toilet_m', html: '<div class="sign-toilet"><i class="fa-solid fa-person" style="color:#1976d2"></i></div>', en: 'Men\'s Room' },
            { id: 'toilet_f', html: '<div class="sign-toilet"><i class="fa-solid fa-person-dress" style="color:#d32f2f"></i></div>', en: 'Women\'s Room' },
            { id: 'no_entry', html: '<div class="sign-danger"><div class="sign-danger-inner">立入禁止</div></div>', en: 'Do Not Enter' },
            { id: 'danger', html: '<div class="sign-generic"><i class="fa-solid fa-triangle-exclamation"></i></div>', en: 'Danger' },
            { id: 'no_smoking', html: '<div class="sign-generic"><i class="fa-solid fa-ban"></i><i class="fa-solid fa-smoking" style="position:absolute; font-size:0.5em; color:#333;"></i></div>', en: 'No Smoking' },
            { id: 'sos', html: '<div class="sign-generic blue square" style="color:white; background:#1976d2; border:none;">SOS</div>', en: 'Emergency Button' }
        ],
        2: [ // 中級
            { id: 'open', html: '<div class="sign-wood">営業中</div>', en: 'Open' },
            { id: 'prep', html: '<div class="sign-wood" style="background:#5d4037;">準備中</div>', en: 'Closed / Prep' },
            // ↓ PUSH/PULLの英語を削除
            { id: 'push', html: '<div class="sign-generic square" style="border-color:#333; color:#333;">押</div>', en: 'Push' },
            { id: 'pull', html: '<div class="sign-generic square" style="border-color:#333; color:#333;">引</div>', en: 'Pull' },
            { id: 'parking', html: '<div class="sign-generic blue" style="border:none; background:#1976d2; color:white;">P</div>', en: 'Parking' },
            { id: 'elevator', html: '<div class="sign-generic square" style="border:none; background:#eee; color:#333;"><i class="fa-solid fa-elevator"></i></div>', en: 'Elevator' },
            { id: 'escalator', html: '<div class="sign-generic square" style="border:none; background:#eee; color:#333;"><i class="fa-solid fa-stairs"></i></div>', en: 'Escalator' },
            { id: 'checkout', html: '<div class="sign-generic square" style="border:none; background:#eee; color:#333;"><i class="fa-solid fa-cash-register"></i></div>', en: 'Cashier' }
        ],
        3: [ // 上級
            { id: 'no_photo', html: '<div class="sign-generic"><i class="fa-solid fa-ban"></i><i class="fa-solid fa-camera" style="position:absolute; font-size:0.5em; color:#333;"></i></div>', en: 'No Photography' },
            { id: 'no_shoes', html: '<div class="sign-generic"><i class="fa-solid fa-ban"></i><i class="fa-solid fa-shoe-prints" style="position:absolute; font-size:0.5em; color:#333;"></i></div>', en: 'Remove Shoes' },
            // ↓ Quietの英語を削除
            { id: 'quiet', html: '<div class="sign-generic square" style="border:3px solid #333; font-size:1.5em;">静かに</div>', en: 'Be Quiet' },
            { id: 'priority', html: '<div class="sign-generic blue"><i class="fa-solid fa-person-cane"></i></div>', en: 'Priority Seat' },
            { id: 'water', html: '<div class="sign-generic blue square" style="background:#1976d2; color:white; border:none;"><i class="fa-solid fa-faucet-drip"></i></div>', en: 'Drinking Water' },
            { id: 'trash', html: '<div class="sign-generic square" style="border:3px solid #333;"><i class="fa-solid fa-trash-can"></i></div>', en: 'Trash Can' },
            { id: 'no_litter', html: '<div class="sign-generic"><i class="fa-solid fa-ban"></i><i class="fa-solid fa-trash" style="position:absolute; font-size:0.5em; color:#333;"></i></div>', en: 'No Littering' }
        ],
        4: [ // 最上級
            { id: 'onsen', html: '<div class="sign-generic" style="border:none; color:#d32f2f;"><i class="fa-solid fa-hot-tub-person"></i></div>', en: 'Hot Spring' },
            { id: 'post', html: '<div class="sign-generic" style="border:none; color:#d32f2f; font-weight:900;">〒</div>', en: 'Post Office' },
            { id: 'koban', html: '<div class="sign-generic" style="border:none; color:#333;"><i class="fa-solid fa-building-shield"></i></div>', en: 'Police Box' },
            { id: 'temple', html: '<div class="sign-generic" style="border:none; color:#333;">卍</div>', en: 'Temple' },
            { id: 'shrine', html: '<div class="sign-generic" style="border:none; color:#333;"><i class="fa-solid fa-torii-gate"></i></div>', en: 'Shrine' },
            { id: 'construction', html: '<div class="sign-generic square" style="background:#fdd835; border:3px solid #333;">工事中</div>', en: 'Construction' },
            { id: 'atm', html: '<div class="sign-generic square" style="background:#00c853; color:white; border:none;">ATM</div>', en: 'ATM' }
        ]
    };

    let currentLevel = 1;
    let questionList = [];
    let currentIndex = 0;
    let score = 0;
    let timerInterval = null;
    let timeLeft = 5000; // ms
    const TIME_LIMIT = 5000;

    // --- 初期化：練習リスト生成 ---
    function initPractice() {
        const container = document.getElementById('practice-container');
        container.textContent = '';
        
        for(let l=1; l<=4; l++) {
            signsData[l].forEach(item => {
                const div = document.createElement('div');
                div.className = 'practice-item';
                div.textContent = `
                    <div style="height:100px; display:flex; align-items:center; justify-content:center; overflow:hidden;">
                        <div style="transform:scale(0.5);">${item.html}</div>
                    </div>
                    <div class="practice-label">${item.en}</div>
                `;
                container.appendChild(div);
            });
        }
    }

    // --- 画面遷移 (修正：戻る挙動) ---
    window.showScreen = (id) => {
        document.querySelectorAll('.screen').forEach(el => el.classList.remove('active'));
        document.getElementById(id).classList.add('active');
        
        const footer = document.getElementById('footer-start');
        footer.style.display = (id === 'screen-practice') ? 'block' : 'none';
        window.scrollTo(0,0);
    };

    window.goBack = () => {
        const activeId = document.querySelector('.screen.active').id;
        if (activeId === 'screen-level') {
            showScreen('screen-practice');
        } 
        else if (activeId === 'screen-game') {
            // ダイアログなしで即座にレベル選択へ戻る
            clearInterval(timerInterval);
            showScreen('screen-level'); 
        }
        else if (activeId === 'screen-result') {
            showScreen('screen-level');
        }
        else {
            window.location.href = 'index.html';
        }
    };

    // --- ゲームロジック ---
    window.startGame = (level) => {
        currentLevel = level;
        const source = signsData[level] || signsData[1];
        questionList = [];
        for(let i=0; i<10; i++) {
            questionList.push(source[Math.floor(Math.random() * source.length)]);
        }
        
        currentIndex = 0;
        score = 0;
        showScreen('screen-game');
        nextQuestion();
    };

    function nextQuestion() {
        if (currentIndex >= 10) {
            endGame();
            return;
        }

        const q = questionList[currentIndex];
        document.getElementById('q-current').textContent = currentIndex + 1;
        
        document.getElementById('sign-display').textContent = q.html;

        // 誤答生成
        let allSigns = [];
        for(let l=1; l<=4; l++) allSigns = allSigns.concat(signsData[l]);
        
        const others = allSigns.filter(s => s.id !== q.id);
        const wrongOpts = others.sort(() => 0.5 - Math.random()).slice(0, 3);
        
        let options = [q, ...wrongOpts];
        options.sort(() => 0.5 - Math.random());

        const btnContainer = document.getElementById('choice-container');
        btnContainer.textContent = '';
        
        options.forEach(opt => {
            const btn = document.createElement('button');
            btn.className = 'btn-choice';
            // 選択肢は英語のみに変更
            btn.textContent = opt.en;
            btn.onclick = () => checkAnswer(opt.id === q.id);
            btnContainer.appendChild(btn);
        });

        startTimer();
    }

    function startTimer() {
        clearInterval(timerInterval);
        timeLeft = TIME_LIMIT;
        const bar = document.getElementById('timer-bar');
        bar.style.width = '100%';
        bar.classList.remove('danger');

        timerInterval = setInterval(() => {
            timeLeft -= 100;
            const pct = (timeLeft / TIME_LIMIT) * 100;
            bar.style.width = pct + '%';
            
            if(pct < 30) bar.classList.add('danger');

            if (timeLeft <= 0) {
                clearInterval(timerInterval);
                checkAnswer(false);
            }
        }, 100);
    }

    function checkAnswer(isCorrect) {
        clearInterval(timerInterval);
        
        const fb = document.getElementById('feedback');
        fb.textContent = isCorrect ? '⭕' : '❌';
        fb.style.color = isCorrect ? '#00e676' : '#ef5350';
        fb.style.animation = 'none';
        fb.offsetHeight; 
        fb.style.animation = 'popFeedback 0.6s ease';

        if(isCorrect) score++;

        setTimeout(() => {
            currentIndex++;
            nextQuestion();
        }, 600);
    }

    function endGame() {
        showScreen('screen-result');
        document.getElementById('final-score').textContent = score;
        
        const msg = document.getElementById('result-msg');
        if(score === 10) msg.textContent = "Perfect! You survived!";
        else if(score >= 8) msg.textContent = "Great job!";
        else if(score >= 5) msg.textContent = "Good. Keep practicing.";
        else msg.textContent = "Danger! Study more!";
    }

    initPractice();

</script>
</body>
</html>