<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>ひらがな並び替え - FunLearnJP</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<link href="https://fonts.googleapis.com/css2?family=Zen+Maru+Gothic:wght@400;700;900&display=swap" rel="stylesheet">

<style>
    /* --- 共通設定 --- */
    :root {
        --primary: #5c7aff;
        --accent: #ffcc5c;
        --bg-color: #f4f7fc;
        --text-color: #333;
        --correct-color: #4caf50;
        --incorrect-color: #ef5350;
    }

    body {
        font-family: 'Zen Maru Gothic', sans-serif;
        background-color: var(--bg-color);
        color: var(--text-color);
        margin: 0; padding: 0; min-height: 100vh;
        display: flex; flex-direction: column;
        touch-action: manipulation;
    }

    /* --- ヘッダー --- */
    header {
        background: linear-gradient(135deg, #5c7aff 0%, #4facfe 100%);
        color: white; padding: 15px 20px;
        display: flex; justify-content: space-between; align-items: center;
        box-shadow: 0 4px 15px rgba(92, 122, 255, 0.3); z-index: 100;
    }
    .logo { font-size: 1.4em; font-weight: 900; display: flex; align-items: center; gap: 10px; color: white; text-decoration: none; }
    .home-icon { color: white; font-size: 1.5em; transition: transform 0.2s; }
    .home-icon:hover { transform: scale(1.1); }

    /* --- メインコンテナ --- */
    .main-container {
        flex-grow: 1; padding: 20px; max-width: 700px;
        margin: 0 auto; width: 100%; box-sizing: border-box;
        display: flex; flex-direction: column; justify-content: center;
    }

    /* --- カードデザイン --- */
    .game-card {
        background: white; border-radius: 25px; padding: 20px;
        box-shadow: 0 8px 25px rgba(0,0,0,0.08); text-align: center;
        border: 4px solid white; width: 100%; box-sizing: border-box;
    }

    /* --- メニュー画面 --- */
    .menu-icon { font-size: 5em; color: #4caf50; margin-bottom: 15px; animation: bounce 2s infinite; }
    .menu-title { font-size: 2em; color: var(--primary); margin: 0 0 10px 0; }
    .menu-desc { color: #666; margin-bottom: 20px; font-size: 1.1em; }
    
    .start-btn {
        background: linear-gradient(to bottom, #5c7aff, #4b63cc);
        color: white; font-size: 1.6em; font-weight: 900;
        padding: 15px 50px; border: none; border-radius: 50px;
        cursor: pointer; box-shadow: 0 6px 0 #3f51b5;
        margin-bottom: 15px; display: inline-block; width: 80%; max-width: 300px;
    }
    .start-btn:active { transform: translateY(4px); box-shadow: 0 2px 0 #3f51b5; }
    .home-btn-text { color: #999; text-decoration: none; font-weight: bold; display: block; margin-top: 10px; }

    /* --- ゲーム画面 --- */
    .score-board {
        display: flex; justify-content: space-between; align-items: center;
        margin-bottom: 15px; padding: 10px 20px;
        background: white; border-radius: 50px; box-shadow: 0 4px 10px rgba(0,0,0,0.05);
        font-weight: bold; color: var(--primary);
    }

    .image-frame {
        width: 180px; height: 180px; margin: 0 auto 15px;
        background: #fffbea; border: 6px solid var(--accent);
        border-radius: 25px; overflow: hidden;
        display: flex; align-items: center; justify-content: center;
    }
    .image-frame img { width: 90%; height: 90%; object-fit: contain; }

    .instruction-text { font-weight: bold; color: #666; margin: 10px 0 5px; font-size: 0.9em; }

    /* --- ドロップゾーン --- */
    .drop-zone-container {
        display: flex; justify-content: center; gap: 8px;
        margin-bottom: 20px; min-height: 70px; flex-wrap: wrap;
    }
    .drop-slot {
        width: 60px; height: 60px; border: 3px dashed #ccc;
        background-color: #f9f9f9; border-radius: 12px;
        display: flex; justify-content: center; align-items: center;
        transition: background-color 0.2s; cursor: pointer;
    }
    .drop-slot.filled { border-style: solid; border-color: var(--primary); background-color: #e3f2fd; }

    /* --- 文字ピース --- */
    .pool-container {
        background: #eef6ff; border-radius: 15px; padding: 15px;
        min-height: 80px; display: flex; justify-content: center;
        gap: 10px; flex-wrap: wrap; margin-bottom: 20px;
        border: 2px solid #bbdefb;
    }
    
    .char-piece {
        width: 55px; height: 55px; background: white;
        border: 3px solid var(--primary); border-radius: 12px;
        font-size: 1.8em; font-weight: 900; color: var(--primary);
        display: flex; justify-content: center; align-items: center;
        cursor: pointer; box-shadow: 0 4px 0 #90caf9;
        user-select: none;
    }
    .char-piece:active { transform: scale(0.95); box-shadow: 0 2px 0 #90caf9; }
    .char-piece.used { opacity: 0.3; pointer-events: none; transform: scale(0.9); box-shadow: none; border-color: #ccc; }

    .check-btn {
        background: #4caf50; color: white; border: none; border-radius: 50px;
        padding: 12px 40px; font-size: 1.2em; font-weight: bold;
        box-shadow: 0 4px 0 #2e7d32; cursor: pointer;
    }
    .check-btn:active { transform: translateY(2px); box-shadow: 0 1px 0 #2e7d32; }
    .feedback-msg { height: 1.5em; font-weight: bold; font-size: 1.2em; margin-top: 15px; }

    /* アニメーション */
    .pop-in { animation: popIn 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275); }
    @keyframes popIn { 0% { transform: scale(0.8); opacity: 0; } 100% { transform: scale(1); opacity: 1; } }
    @keyframes bounce { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-10px); } }

</style>
</head>
<body>

    <header>
        <a href="index.html" class="logo"><i class="fa-solid fa-shapes"></i> FunLearnJP</a>
        <a href="index.html" class="home-icon"><i class="fa-solid fa-house"></i></a>
    </header>

    <div class="main-container">
        
        <div id="main-menu-2" class="pop-in">
            <div class="game-card">
                <i class="fa-solid fa-sort-alpha-down menu-icon"></i>
                <h1 class="menu-title">ならびかえ</h1>
                <p class="menu-desc">もじ を ならびかえて<br>ただしい ことば をつくろう！</p>
                
                <div style="background:#e8f5e9; padding:10px; border-radius:10px; margin-bottom:20px; color:#2e7d32;">
                    ぜんぶで <strong>10もん</strong> あるよ！
                    <div id="auth-status" style="margin-top:5px; font-size:0.9em; font-weight:normal; color:#1a6e1d;">認証中...</div>
                </div>

                <button id="startButtonGame2" class="start-btn" onclick="game.start()">
                    <i class="fa-solid fa-play"></i> スタート！
                </button>
                <a href="index.html" class="home-btn-text">ホームにもどる</a>
            </div>
        </div>

        <div id="game-area-2" style="display:none;" class="pop-in">
            <div class="score-board">
                <span id="turn-msg">問 1 / 10</span>
                <span><i class="fa-solid fa-star" style="color:#f0ad4e;"></i> <span id="score-val">0</span></span>
            </div>
            <div class="game-card">
                <div id="image-area" class="image-frame"></div>
                <div class="instruction-text">ここに もじ をいれてね</div>
                <div id="answer-container" class="drop-zone-container"></div>
                <div class="instruction-text">つかう もじ</div>
                <div id="pool-container" class="pool-container"></div>
                <div>
                    <button id="checkButton" class="check-btn" onclick="game.checkAnswer()">できた！</button>
                </div>
                <p id="feedback" class="feedback-msg"></p>
                <div style="margin-top: 10px;">
                    <button onclick="location.reload()" style="background:none; border:none; color:#999; cursor:pointer; text-decoration:underline;">やめる</button>
                </div>
            </div>
        </div>

    </div>

    <audio id="snd-correct" src="assets/sounds/seikai.mp3"></audio>
    <audio id="snd-incorrect" src="assets/sounds/bubu.mp3"></audio>
    <audio id="snd-fanfare" src="assets/sounds/fanfare.mp3"></audio>

<script type="module">
    // 1. 必要なFirebaseモジュールのインポート
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.2/firebase-app.js";
    import { getFirestore, doc, updateDoc, increment, getDoc } from "https://www.gstatic.com/firebasejs/11.0.2/firebase-firestore.js";
    import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.0.2/firebase-auth.js";


    // 2. あなたのFirebase設定 (index.htmlと同じものをコピー)
    const firebaseConfig = {
      apiKey: "AIzaSyDpfbjezbYxrW3XMDegBSC5iFPEQEyD0Ls",
      authDomain: "funlearningjapanese-b8e08.firebaseapp.com",
      projectId: "funlearningjapanese-b8e08",
      storageBucket: "funlearningjapanese-b8e08.firebasestorage.app",
      messagingSenderId: "1055688629268",
      appId: "1:1055688629268:web:248183b62f15c34a2d5b01",
      measurementId: "G-LCMXVLPS81"
    };

    // 3. Firebaseサービスの初期化とグローバル変数
    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);
    const auth = getAuth(app);
    
    let currentUserId = null;
    const authStatusEl = document.getElementById('auth-status');


    // 4. 認証状態の監視とUIDの取得
    onAuthStateChanged(auth, async (user) => {
        if (user) {
            currentUserId = user.uid;
            
            // ユーザーの displayName (ゲーム名) を取得し、メニューに表示
            const userDocRef = doc(db, "users", currentUserId);
            const userDocSnap = await getDoc(userDocRef);
            let displayName = 'ユーザー';
            if (userDocSnap.exists()) {
                displayName = userDocSnap.data().displayName || 'ユーザー';
            }
            authStatusEl.textContent = `✅ ログイン中: ${displayName}`;

        } else {
            currentUserId = null;
            authStatusEl.textContent = '❌ ゲストモード (ポイントは記録されません)';
        }
    });


    /**
     * ポイント加算関数
     * ゲームクリア時にこの関数を呼び出し、ユーザーのポイントに加算します。
     * @param {number} points - 加算するポイント数
     */
    async function addPointsToUser(points) {
        if (!currentUserId) {
            console.warn("ユーザーがログインしていないため、ポイントは記録されません。");
            return false;
        }
        
        try {
            const userRef = doc(db, "users", currentUserId);
            // Firestoreのincrementを使って、既存の値に安全に加算
            await updateDoc(userRef, {
                points: increment(points) 
            });
            console.log(`${points} ポイントを Firestore に加算しました。`);
            return true;

        } catch (e) {
            console.error("ポイント更新エラー:", e);
            if (e.code === 'permission-denied') {
                 alert('ポイント加算に失敗しました。Firestoreのセキュリティルールが正しく設定されているか確認してください。');
            }
            return false;
        }
    }


    // --- データセット (二重宣言を解消) ---
    // ユーザー提供の画像パスからファイル名を抽出し、平仮名に変換してデータセットを作成
    const QUESTIONS = [
        { id: 'ahiru', img: 'assets/images/ahiru.png', ans: 'あひる' },
        { id: 'ajisai', img: 'assets/images/ajisai.png', ans: 'あじさい' },
        { id: 'aka', img: 'assets/images/aka.png', ans: 'あか' },
        { id: 'ame', img: 'assets/images/ame.png', ans: 'あめ' },
        { id: 'ari', img: 'assets/images/ari.png', ans: 'あり' },
        { id: 'ashi', img: 'assets/images/ashi.png', ans: 'あし' },
        { id: 'atsui', img: 'assets/images/atsui.png', ans: 'あつい' },
        { id: 'banana', img: 'assets/images/banana.png', ans: 'ばなな' },
        { id: 'batsu', img: 'assets/images/batsu.png', ans: 'ばつ' },
        { id: 'buta', img: 'assets/images/buta.png', ans: 'ぶた' },
        { id: 'cho', img: 'assets/images/cho.png', ans: 'ちょう' },
        { id: 'churippu', img: 'assets/images/churippu.png', ans: 'ちゅーりっぷ' },
        { id: 'daikon', img: 'assets/images/daikon.png', ans: 'だいこん' },
        { id: 'dango', img: 'assets/images/dango.png', ans: 'だんご' },
        { id: 'daruma', img: 'assets/images/daruma.png', ans: 'だるま' },
        { id: 'densha', img: 'assets/images/densha.png', ans: 'でんしゃ' },
        { id: 'ebi', img: 'assets/images/ebi.png', ans: 'えび' },
        { id: 'ehon', img: 'assets/images/ehon.png', ans: 'えほん' },
        { id: 'enpitsu', img: 'assets/images/enpitsu.png', ans: 'えんぴつ' },
        { id: 'fujisan', img: 'assets/images/fujisan.png', ans: 'ふじさん' },
        { id: 'fuku', img: 'assets/images/fuku.png', ans: 'ふく' },
        { id: 'fune', img: 'assets/images/fune.png', ans: 'ふね' },
        { id: 'gakko', img: 'assets/images/gakko.png', ans: 'がっこう' },
        { id: 'ginko', img: 'assets/images/ginko.png', ans: 'ぎんこう' },
        { id: 'gohan', img: 'assets/images/gohan.png', ans: 'ごはん' },
        { id: 'gorira', img: 'assets/images/gorira.png', ans: 'ごりら' },
        { id: 'gyoza', img: 'assets/images/gyoza.png', ans: 'ぎょうざ' },
        { id: 'ha', img: 'assets/images/ha.png', ans: 'は' },
        { id: 'hana', img: 'assets/images/hana.png', ans: 'はな' },
        { id: 'hanabi', img: 'assets/images/hanabi.png', ans: 'はなび' },
        { id: 'hasami', img: 'assets/images/hasami.png', ans: 'はさみ' },
        { id: 'hashi', img: 'assets/images/hashi.png', ans: 'はし' },
        { id: 'hebi', img: 'assets/images/hebi.png', ans: 'へび' },
        { id: 'hi', img: 'assets/images/hi.png', ans: 'ひ' },
        { id: 'hikoki', img: 'assets/images/hikoki.png', ans: 'ひこうき' },
        { id: 'himawari', img: 'assets/images/himawari.png', ans: 'ひまわり' },
        { id: 'hoshi', img: 'assets/images/hoshi.png', ans: 'ほし' },
        { id: 'ichi', img: 'assets/images/ichi.png', ans: 'いち' },
        { id: 'ichigo', img: 'assets/images/ichigo.png', ans: 'いちご' },
        { id: 'ika', img: 'assets/images/ika.png', ans: 'いか' },
        { id: 'inu', img: 'assets/images/inu.png', ans: 'いぬ' },
        { id: 'iruka', img: 'assets/images/iruka.png', ans: 'いるか' },
        { id: 'ishi', img: 'assets/images/ishi.png', ans: 'いし' },
        { id: 'isu', img: 'assets/images/isu.png', ans: 'いす' },
        { id: 'jitensha', img: 'assets/images/jitensha.png', ans: 'じてんしゃ' },
        { id: 'kaban', img: 'assets/images/kaban.png', ans: 'かばん' },
        { id: 'kaeru', img: 'assets/images/kaeru.png', ans: 'かえる' },
        { id: 'kagi', img: 'assets/images/kagi.png', ans: 'かぎ' },
        { id: 'kame', img: 'assets/images/kame.png', ans: 'かめ' },
        { id: 'kasa', img: 'assets/images/kasa.png', ans: 'かさ' },
        { id: 'kawa', img: 'assets/images/kawa.png', ans: 'かわ' },
        { id: 'keito', img: 'assets/images/keito.png', ans: 'けいと' },
        { id: 'kocha', img: 'assets/images/kocha.png', ans: 'こうちゃ' },
        { id: 'kodomo', img: 'assets/images/kodomo.png', ans: 'こども' },
        { id: 'koi', img: 'assets/images/koi.png', ans: 'こい' },
        { id: 'koma', img: 'assets/images/koma.png', ans: 'こま' },
        { id: 'koppu', img: 'assets/images/koppu.png', ans: 'コップ' },
        { id: 'kuchi', img: 'assets/images/kuchi.png', ans: 'くち' },
        { id: 'kuma', img: 'assets/images/kuma.png', ans: 'くま' },
        { id: 'kumo', img: 'assets/images/kumo.png', ans: 'くも' },
        { id: 'kuro', img: 'assets/images/kuro.png', ans: 'くろ' },
        { id: 'kuruma', img: 'assets/images/kuruma.png', ans: 'くるま' },
        { id: 'kutsu', img: 'assets/images/kutsu.png', ans: 'くつ' },
        { id: 'mado', img: 'assets/images/mado.png', ans: 'まど' },
        { id: 'maguro', img: 'assets/images/maguro.png', ans: 'まぐろ' },
        { id: 'makura', img: 'assets/images/makura.png', ans: 'まくら' },
        { id: 'mame', img: 'assets/images/mame.png', ans: 'まめ' },
        { id: 'manga', img: 'assets/images/manga.png', ans: 'まんが' },
        { id: 'megane', img: 'assets/images/megane.png', ans: 'めがね' },
        { id: 'michi', img: 'assets/images/michi.png', ans: 'みち' },
        { id: 'midori', img: 'assets/images/midori.png', ans: 'みどり' },
        { id: 'mikan', img: 'assets/images/mikan.png', ans: 'みかん' },
        { id: 'mizuumi', img: 'assets/images/mizuumi.png', ans: 'みずうみ' },
        { id: 'momo', img: 'assets/images/momo.png', ans: 'もも' },
        { id: 'mori', img: 'assets/images/mori.png', ans: 'もり' },
        { id: 'mushi', img: 'assets/images/mushi.png', ans: 'むし' },
        { id: 'nabe', img: 'assets/images/nabe.png', ans: 'なべ' },
        { id: 'namazu', img: 'assets/images/namazu.png', ans: 'なまず' },
        { id: 'nami', img: 'assets/images/nami.png', ans: 'なみ' },
        { id: 'nana', img: 'assets/images/nana.png', ans: 'なな' },
        { id: 'nashi', img: 'assets/images/nashi.png', ans: 'なし' },
        { id: 'nasu', img: 'assets/images/nasu.png', ans: 'なす' },
        { id: 'neko', img: 'assets/images/neko.png', ans: 'ねこ' },
        { id: 'nezumi', img: 'assets/images/nezumi.png', ans: 'ねずみ' },
        { id: 'niwa', img: 'assets/images/niwa.png', ans: 'にわ' },
        { id: 'nori', img: 'assets/images/nori.png', ans: 'のり' },
        { id: 'nuigurumi', img: 'assets/images/nuigurumi.png', ans: 'ぬいぐるみ' },
        { id: 'nurie', img: 'assets/images/nurie.png', ans: 'ぬりえ' },
        { id: 'oka', img: 'assets/images/oka.png', ans: 'おか' },
        { id: 'okashi', img: 'assets/images/okashi.png', ans: 'おかし' },
        { id: 'omocha', img: 'assets/images/omocha.png', ans: 'おもちゃ' },
        { id: 'oni', img: 'assets/images/oni.png', ans: 'おに' },
        { id: 'onigiri', img: 'assets/images/onigiri.png', ans: 'おにぎり' },
        { id: 'onsen', img: 'assets/images/onsen.png', ans: 'おんせん' },
        { id: 'panda', img: 'assets/images/panda.png', ans: 'ぱんだ' },
        { id: 'raion', img: 'assets/images/raion.png', ans: 'らいおん' },
        { id: 'ramen', img: 'assets/images/ramen.png', ans: 'ラーメン' },
        { id: 'rappa', img: 'assets/images/rappa.png', ans: 'らっぱ' },
        { id: 'ringo', img: 'assets/images/ringo.png', ans: 'りんご' },
        { id: 'risu', img: 'assets/images/risu.png', ans: 'りす' },
        { id: 'roku', img: 'assets/images/roku.png', ans: 'ろく' },
        { id: 'sakana', img: 'assets/images/sakana.png', ans: 'さかな' },
        { id: 'sakura', img: 'assets/images/sakura.png', ans: 'さくら' },
        { id: 'saru', img: 'assets/images/saru.png', ans: 'さる' },
        { id: 'semi', img: 'assets/images/semi.png', ans: 'せみ' },
        { id: 'shiitake', img: 'assets/images/shiitake.png', ans: 'しいたけ' },
        { id: 'shika', img: 'assets/images/shika.png', ans: 'しか' },
        { id: 'shiro', img: 'assets/images/shiro.png', ans: 'しろ' },
        { id: 'suika', img: 'assets/images/suika.png', ans: 'すいか' },
        { id: 'sushi', img: 'assets/images/sushi.png', ans: 'すし' },
        { id: 'suzume', img: 'assets/images/suzume.png', ans: 'すずめ' },
        { id: 'tai', img: 'assets/images/tai.png', ans: 'たい' },
        { id: 'tako', img: 'assets/images/tako.png', ans: 'たこ' },
        { id: 'tamago', img: 'assets/images/tamago.png', ans: 'たまご' },
        { id: 'tanuki', img: 'assets/images/tanuki.png', ans: 'たぬき' },
        { id: 'te', img: 'assets/images/te.png', ans: 'て' },
        { id: 'terebi', img: 'assets/images/terebi.png', ans: 'テレビ' },
        { id: 'tofu', img: 'assets/images/tofu.png', ans: 'とうふ' },
        { id: 'tokei', img: 'assets/images/tokei.png', ans: 'とけい' },
        { id: 'tomato', img: 'assets/images/tomato.png', ans: 'とまと' },
        { id: 'tori', img: 'assets/images/tori.png', ans: 'とり' },
        { id: 'tsubame', img: 'assets/images/tsubame.png', ans: 'つばめ' },
        { id: 'tsuki', img: 'assets/images/tsuki.png', ans: 'つき' },
        { id: 'tsukue', img: 'assets/images/tsukue.png', ans: 'つくえ' },
        { id: 'ude', img: 'assets/images/ude.png', ans: 'うで' },
        { id: 'uma', img: 'assets/images/uma.png', ans: 'うま' },
        { id: 'umi', img: 'assets/images/umi.png', ans: 'うみ' },
        { id: 'usagi', img: 'assets/images/usagi.png', ans: 'うさぎ' },
        { id: 'ushi', img: 'assets/images/ushi.png', ans: 'うし' },
        { id: 'wani', img: 'assets/images/wani.png', ans: 'わに' },
        { id: 'yagi', img: 'assets/images/yagi.png', ans: 'やぎ' },
        { id: 'yama', img: 'assets/images/yama.png', ans: 'やま' },
        { id: 'yuki', img: 'assets/images/yuki.png', ans: 'ゆき' },
        { id: 'yubiwa', img: 'assets/images/yubiwa.png', ans: 'ゆびわ' },
        // 外来語・固有名詞等でひらがなでないものは、ゲームの性質上、平仮名読みを当てています。
        // （例: america.png -> あめりか, beer.png -> びーる）
        { id: 'america', img: 'assets/images/america.png', ans: 'あめりか' },
        { id: 'anko', img: 'assets/images/anko.png', ans: 'あんこ' },
        { id: 'ao', img: 'assets/images/ao.png', ans: 'あお' },
        { id: 'asagao', img: 'assets/images/asagao.png', ans: 'あさがお' },
        { id: 'batta', img: 'assets/images/batta.png', ans: 'ばった' },
        { id: 'beer', img: 'assets/images/beer.png', ans: 'びーる' },
        { id: 'biidama', img: 'assets/images/biidama.png', ans: 'びーだま' },
        { id: 'boshi', img: 'assets/images/boshi.png', ans: 'ぼうし' },
        { id: 'cabbege', img: 'assets/images/cabbege.png', ans: 'きゃべつ' },
        { id: 'cafe', img: 'assets/images/cafe.png', ans: 'かふぇ' },
        { id: 'camera', img: 'assets/images/camera.png', ans: 'かめら' },
        { id: 'cheetah', img: 'assets/images/cheetah.png', ans: 'ちーたー' },
        { id: 'chess', img: 'assets/images/chess.png', ans: 'ちぇす' },
        { id: 'chikuwa', img: 'assets/images/chikuwa.png', ans: 'ちくわ' },
        { id: 'chizu', img: 'assets/images/chizu.png', ans: 'ちず' },
        { id: 'choko', img: 'assets/images/choko.png', ans: 'ちょこ' },
        { id: 'cocoa', img: 'assets/images/cocoa.png', ans: 'ここあ' },
        { id: 'coffee', img: 'assets/images/coffee.png', ans: 'こーひー' },
        { id: 'cola', img: 'assets/images/cola.png', ans: 'こーら' },
        { id: 'combini', img: 'assets/images/combini.png', ans: 'こんびに' },
        { id: 'dacho', img: 'assets/images/dacho.png', ans: 'だちょう' },
        { id: 'doa', img: 'assets/images/doa.png', ans: 'どあ' },
        { id: 'ebifurai', img: 'assets/images/ebifurai.png', ans: 'えびふらい' },
        { id: 'eda', img: 'assets/images/eda.png', ans: 'えだ' },
        { id: 'eiga', img: 'assets/images/eiga.png', ans: 'えいが' },
        { id: 'eigo', img: 'assets/images/eigo.png', ans: 'えいご' },
        { id: 'eki', img: 'assets/images/eki.png', ans: 'えき' },
        { id: 'enogu', img: 'assets/images/enogu.png', ans: 'えのぐ' },
        { id: 'furin', img: 'assets/images/furin.png', ans: 'ふうりん' },
        { id: 'fusen', img: 'assets/images/fusen.png', ans: 'ふうせん' },
        { id: 'gakusei', img: 'assets/images/gakusei.png', ans: 'がくせい' },
        { id: 'go', img: 'assets/images/go.png', ans: 'ご' },
        { id: 'goma', img: 'assets/images/goma.png', ans: 'ごま' },
        { id: 'gomibako', img: 'assets/images/gomibako.png', ans: 'ごみばこ' },
        { id: 'hachi', img: 'assets/images/hachi.png', ans: 'はち' },
        { id: 'hachimitsu', img: 'assets/images/hachimitsu.png', ans: 'はちみつ' },
        { id: 'hakucho', img: 'assets/images/hakucho.png', ans: 'はくちょう' },
        { id: 'hamigaki', img: 'assets/images/hamigaki.png', ans: 'はみがき' },
        { id: 'hankachi', img: 'assets/images/hankachi.png', ans: 'はんかち' },
        { id: 'happa', img: 'assets/images/happa.png', ans: 'はっぱ' },
        { id: 'heart', img: 'assets/images/heart.png', ans: 'はーと' },
        { id: 'hechima', img: 'assets/images/hechima.png', ans: 'へちま' },
        { id: 'hidari', img: 'assets/images/hidari.png', ans: 'ひだり' },
        { id: 'hiyoko', img: 'assets/images/hiyoko.png', ans: 'ひよこ' },
        { id: 'hoki', img: 'assets/images/hoki.png', ans: 'ほうき' },
        { id: 'ice', img: 'assets/images/ice.png', ans: 'あいす' },
        { id: 'ike', img: 'assets/images/ike.png', ans: 'いけ' },
        { id: 'imo', img: 'assets/images/imo.png', ans: 'いも' },
        { id: 'indo', img: 'assets/images/indo.png', ans: 'いんど' },
        { id: 'indonesia', img: 'assets/images/indonesia.png', ans: 'いんどねしあ' },
        { id: 'inko', img: 'assets/images/inko.png', ans: 'いんこ' },
        { id: 'inoshishi', img: 'assets/images/inoshishi.png', ans: 'いのしし' },
        { id: 'isoginchaku', img: 'assets/images/isoginchaku.png', ans: 'いそぎんちゃく' },
        { id: 'itomaki', img: 'assets/images/itomaki.png', ans: 'いとまき' },
        { id: 'jinja', img: 'assets/images/jinja.png', ans: 'じんじゃ' },
        { id: 'jishaku', img: 'assets/images/jishaku.png', ans: 'じしゃく' },
        { id: 'kaba', img: 'assets/images/kaba.png', ans: 'かば' },
        { id: 'kabe', img: 'assets/images/kabe.png', ans: 'かべ' },
        { id: 'kagami', img: 'assets/images/kagami.png', ans: 'かがみ' },
        { id: 'kai', img: 'assets/images/kai.png', ans: 'かい' },
        { id: 'kaji', img: 'assets/images/kaji.png', ans: 'かじ' },
        { id: 'kakashi', img: 'assets/images/kakashi.png', ans: 'かかし' },
        { id: 'kami', img: 'assets/images/kami.png', ans: 'かみ' },
        { id: 'kani', img: 'assets/images/kani.png', ans: 'かに' },
        { id: 'karasu', img: 'assets/images/karasu.png', ans: 'からす' },
        { id: 'katana', img: 'assets/images/katana.png', ans: 'かたな' },
        { id: 'katatsumuri', img: 'assets/images/katatsumuri.png', ans: 'かたつむり' },
        { id: 'kawa', img: 'assets/images/kawa.png', ans: 'かわ' },
        { id: 'keito', img: 'assets/images/keito.png', ans: 'けいと' },
        { id: 'keki', img: 'assets/images/keki.png', ans: 'けーき' },
        { id: 'kemuri', img: 'assets/images/kemuri.png', ans: 'けむり' },
        { id: 'kemushi', img: 'assets/images/kemushi.png', ans: 'けむし' },
        { id: 'keshigomu', img: 'assets/images/keshigomu.png', ans: 'けしごむ' },
        { id: 'ki', img: 'assets/images/ki.png', ans: 'き' },
        { id: 'kiiro', img: 'assets/images/kiiro.png', ans: 'きいろ' },
        { id: 'kikyu', img: 'assets/images/kikyu.png', ans: 'ききゅう' },
        { id: 'kimono', img: 'assets/images/kimono.png', ans: 'きもの' },
        { id: 'kinniku', img: 'assets/images/kinniku.png', ans: 'きんにく' },
        { id: 'kinoko', img: 'assets/images/kinoko.png', ans: 'きのこ' },
        { id: 'kirin', img: 'assets/images/kirin.png', ans: 'きりん' },
        { id: 'kisha', img: 'assets/images/kisha.png', ans: 'きしゃ' },
        { id: 'kitsune', img: 'assets/images/kitsune.png', ans: 'きつね' },
        { id: 'kitsutsuki', img: 'assets/images/kitsutsuki.png', ans: 'きつつき' },
        { id: 'knife', img: 'assets/images/knife.png', ans: 'ないふ' },
        { id: 'koara', img: 'assets/images/koara.png', ans: 'こあら' },
        { id: 'koinobori', img: 'assets/images/koinobori.png', ans: 'こいのぼり' },
        { id: 'koke', img: 'assets/images/koke.png', ans: 'こけ' },
        { id: 'kombu', img: 'assets/images/kombu.png', ans: 'こんぶ' },
        { id: 'kori', img: 'assets/images/kori.png', ans: 'こおり' },
        { id: 'korokke', img: 'assets/images/korokke.png', ans: 'ころっけ' },
        { id: 'kosho', img: 'assets/images/kosho.png', ans: 'こしょう' },
        { id: 'kujira', img: 'assets/images/kujira.png', ans: 'くじら' },
        { id: 'kuko', img: 'assets/images/kuko.png', ans: 'くうこう' },
        { id: 'kuri', img: 'assets/images/kuri.png', ans: 'くり' },
        { id: 'kurumi', img: 'assets/images/kurumi.png', ans: 'くるみ' },
        { id: 'kusa', img: 'assets/images/kusa.png', ans: 'くさ' },
        { id: 'kyuuri', img: 'assets/images/kyuuri.png', ans: 'きゅうり' },
        { id: 'lip', img: 'assets/images/lip.png', ans: 'りっぷ' },
        { id: 'maiku', img: 'assets/images/maiku.png', ans: 'まいく' },
        { id: 'mango', img: 'assets/images/mango.png', ans: 'まんごー' },
        { id: 'maru', img: 'assets/images/maru.png', ans: 'まる' },
        { id: 'matcha', img: 'assets/images/matcha.png', ans: 'まっちゃ' },
        { id: 'medaka', img: 'assets/images/medaka.png', ans: 'めだか' },
        { id: 'medamayaki', img: 'assets/images/medamayaki.png', ans: 'めだまやき' },
        { id: 'membo', img: 'assets/images/membo.png', ans: 'めんぼう' },
        { id: 'memo', img: 'assets/images/memo.png', ans: 'めも' },
        { id: 'migi', img: 'assets/images/migi.png', ans: 'みぎ' },
        { id: 'mint', img: 'assets/images/mint.png', ans: 'みんと' },
        { id: 'miso', img: 'assets/images/miso.png', ans: 'みそ' },
        { id: 'misoshiru', img: 'assets/images/misoshiru.png', ans: 'みそしる' },
        { id: 'mogura', img: 'assets/images/mogura.png', ans: 'もぐら' },
        { id: 'mugi', img: 'assets/images/mugi.png', ans: 'むぎ' },
        { id: 'murasaki', img: 'assets/images/murasaki.png', ans: 'むらさき' },
        { id: 'namako', img: 'assets/images/namako.png', ans: 'なまこ' },
        { id: 'natto', img: 'assets/images/natto.png', ans: 'なっとう' },
        { id: 'nendo', img: 'assets/images/nendo.png', ans: 'ねんど' },
        { id: 'ni', img: 'assets/images/ni.png', ans: 'に' },
        { id: 'nihon', img: 'assets/images/nihon.png', ans: 'にほん' },
        { id: 'niji', img: 'assets/images/niji.png', ans: 'にじ' },
        { id: 'niku', img: 'assets/images/niku.png', ans: 'にく' },
        { id: 'ningyo', img: 'assets/images/ningyo.png', ans: 'にんぎょ' },
        { id: 'ninjin', img: 'assets/images/ninjin.png', ans: 'にんじん' },
        { id: 'ninniku', img: 'assets/images/ninniku.png', ans: 'にんにく' },
        { id: 'niwatori', img: 'assets/images/niwatori.png', ans: 'にわとり' },
        { id: 'nokogiri', img: 'assets/images/nokogiri.png', ans: 'のこぎり' },
        { id: 'norimono', img: 'assets/images/norimono.png', ans: 'のりもの' },
        { id: 'nuno', img: 'assets/images/nuno.png', ans: 'ぬの' },
        { id: 'okami', img: 'assets/images/okami.png', ans: 'おおかみ' },
        { id: 'okane', img: 'assets/images/okane.png', ans: 'おかね' },
        { id: 'ompu', img: 'assets/images/ompu.png', ans: 'おんぷ' },
        { id: 'omuretsu', img: 'assets/images/omuretsu.png', ans: 'おむれつ' },
        { id: 'omurice', img: 'assets/images/omurice.png', ans: 'おむらいす' },
        { id: 'onnanoko', img: 'assets/images/onnanoko.png', ans: 'おんなのこ' },
        { id: 'ono', img: 'assets/images/ono.png', ans: 'おの' },
        { id: 'orenji', img: 'assets/images/orenji.png', ans: 'おれんじ' },
        { id: 'ori', img: 'assets/images/ori.png', ans: 'おり' },
        { id: 'origami', img: 'assets/images/origami.png', ans: 'おりがみ' },
        { id: 'osake', img: 'assets/images/osake.png', ans: 'おさけ' },
        { id: 'osara', img: 'assets/images/osara.png', ans: 'おさら' },
        { id: 'otera', img: 'assets/images/otera.png', ans: 'おてら' },
        { id: 'otokonoko', img: 'assets/images/otokonoko.png', ans: 'おとこのこ' },
        { id: 'ousama', img: 'assets/images/ousama.png', ans: 'おうさま' },
        { id: 'panda', img: 'assets/images/panda.png', ans: 'ぱんだ' },
        { id: 'pink', img: 'assets/images/pink.png', ans: 'ぴんく' },
        { id: 'racket', img: 'assets/images/racket.png', ans: 'らけっと' },
        { id: 'radio', img: 'assets/images/radio.png', ans: 'らじお' },
        { id: 'rakko', img: 'assets/images/rakko.png', ans: 'らっこ' },
        { id: 'rakuda', img: 'assets/images/rakuda.png', ans: 'らくだ' },
        { id: 'randoseru', img: 'assets/images/randoseru.png', ans: 'らんどせる' },
        { id: 'remon', img: 'assets/images/remon.png', ans: 'れもん' },
        { id: 'rika', img: 'assets/images/rika.png', ans: 'りか' },
        { id: 'rikishi', img: 'assets/images/rikishi.png', ans: 'りきし' },
        { id: 'roba', img: 'assets/images/roba.png', ans: 'ろば' },
        { id: 'robotto', img: 'assets/images/robotto.png', ans: 'ろぼっと' },
        { id: 'rocket', img: 'assets/images/rocket.png', ans: 'ろけっと' },
        { id: 'rosoku', img: 'assets/images/rosoku.png', ans: 'ろうそく' },
        { id: 'ruby', img: 'assets/images/ruby.png', ans: 'るびー' },
        { id: 'rugby', img: 'assets/images/rugby.png', ans: 'らぐびー' },
        { id: 'ruiji', img: 'assets/images/ruiji.png', ans: 'るいじ' },
        { id: 'runba', img: 'assets/images/runba.png', ans: 'るんば' },
        { id: 'ruri', img: 'assets/images/ruri.png', ans: 'るり' },
        { id: 'ruribitaki', img: 'assets/images/ruribitaki.png', ans: 'るりびたき' },
        { id: 'ryoko', img: 'assets/images/ryoko.png', ans: 'りょこう' },
        { id: 'saifu', img: 'assets/images/saifu.png', ans: 'さいふ' },
        { id: 'saikoro', img: 'assets/images/saikoro.png', ans: 'さいころ' },
        { id: 'sakurambo', img: 'assets/images/sakurambo.png', ans: 'さくらんぼ' },
        { id: 'samui', img: 'assets/images/samui.png', ans: 'さむい' },
        { id: 'san', img: 'assets/images/san.png', ans: 'さん' },
        { id: 'sankaku', img: 'assets/images/sankaku.png', ans: 'さんかく' },
        { id: 'sashimi', img: 'assets/images/sashimi.png', ans: 'さしみ' },
        { id: 'sato', img: 'assets/images/sato.png', ans: 'さとう' },
        { id: 'sazae', img: 'assets/images/sazae.png', ans: 'さざえ' },
        { id: 'senpuki', img: 'assets/images/senpuki.png', ans: 'せんぷうき' },
        { id: 'sensei', img: 'assets/images/sensei.png', ans: 'せんせい' },
        { id: 'sentakuki', img: 'assets/images/sentakuki.png', ans: 'せんたくき' },
        { id: 'seta', img: 'assets/images/seta.png', ans: 'せーたー' },
        { id: 'shachi', img: 'assets/images/shachi.png', ans: 'しゃち' },
        { id: 'shatsu', img: 'assets/images/shatsu.png', ans: 'しゃつ' },
        { id: 'shikaku', img: 'assets/images/shikaku.png', ans: 'しかく' },
        { id: 'shima', img: 'assets/images/shima.png', ans: 'しま' },
        { id: 'shimauma', img: 'assets/images/shimauma.png', ans: 'しまうま' },
        { id: 'shingou', img: 'assets/images/shingou.png', ans: 'しんごう' },
        { id: 'shinzo', img: 'assets/images/shinzo.png', ans: 'しんぞう' },
        { id: 'shio', img: 'assets/images/shio.png', ans: 'しお' },
        { id: 'shirokuma', img: 'assets/images/shirokuma.png', ans: 'しろくま' },
        { id: 'shiso', img: 'assets/images/shiso.png', ans: 'しそ' },
        { id: 'shita', img: 'assets/images/shita.png', ans: 'した' },
        { id: 'shoyu', img: 'assets/images/shoyu.png', ans: 'しょうゆ' },
        { id: 'shukudai', img: 'assets/images/shukudai.png', ans: 'しゅくだい' },
        { id: 'skate', img: 'assets/images/skate.png', ans: 'すけーと' },
        { id: 'ski', img: 'assets/images/ski.png', ans: 'すきー' },
        { id: 'slime', img: 'assets/images/slime.png', ans: 'すらいむ' },
        { id: 'slipper', img: 'assets/images/slipper.png', ans: 'すりっぱー' },
        { id: 'sojiki', img: 'assets/images/sojiki.png', ans: 'そうじき' },
        { id: 'sora', img: 'assets/images/sora.png', ans: 'そら' },
        { id: 'soramame', img: 'assets/images/soramame.png', ans: 'そらまめ' },
        { id: 'speaker', img: 'assets/images/speaker.png', ans: 'すぴーかー' },
        { id: 'steak', img: 'assets/images/steak.png', ans: 'すてーき' },
        { id: 'suberidai', img: 'assets/images/suberidai.png', ans: 'すべりだい' },
        { id: 'suiei', img: 'assets/images/suiei.png', ans: 'すいえい' },
        { id: 'suisha', img: 'assets/images/suisha.png', ans: 'すいしゃ' },
        { id: 'suito', img: 'assets/images/suito.png', ans: 'すいとう' },
        { id: 'sukiyaki', img: 'assets/images/sukiyaki.png', ans: 'すきやき' },
        { id: 'sumaho', img: 'assets/images/sumaho.png', ans: 'すまほ' },
        { id: 'sumi', img: 'assets/images/sumi.png', ans: 'すみ' },
        { id: 'sumo', img: 'assets/images/sumo.png', ans: 'すもう' },
        { id: 'sunahama', img: 'assets/images/sunahama.png', ans: 'すなはま' },
        { id: 'suzu', img: 'assets/images/suzu.png', ans: 'すず' },
        { id: 'suzume', img: 'assets/images/suzume.png', ans: 'すずめ' },
        { id: 'tai', img: 'assets/images/tai.png', ans: 'たい' },
        { id: 'taiko', img: 'assets/images/taiko.png', ans: 'たいこ' },
        { id: 'taiya', img: 'assets/images/taiya.png', ans: 'たいや' },
        { id: 'taiyaki', img: 'assets/images/taiyaki.png', ans: 'たいやき' },
        { id: 'taiyo', img: 'assets/images/taiyo.png', ans: 'たいよう' },
        { id: 'takara', img: 'assets/images/takara.png', ans: 'たから' },
        { id: 'take', img: 'assets/images/take.png', ans: 'たけ' },
        { id: 'takenoko', img: 'assets/images/takenoko.png', ans: 'たけのこ' },
        { id: 'taki', img: 'assets/images/taki.png', ans: 'たき' },
        { id: 'takoyaki', img: 'assets/images/takoyaki.png', ans: 'たこやき' },
        { id: 'tambo', img: 'assets/images/tambo.png', ans: 'たんば' },
        { id: 'tape', img: 'assets/images/tape.png', ans: 'てーぷ' },
        { id: 'tatami', img: 'assets/images/tatami.png', ans: 'たたみ' },
        { id: 'tate', img: 'assets/images/tate.png', ans: 'たて' },
        { id: 'taxi', img: 'assets/images/taxi.png', ans: 'たくしー' },
        { id: 'tebukuro', img: 'assets/images/tebukuro.png', ans: 'てぶくろ' },
        { id: 'tegami', img: 'assets/images/tegami.png', ans: 'てがみ' },
        { id: 'tempura', img: 'assets/images/tempura.png', ans: 'てんぷら' },
        { id: 'tento', img: 'assets/images/tento.png', ans: 'てんと' },
        { id: 'terebi', img: 'assets/images/terebi.png', ans: 'テレビ' },
        { id: 'teruteru', img: 'assets/images/teruteru.png', ans: 'てるてる' },
        { id: 'togarashi', img: 'assets/images/togarashi.png', ans: 'とうがらし' },
        { id: 'toilet', img: 'assets/images/toilet.png', ans: 'といれ' },
        { id: 'tokage', img: 'assets/images/tokage.png', ans: 'とかげ' },
        { id: 'tokei', img: 'assets/images/tokei.png', ans: 'とけい' },
        { id: 'tomato', img: 'assets/images/tomato.png', ans: 'とまと' },
        { id: 'tomodachi', img: 'assets/images/tomodachi.png', ans: 'ともだち' },
        { id: 'tonakai', img: 'assets/images/tonakai.png', ans: 'となかい' },
        { id: 'tora', img: 'assets/images/tora.png', ans: 'とら' },
        { id: 'toshoshitsu', img: 'assets/images/toshoshitsu.png', ans: 'としょしつ' },
        { id: 'towel', img: 'assets/images/towel.png', ans: 'たおる' },
        { id: 'truck', img: 'assets/images/truck.png', ans: 'とらっく' },
        { id: 'trump', img: 'assets/images/trump.png', ans: 'とらんぷ' },
        { id: 'tsuchi', img: 'assets/images/tsuchi.png', ans: 'つち' },
        { id: 'tsue', img: 'assets/images/tsue.png', ans: 'つえ' },
        { id: 'tsumiki', img: 'assets/images/tsumiki.png', ans: 'つみき' },
        { id: 'tsuri', img: 'assets/images/tsuri.png', ans: 'つり' },
        { id: 'tuna', img: 'assets/images/tuna.png', ans: 'つな' },
        { id: 'tunnel', img: 'assets/images/tunnel.png', ans: 'とんねる' },
        { id: 'uchiwa', img: 'assets/images/uchiwa.png', ans: 'うちわ' },
        { id: 'udon', img: 'assets/images/udon.png', ans: 'うどん' },
        { id: 'ue', img: 'assets/images/ue.png', ans: 'うえ' },
        { id: 'ukiwa', img: 'assets/images/ukiwa.png', ans: 'うきわ' },
        { id: 'ume', img: 'assets/images/ume.png', ans: 'うめ' },
        { id: 'wakame', img: 'assets/images/wakame.png', ans: 'わかめ' },
        { id: 'wani', img: 'assets/images/wani.png', ans: 'わに' },
        { id: 'yokai', img: 'assets/images/yokai.png', ans: 'ようかい' },
        { id: 'yon', img: 'assets/images/yon.png', ans: 'よん' },
        { id: 'yoshizu', img: 'assets/images/yoshizu.png', ans: 'よしず' },
        { id: 'you', img: 'assets/images/you.png', ans: 'よう' },
        { id: 'yubiwa', img: 'assets/images/yubiwa.png', ans: 'ゆびわ' },
        { id: 'yuki', img: 'assets/images/yuki.png', ans: 'ゆき' },
        { id: 'zaru', img: 'assets/images/zaru.png', ans: 'ざる' },
        { id: 'zarusoba', img: 'assets/images/zarusoba.png', ans: 'ざるそば' },
        // 漢字が含まれる可能性のある画像名だが、平仮名読みを当てているもの
        { id: 'kyokasho', img: 'assets/images/kyokasho.png', ans: 'きょうかしょ' },
        { id: 'kyoryu', img: 'assets/images/kyoryu.png', ans: 'きょうりゅう' },
        { id: 'kyu', img: 'assets/images/kyu.png', ans: 'きゅう' },
        { id: 'goku', img: 'assets/images/goku.png', ans: 'ごくう' },
        { id: 'mali', img: 'assets/images/mali.png', ans: 'まり' },
        { id: 'mario', img: 'assets/images/mario.png', ans: 'まりお' },
        { id: 'puccho', img: 'assets/images/puccho.jpg', ans: 'ぷっちょ' },
        { id: 'chibimaruko', img: 'assets/images/chibimaruko.png', ans: 'ちびまるこ' },
        { id: 'chirashizushi', img: 'assets/images/chirashizushi.png', ans: 'ちらしずし' },
        { id: 'ebichiri', img: 'assets/images/ebichiri.png', ans: 'えびちり' },
        { id: 'ei', img: 'assets/images/ei.png', ans: 'えい' },
        { id: 'hitode', img: 'assets/images/hitode.png', ans: 'ひとで' },
        { id: 'ikura', img: 'assets/images/ikura.png', ans: 'いくら' },
        { id: 'inosuke', img: 'assets/images/inosuke.png', ans: 'いのすけ' },
        { id: 'kamisama', img: 'assets/images/kamisama.png', ans: 'かみさま' },
        { id: 'kangaroo', img: 'assets/images/kangaroo.png', ans: 'かんがるー' },
        { id: 'kimuchi', img: 'assets/images/kimuchi.png', ans: 'きむち' },
        { id: 'muaythai', img: 'assets/images/muaythai.png', ans: 'むえたい' },
        { id: 'nike', img: 'assets/images/nike.png', ans: 'ないき' },
        { id: 'nobita', img: 'assets/images/nobita.png', ans: 'のびた' },
        { id: 'suneo', img: 'assets/images/suneo.png', ans: 'すねお' },
        { id: 'wario', img: 'assets/images/wario.png', ans: 'わりお' },
        { id: 'fish_mola2', img: 'assets/images/fish_mola2.png', ans: 'まんぼう' }
    ].filter(item => item.ans.length >= 2 && item.ans.length <= 6); // 2〜6文字の単語に限定（スロット表示のため）


    // --- ゲームクラス ---
    class SortGame {
        constructor() {
            this.questions = [];
            this.currentQIndex = 0;
            this.score = 0;
            this.currentSlots = []; // 現在の入力状態

            // DOM
            this.menuArea = document.getElementById('main-menu-2');
            this.gameArea = document.getElementById('game-area-2');
            this.imgArea = document.getElementById('image-area');
            this.slotArea = document.getElementById('answer-container');
            this.poolArea = document.getElementById('pool-container');
            this.feedback = document.getElementById('feedback');
            this.scoreVal = document.getElementById('score-val');
            this.turnMsg = document.getElementById('turn-msg');

            this.sndCorrect = document.getElementById('snd-correct');
            this.sndIncorrect = document.getElementById('snd-incorrect');
            this.sndFanfare = document.getElementById('snd-fanfare');
        }

        start() {
            // 問題をシャッフルしてセット (10問に限定)
            this.questions = [...QUESTIONS].sort(() => Math.random() - 0.5).slice(0, 10);
            this.currentQIndex = 0;
            this.score = 0;
            this.scoreVal.textContent = 0;
            
            this.menuArea.style.display = 'none';
            this.gameArea.style.display = 'block';
            this.nextQuestion();
        }

        nextQuestion() {
            if (this.currentQIndex >= this.questions.length) {
                this.finishGame();
                return;
            }

            this.feedback.textContent = '';
            this.feedback.style.color = '#333';
            this.turnMsg.textContent = `問 ${this.currentQIndex + 1} / ${this.questions.length}`;

            const q = this.questions[this.currentQIndex];
            
            // 画像
            const img = new Image();
            img.src = q.img;
            // エラー時のフォールバック画像
            img.onerror = () => { img.src = 'https://placehold.co/180x180/ef5350/ffffff?text=' + q.ans; }; 
            this.imgArea.innerHTML = '';
            this.imgArea.appendChild(img);

            // スロット準備
            this.slotArea.innerHTML = '';
            const length = q.ans.length;
            this.currentSlots = new Array(length).fill(null);

            for(let i=0; i<length; i++) {
                const slot = document.createElement('div');
                slot.className = 'drop-slot';
                slot.dataset.index = i;
                slot.onclick = () => this.handleSlotClick(i);
                this.slotArea.appendChild(slot);
            }

            // 文字プール準備 (シャッフル)
            this.poolArea.innerHTML = '';
            const chars = q.ans.split('').sort(() => Math.random() - 0.5);
            
            chars.forEach((char, idx) => {
                const piece = document.createElement('div');
                piece.className = 'char-piece';
                piece.textContent = char;
                piece.dataset.char = char;
                piece.dataset.id = idx; // 一意にする
                piece.onclick = () => this.handlePoolClick(piece, char, idx);
                this.poolArea.appendChild(piece);
            });
        }

        // プールの文字をクリックした時 -> 最初の空きスロットへ
        handlePoolClick(piece, char, id) {
            if (piece.classList.contains('used')) return;

            // 空きスロットを探す
            const emptyIndex = this.currentSlots.findIndex(val => val === null);
            if (emptyIndex !== -1) {
                this.currentSlots[emptyIndex] = { char: char, poolId: id };
                piece.classList.add('used'); // プール側は薄くする
                this.renderSlots();
            }
        }

        // スロットをクリックした時 -> プールに戻す
        handleSlotClick(index) {
            const data = this.currentSlots[index];
            if (data) {
                // プールの該当ピースを復活させる
                const pieces = this.poolArea.querySelectorAll('.char-piece');
                pieces.forEach(p => {
                    if (p.dataset.id == data.poolId) {
                        p.classList.remove('used');
                    }
                });

                this.currentSlots[index] = null;
                this.renderSlots();
            }
        }

        renderSlots() {
            const slots = this.slotArea.querySelectorAll('.drop-slot');
            slots.forEach((slot, i) => {
                const data = this.currentSlots[i];
                if (data) {
                    slot.textContent = data.char;
                    slot.classList.add('filled');
                } else {
                    slot.textContent = '';
                    slot.classList.remove('filled');
                }
            });
        }

        checkAnswer() {
            // まだ埋まってない？
            if (this.currentSlots.includes(null)) {
                this.feedback.textContent = 'まだ あいている ところが あるよ！';
                this.feedback.style.color = 'orange';
                return;
            }

            const playerAns = this.currentSlots.map(d => d.char).join('');
            const correctAns = this.questions[this.currentQIndex].ans;

            if (playerAns === correctAns) {
                this.sndCorrect.currentTime = 0; this.sndCorrect.play().catch(e=>{});
                this.feedback.textContent = 'せいかい！';
                this.feedback.style.color = 'var(--correct-color)';
                this.score += 1;
                this.scoreVal.textContent = this.score;

                setTimeout(() => {
                    this.currentQIndex++;
                    this.nextQuestion();
                }, 1500);

            } else {
                this.sndIncorrect.currentTime = 0; this.sndIncorrect.play().catch(e=>{});
                this.feedback.textContent = 'おしい！ ちょっとちがうかも？';
                this.feedback.style.color = 'var(--incorrect-color)';
            }
        }

        async finishGame() {
            this.imgArea.innerHTML = '<i class="fa-solid fa-crown" style="font-size:5em; color:#ffd700;"></i>';
            this.slotArea.innerHTML = '';
            this.poolArea.innerHTML = '';
            
            this.feedback.innerHTML = `おしまい！<br><span style="font-size:1.5em">${this.score}てん！</span>`;
            this.feedback.style.color = 'var(--primary)';
            
            this.sndFanfare.currentTime = 0;
            this.sndFanfare.play().catch(e=>{});

            // ★★★ Firebaseポイント加算 ★★★
            const finalScore = this.score;
            if (finalScore > 0) {
                const success = await addPointsToUser(finalScore); 
                if (success) {
                    this.feedback.innerHTML += '<br><span style="font-size:0.8em; color:var(--correct-color);">ポイントを記録しました！</span>';
                } else if (currentUserId) {
                     this.feedback.innerHTML += '<br><span style="font-size:0.8em; color:var(--incorrect-color);">ポイント登録エラーが発生しました。</span>';
                } else {
                     this.feedback.innerHTML += '<br><span style="font-size:0.8em; color:#999;">ポイントは記録されません (ゲストモード)。</span>';
                }
            }

            // リトライボタン
            setTimeout(() => {
                const btn = document.createElement('button');
                btn.className = 'start-btn';
                btn.textContent = 'もういちど';
                btn.onclick = () => location.reload();
                this.poolArea.appendChild(btn); // 場所借り
            }, 1000);
        }
    }

    window.game = new SortGame();

    // プリロード
    QUESTIONS.forEach(q => { const i = new Image(); i.src = q.img; });

</script>
</body>
</html>