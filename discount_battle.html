<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>å‰²å¼•è¨ˆç®—ãƒãƒˆãƒ« - Discount Battle</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<link href="https://fonts.googleapis.com/css2?family=Zen+Maru+Gothic:wght@400;700;900&display=swap" rel="stylesheet">

<style>
    /* --- å…±é€šè¨­å®š (ãƒ¡ã‚¤ãƒ³ã‚³ãƒ¼ãƒ‰æº–æ‹ ) --- */
    :root {
        --primary: #5c7aff;
        --accent: #ffcc5c;
        --bg-color: #f4f7fc;
        --text-color: #333;
        --sticker-red: #d32f2f; /* åŠé¡ã‚·ãƒ¼ãƒ«ãªã©ã®èµ¤ */
        --sticker-yellow: #fdd835;
        --card-bg: #ffffff;
        --display-border: #1565c0; /* æ¿ƒã„é’ */
    }

    *, *::before, *::after { box-sizing: border-box; }

    body {
        font-family: 'Zen Maru Gothic', sans-serif;
        background-color: var(--bg-color);
        color: var(--text-color);
        margin: 0; padding: 0; padding-bottom: 100px;
        min-height: 100vh;
        -webkit-tap-highlight-color: transparent;
        display: flex; flex-direction: column;
    }

    /* ãƒ˜ãƒƒãƒ€ãƒ¼ */
    header {
        background: linear-gradient(135deg, #5c7aff 0%, #4facfe 100%);
        color: white; padding: 15px 20px; width: 100%;
        display: flex; justify-content: space-between; align-items: center;
        box-shadow: 0 4px 15px rgba(92, 122, 255, 0.3);
        position: sticky; top: 0; z-index: 100;
    }
    .logo { font-size: 1.2em; font-weight: 900; display: flex; align-items: center; gap: 10px; text-decoration: none; color: white; }
    
    /* ç”»é¢ã‚³ãƒ³ãƒ†ãƒŠ */
    .screen { display: none; padding: 20px; width: 100%; max-width: 600px; margin: 0 auto; animation: fadeIn 0.4s ease-out; }
    .screen.active { display: block; }
    @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

    /* æˆ»ã‚‹ãƒœã‚¿ãƒ³ */
    .btn-back-nav {
        background: rgba(255,255,255,0.2); border: 1px solid rgba(255,255,255,0.5);
        color: white; padding: 5px 12px; border-radius: 20px; cursor: pointer; font-size: 0.9em; font-weight: bold;
    }

    /* --- 1. å­¦ç¿’ãƒšãƒ¼ã‚¸ (Practice) --- */
    .learning-card {
        background: white; border-radius: 15px; padding: 20px; margin-bottom: 20px;
        box-shadow: 0 4px 10px rgba(0,0,0,0.05); border-left: 6px solid var(--primary);
    }
    .learning-title { font-weight: 900; font-size: 1.2em; margin-bottom: 10px; display: flex; align-items: center; gap: 10px; }
    .sticker-example {
        display: inline-block; background: var(--sticker-red); color: white;
        padding: 5px 10px; border-radius: 50%; font-weight: 900; transform: rotate(-10deg);
        box-shadow: 2px 2px 5px rgba(0,0,0,0.2); border: 2px solid white;
    }
    .sticker-yellow { background: var(--sticker-yellow); color: #d32f2f; }
    
    .example-list {
        background:#f9f9f9; padding:15px; border-radius:10px; 
        display: flex; flex-direction: column; gap: 8px;
    }
    .example-item {
        display: flex; justify-content: space-between; border-bottom: 1px dashed #ddd; padding-bottom: 5px; font-weight: bold;
    }
    .example-item:last-child { border-bottom: none; padding-bottom: 0; }

    /* --- 2. ãƒ¬ãƒ™ãƒ«é¸æŠ (Level Select) --- */
    .level-grid {
        display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px; margin-top: 20px;
    }
    .level-btn {
        background: white; border-radius: 20px; padding: 20px; text-align: center;
        box-shadow: 0 5px 15px rgba(0,0,0,0.05); border: 3px solid transparent;
        cursor: pointer; transition: all 0.2s; position: relative; overflow: hidden;
    }
    .level-btn:active { transform: scale(0.95); }
    .level-icon { font-size: 2.5em; margin-bottom: 10px; display: block; }
    .level-badge {
        position: absolute; top: 0; right: 0; background: var(--accent);
        color: #d35400; font-size: 0.7em; padding: 3px 10px; border-radius: 0 0 0 10px; font-weight: bold;
    }

    /* --- 3. ã‚²ãƒ¼ãƒ ç”»é¢ (3D Product Card) --- */
    .game-area {
        display: flex; flex-direction: column; align-items: center; margin-bottom: 20px;
    }
    
    /* å•†å“ã‚«ãƒ¼ãƒ‰ (3Dè¡¨ç¾) */
    .product-card-container {
        perspective: 1000px; width: 100%; max-width: 300px; margin: 20px auto;
    }
    .product-card {
        background: white; border-radius: 20px; padding: 20px;
        box-shadow: 0 15px 35px rgba(0,0,0,0.1), 0 5px 15px rgba(0,0,0,0.05);
        position: relative; text-align: center;
        transform-style: preserve-3d;
        transform: rotateX(5deg); /* å°‘ã—ä¸Šå‘ã */
        border: 1px solid #eee;
    }
    .product-img { font-size: 4em; margin-bottom: 10px; display: block; text-shadow: 0 5px 10px rgba(0,0,0,0.1); }
    .product-name { font-weight: bold; font-size: 1.2em; color: #555; margin-bottom: 5px; }
    
    /* å€¤æœ­ */
    .price-tag {
        font-size: 1.5em; font-weight: 900; color: #333;
        text-decoration: line-through; decoration-thickness: 3px; text-decoration-color: #aaa;
    }

    /* å‰²å¼•ã‚·ãƒ¼ãƒ« (ãƒªã‚¢ãƒ«ãªè¡¨ç¾) */
    .discount-sticker {
        position: absolute; bottom: 10px; right: -10px;
        width: 90px; height: 90px;
        background: radial-gradient(circle at 30% 30%, #ff5252, #d32f2f);
        color: white; border-radius: 50%;
        display: flex; flex-direction: column; justify-content: center; align-items: center;
        font-weight: 900; box-shadow: 2px 5px 10px rgba(0,0,0,0.3);
        border: 3px solid white;
        transform: rotate(-15deg) translateZ(20px); /* æµ®ãä¸ŠãŒã‚‰ã›ã‚‹ */
        z-index: 10;
        animation: stickOn 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
    }
    @keyframes stickOn { from { transform: rotate(-15deg) scale(2); opacity: 0; } to { transform: rotate(-15deg) scale(1); opacity: 1; } }
    
    .sticker-text-main { font-size: 1.6em; line-height: 1; text-shadow: 1px 1px 0 rgba(0,0,0,0.2); }
    .sticker-text-sub { font-size: 0.7em; }

    /* é›»å“ã‚­ãƒ¼ãƒ‘ãƒƒãƒ‰ (ãƒ‡ã‚¶ã‚¤ãƒ³ä¿®æ­£ï¼šç™½æŠœããƒ»é’æ ãƒ»ä¸­å¤®å¯„ã›) */
    .calc-display {
        background: #fff; /* ç™½æŠœã */
        color: #333; /* æ–‡å­—ã¯é»’ */
        border: 3px solid var(--display-border); /* æ¿ƒã„ã‚ã®é’æ  */
        font-family: 'Courier New', monospace;
        font-size: 2em; padding: 10px 20px; border-radius: 10px; 
        width: 100%; max-width: 320px;
        text-align: right; margin: 0 auto 20px auto; /* ä¸­å¤®å¯„ã› */
        box-shadow: inset 0 2px 5px rgba(0,0,0,0.05);
        height: 60px; display: flex; align-items: center; justify-content: flex-end;
    }
    
    .numpad {
        display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px;
        width: 100%; max-width: 320px; margin: 0 auto;
    }
    .num-btn {
        background: white; border: none; padding: 15px; border-radius: 15px;
        font-size: 1.5em; font-weight: bold; color: #555;
        box-shadow: 0 4px 0 #ddd; cursor: pointer;
        touch-action: manipulation;
    }
    .num-btn:active { transform: translateY(3px); box-shadow: 0 1px 0 #ddd; }
    .btn-clear { background: #ef5350; color: white; box-shadow: 0 4px 0 #c62828; }
    .btn-enter { background: var(--primary); color: white; box-shadow: 0 4px 0 #3949ab; grid-column: span 3; }

    /* ãƒ—ãƒ­ã‚°ãƒ¬ã‚¹ãƒãƒ¼ */
    .progress-container { width: 100%; background: #eee; height: 10px; border-radius: 5px; margin-bottom: 10px; }
    .progress-bar { height: 100%; background: var(--primary); width: 0%; transition: width 0.3s; border-radius: 5px; }

    /* å›ºå®šãƒ•ãƒƒã‚¿ãƒ¼ (ã‚¹ã‚¿ãƒ¼ãƒˆãƒœã‚¿ãƒ³) */
    .fixed-footer {
        position: fixed; bottom: 0; left: 0; width: 100%;
        background: white; padding: 15px;
        box-shadow: 0 -4px 15px rgba(0,0,0,0.1); text-align: center; z-index: 200;
    }
    .btn-start {
        background: var(--primary); color: white; border: none;
        padding: 15px 40px; border-radius: 50px; font-weight: 900; font-size: 1.2em;
        width: 100%; max-width: 300px; cursor: pointer; box-shadow: 0 4px 0 #3949ab;
        display: inline-flex; align-items: center; justify-content: center; gap: 10px;
    }
    .btn-start:active { transform: translateY(3px); box-shadow: none; }

    /* çµæœç”»é¢ */
    .result-score { font-size: 3em; color: var(--primary); font-weight: 900; }
    .result-msg { font-size: 1.2em; margin-bottom: 20px; }

</style>
</head>
<body>

<header>
    <a href="index.html" class="logo"><i class="fa-solid fa-calculator"></i> å‰²å¼•è¨ˆç®—ãƒãƒˆãƒ«</a>
    <button class="btn-back-nav" onclick="goBack()"><i class="fa-solid fa-arrow-left"></i> ã‚‚ã©ã‚‹</button>
</header>

<div id="screen-practice" class="screen active">
    <div style="text-align:center; margin-bottom:20px;">
        <h2><i class="fa-solid fa-book-open"></i> ãƒ«ãƒ¼ãƒ«ã‚’ãŠã¼ãˆã‚ˆã†</h2>
        <p>æ—¥æœ¬ã®ã‚¹ãƒ¼ãƒ‘ãƒ¼ã‚„ãŠåº—ã§è¦‹ã‹ã‘ã‚‹ã€Œå‰²å¼•ï¼ˆã‚ã‚Šã³ãï¼‰ã€ã®è¨ˆç®—æ–¹æ³•ã§ã™ã€‚</p>
    </div>

    <div class="learning-card">
        <div class="learning-title">
            <span class="sticker-example">åŠé¡</span> = 50% OFF
        </div>
        <p>å€¤æ®µãŒåŠåˆ†ã«ãªã‚Šã¾ã™ã€‚ã€ŒÃ·2ã€ã‚’ã—ã¾ã™ã€‚</p>
        <div class="example-list">
            <div class="example-item"><span>200å††</span> <span>â†’ 100å††</span></div>
            <div class="example-item"><span>500å††</span> <span>â†’ 250å††</span></div>
            <div class="example-item"><span>1200å††</span> <span>â†’ 600å††</span></div>
        </div>
    </div>

    <div class="learning-card">
        <div class="learning-title">
            <span class="sticker-example sticker-yellow">20%å¼•</span> = 20% OFF
        </div>
        <p>å€¤æ®µã®80%ã«ãªã‚Šã¾ã™ã€‚ã€ŒÃ—0.8ã€ã‚’ã—ã¾ã™ã€‚</p>
        <p style="font-size:0.9em; color:#777;">ãƒ’ãƒ³ãƒˆ: 10% (1å‰²) ã‚’è¨ˆç®—ã—ã¦ã€ãã‚Œã‚’å¼•ãã¨ç°¡å˜ã§ã™ã€‚</p>
        <div class="example-list">
            <div class="example-item"><span>1000å††</span> <span>â†’ 800å††</span></div>
            <div class="example-item"><span>500å††</span> <span>â†’ 400å††</span></div>
            <div class="example-item"><span>100å††</span> <span>â†’ 80å††</span></div>
        </div>
    </div>

    <div class="learning-card">
        <div class="learning-title">
            <span class="sticker-example sticker-yellow">3å‰²å¼•</span> = 30% OFF
        </div>
        <p>ã€Œå‰² (Wari)ã€ã¯ 10% ã®ã“ã¨ã§ã™ã€‚</p>
        <ul style="font-weight:bold; font-size:0.9em; margin-bottom:10px;">
            <li>1å‰² (ichi-wari) = 10%</li>
            <li>3å‰² (san-wari) = 30%</li>
        </ul>
        <div class="example-list">
            <div class="example-item"><span>100å††</span> <span>â†’ 70å††</span></div>
            <div class="example-item"><span>2000å††</span> <span>â†’ 1400å††</span></div>
            <div class="example-item"><span>500å††</span> <span>â†’ 350å††</span></div>
        </div>
    </div>
    
    <div style="height:60px;"></div>
</div>

<div id="footer-start" class="fixed-footer">
    <button class="btn-start" onclick="showScreen('screen-level')">
        ã‚²ãƒ¼ãƒ ã‚¹ã‚¿ãƒ¼ãƒˆï¼ <i class="fa-solid fa-gamepad"></i>
    </button>
</div>


<div id="screen-level" class="screen">
    <h2 style="text-align:center;">ãƒ¬ãƒ™ãƒ«ã‚’é¸ã‚“ã§ã­</h2>
    <div class="level-grid">
        <div class="level-btn" onclick="startGame(1)" style="border-bottom: 4px solid #4caf50;">
            <span class="level-badge" style="background:#4caf50; color:white;">EASY</span>
            <i class="fa-solid fa-tag level-icon" style="color:#4caf50;"></i>
            <h3>åŠé¡ãƒãƒ³ã‚¿ãƒ¼</h3>
            <p style="font-size:0.8em; color:#777;">ã€ŒåŠé¡ã€ã®å•é¡Œã ã‘ãŒå‡ºã¾ã™ã€‚</p>
        </div>
        <div class="level-btn" onclick="startGame(2)" style="border-bottom: 4px solid #ff9800;">
            <span class="level-badge" style="background:#ff9800; color:white;">NORMAL</span>
            <i class="fa-solid fa-percent level-icon" style="color:#ff9800;"></i>
            <h3>ãƒ‘ãƒ¼ã‚»ãƒ³ãƒˆè¨ˆç®—</h3>
            <p style="font-size:0.8em; color:#777;">10%, 20% OFFãªã©ã®å•é¡Œã€‚</p>
        </div>
        <div class="level-btn" onclick="startGame(3)" style="border-bottom: 4px solid #f44336;">
            <span class="level-badge" style="background:#f44336; color:white;">HARD</span>
            <i class="fa-solid fa-calculator level-icon" style="color:#f44336;"></i>
            <h3>ã€Œå‰²ã€ãƒã‚¹ã‚¿ãƒ¼</h3>
            <p style="font-size:0.8em; color:#777;">ã€Œ2å‰²å¼•ãã€ã€ŒåŠé¡ã€ãªã©ãŒæ··ã–ã‚Šã¾ã™ã€‚</p>
        </div>
    </div>
</div>


<div id="screen-game" class="screen">
    <div style="display:flex; justify-content:space-between; margin-bottom:5px; font-weight:bold;">
        <span>Lv.<span id="current-level-display">1</span></span>
        <span>Q <span id="q-current">1</span> / 10</span>
    </div>
    <div class="progress-container"><div id="progress-bar" class="progress-bar"></div></div>

    <div class="product-card-container">
        <div class="product-card">
            <span id="product-icon" class="product-img">ğŸ±</span>
            <div id="product-name" class="product-name">ç‰¹è£½ãŠå¼å½“</div>
            <div class="price-tag"><span id="original-price">1000</span>å††</div>
            
            <div class="discount-sticker" id="sticker-el">
                <div class="sticker-text-main" id="sticker-main">åŠé¡</div>
                <div class="sticker-text-sub" id="sticker-sub"></div>
            </div>
        </div>
    </div>

    <div style="text-align:center; margin-bottom:10px; font-weight:bold; color:#555;">ã„ãã‚‰ã«ãªã‚Šã¾ã™ã‹ï¼Ÿ</div>

    <div class="calc-display" id="user-input"></div>

    <div class="numpad">
        <button class="num-btn" onclick="inputNum(7)">7</button>
        <button class="num-btn" onclick="inputNum(8)">8</button>
        <button class="num-btn" onclick="inputNum(9)">9</button>
        <button class="num-btn" onclick="inputNum(4)">4</button>
        <button class="num-btn" onclick="inputNum(5)">5</button>
        <button class="num-btn" onclick="inputNum(6)">6</button>
        <button class="num-btn" onclick="inputNum(1)">1</button>
        <button class="num-btn" onclick="inputNum(2)">2</button>
        <button class="num-btn" onclick="inputNum(3)">3</button>
        <button class="num-btn btn-clear" onclick="clearInput()">C</button>
        <button class="num-btn" onclick="inputNum(0)">0</button>
        <button class="num-btn btn-clear" onclick="backspace()"><i class="fa-solid fa-delete-left"></i></button>
        
        <button class="num-btn btn-enter" onclick="checkAnswer()">æ±ºå®š (Enter)</button>
    </div>
</div>


<div id="screen-result" class="screen" style="text-align:center; padding-top:40px;">
    <div id="result-icon" style="font-size:5em; margin-bottom:20px;">ğŸ‰</div>
    <div class="result-score"><span id="final-score">0</span>ç‚¹</div>
    <p class="result-msg" id="final-msg">ç´ æ™´ã‚‰ã—ã„ï¼</p>
    
    <button class="btn-start" onclick="showScreen('screen-level')">
        ã‚‚ã†ä¸€åº¦éŠã¶
    </button>
    <br><br>
    <button class="btn-back-nav" style="background:#999; border:none;" onclick="showScreen('screen-practice')">
        ç·´ç¿’ã«æˆ»ã‚‹
    </button>
</div>


<script>
    // --- ã‚²ãƒ¼ãƒ ãƒ‡ãƒ¼ã‚¿ ---
    const products = [
        { name: "ãŠå¼å½“ (Bento)", icon: "ğŸ±", prices: [400, 500, 600, 800, 1000] },
        { name: "ãŠå¯¿å¸ (Sushi)", icon: "ğŸ£", prices: [800, 1000, 1200, 1500, 2000] },
        { name: "ãŠè‚‰ (Meat)", icon: "ğŸ¥©", prices: [1000, 1500, 2000, 3000] },
        { name: "ãƒ‘ãƒ³ (Bread)", icon: "ğŸ", prices: [100, 150, 200, 300] },
        { name: "ãŠã«ãã‚Š (Onigiri)", icon: "ğŸ™", prices: [100, 120, 150, 200] },
        { name: "ã‚±ãƒ¼ã‚­ (Cake)", icon: "ğŸ°", prices: [300, 400, 500, 600] },
        { name: "å”æšã’ (Fried Chicken)", icon: "ğŸ—", prices: [300, 400, 500] },
        { name: "åˆºèº« (Sashimi)", icon: "ğŸŸ", prices: [500, 700, 1000, 1200] }
    ];

    let currentLevel = 1;
    let questionCount = 0;
    let score = 0;
    let correctPrice = 0;
    let currentInput = "";
    let isProcessing = false; // é€£æ‰“é˜²æ­¢ç”¨

    // --- ç”»é¢é·ç§» ---
    function showScreen(id) {
        document.querySelectorAll('.screen').forEach(el => el.classList.remove('active'));
        document.getElementById(id).classList.add('active');
        
        // ãƒ•ãƒƒã‚¿ãƒ¼åˆ¶å¾¡
        const footer = document.getElementById('footer-start');
        if(id === 'screen-practice') {
            footer.style.display = 'block';
        } else {
            footer.style.display = 'none';
        }
        window.scrollTo(0,0);
    }

    function goBack() {
        const activeId = document.querySelector('.screen.active').id;
        if (activeId === 'screen-level') showScreen('screen-practice');
        else if (activeId === 'screen-game') {
            if(confirm("ã‚²ãƒ¼ãƒ ã‚’ã‚„ã‚ã¦æˆ»ã‚Šã¾ã™ã‹ï¼Ÿ")) showScreen('screen-level');
        }
        else if (activeId === 'screen-result') showScreen('screen-level');
        else window.location.href = 'index.html'; // ãƒ¡ã‚¤ãƒ³ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã¸
    }

    // --- ã‚²ãƒ¼ãƒ ãƒ­ã‚¸ãƒƒã‚¯ ---
    function startGame(level) {
        currentLevel = level;
        questionCount = 0;
        score = 0;
        isProcessing = false;
        document.getElementById('current-level-display').innerText = level;
        showScreen('screen-game');
        nextQuestion();
    }

    function nextQuestion() {
        if (questionCount >= 10) {
            endGame();
            return;
        }

        questionCount++;
        isProcessing = false; // å…¥åŠ›ãƒ­ãƒƒã‚¯è§£é™¤
        document.getElementById('q-current').innerText = questionCount;
        document.getElementById('progress-bar').style.width = `${(questionCount-1)*10}%`;
        clearInput();

        // 1. å•†å“æ±ºå®š
        const prod = products[Math.floor(Math.random() * products.length)];
        const basePrice = prod.prices[Math.floor(Math.random() * prod.prices.length)];

        // 2. å‰²å¼•æ±ºå®š (ãƒ¬ãƒ™ãƒ«åˆ¥)
        let discountType = "";
        let discountValue = 0; // %å˜ä½
        let stickerMain = "";
        let stickerSub = "";
        
        if (currentLevel === 1) {
            // Level 1: åŠé¡ã®ã¿ (ãŸã¾ã«ç°¡å˜ãª10%ãªã©)
            if(Math.random() < 0.8) {
                discountType = "hangaku";
                stickerMain = "åŠé¡";
                stickerSub = "";
                discountValue = 50;
            } else {
                discountType = "percent";
                discountValue = 10;
                stickerMain = "10%"; stickerSub = "OFF";
            }
        } else if (currentLevel === 2) {
            // Level 2: 10%, 20%, 30%, 50%
            const opts = [10, 20, 30, 50];
            discountValue = opts[Math.floor(Math.random() * opts.length)];
            stickerMain = discountValue + "%"; stickerSub = "OFF";
            
            // ã€ä¿®æ­£ç®‡æ‰€ã€‘ã‚«ãƒƒã‚³ {} ã‚’è¿½åŠ ã—ã¾ã—ãŸ
            if(discountValue === 50 && Math.random() < 0.3) {
                stickerMain = "åŠé¡"; 
                stickerSub = "";
            }
        } else {
            // Level 3: å‰²å¼•ãã‚‚å«ã‚€
            const mode = Math.random();
            if (mode < 0.4) {
                // å‰²
                const wari = Math.floor(Math.random() * 4) + 1; // 1~4å‰²
                discountValue = wari * 10;
                stickerMain = wari + "å‰²"; stickerSub = "å¼•";
            } else if (mode < 0.7) {
                // åŠé¡
                discountValue = 50;
                stickerMain = "åŠé¡";
                stickerSub = "";
            } else {
                // %
                const opts = [5, 10, 15, 20, 25, 30, 40];
                discountValue = opts[Math.floor(Math.random() * opts.length)];
                stickerMain = discountValue + "%"; stickerSub = "å¼•";
            }
        }

        // æ­£è§£è¨ˆç®—
        correctPrice = Math.floor(basePrice * (100 - discountValue) / 100);

        // è¡¨ç¤ºæ›´æ–°
        document.getElementById('product-icon').innerText = prod.icon;
        document.getElementById('product-name').innerText = prod.name;
        document.getElementById('original-price').innerText = basePrice;
        
        const stickerEl = document.getElementById('sticker-el');
        const mainEl = document.getElementById('sticker-main');
        const subEl = document.getElementById('sticker-sub');

        mainEl.innerText = stickerMain;
        subEl.innerText = stickerSub;

        // ã‚·ãƒ¼ãƒ«ã®è‰²å¤‰ãˆ
        stickerEl.classList.remove('sticker-yellow');
        if (discountValue !== 50) { 
            if (Math.random() > 0.5) stickerEl.style.background = "radial-gradient(circle at 30% 30%, #fdd835, #fbc02d)";
            else stickerEl.style.background = "radial-gradient(circle at 30% 30%, #ff5252, #d32f2f)";
            
            if (stickerEl.style.background.includes('fdd835')) stickerEl.style.color = "#d32f2f";
            else stickerEl.style.color = "white";
        } else {
            stickerEl.style.background = "radial-gradient(circle at 30% 30%, #ff5252, #d32f2f)";
            stickerEl.style.color = "white";
        }
        
        // ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ãƒªã‚»ãƒƒãƒˆ
        stickerEl.style.animation = 'none';
        stickerEl.offsetHeight; 
        stickerEl.style.animation = 'stickOn 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275)';
    }

    // --- å…¥åŠ›å‡¦ç† ---
    function inputNum(n) {
        if (isProcessing) return; // å‡¦ç†ä¸­ã¯å…¥åŠ›ä¸å¯
        if (currentInput.length >= 6) return;
        currentInput += n;
        updateDisplay();
    }
    function clearInput() {
        if (isProcessing) return;
        currentInput = "";
        updateDisplay();
    }
    function backspace() {
        if (isProcessing) return;
        currentInput = currentInput.slice(0, -1);
        updateDisplay();
    }
    function updateDisplay() {
        const display = document.getElementById('user-input');
        display.innerText = currentInput;
    }

    function checkAnswer() {
        if (isProcessing) return; // é€£æ‰“é˜²æ­¢
        if (currentInput === "") return;
        
        isProcessing = true; // ãƒ­ãƒƒã‚¯é–‹å§‹
        const userVal = parseInt(currentInput);

        if (userVal === correctPrice) {
            score += 10;
            showFeedback(true);
        } else {
            showFeedback(false);
        }
    }

    function showFeedback(isCorrect) {
        const display = document.getElementById('user-input');
        
        if (isCorrect) {
            display.style.color = "#00e676";
            display.innerText = "â­• " + currentInput;
            setTimeout(() => {
                display.style.color = "";
                nextQuestion();
            }, 800);
        } else {
            display.style.color = "#ff1744";
            // é–“é•ã„ã®æ™‚ã¯ã€ã‚ã‹ã‚Šã‚„ã™ãæ­£è§£ã‚’è¡¨ç¤º
            display.innerText = "âŒ " + correctPrice; 
            setTimeout(() => {
                display.style.color = "";
                nextQuestion();
            }, 1500);
        }
    }

    function endGame() {
        showScreen('screen-result');
        document.getElementById('final-score').innerText = score;
        const msg = document.getElementById('final-msg');
        const icon = document.getElementById('result-icon');
        
        if (score === 100) {
            msg.innerText = "ãƒ‘ãƒ¼ãƒ•ã‚§ã‚¯ãƒˆï¼è²·ã„ç‰©ãƒã‚¹ã‚¿ãƒ¼ã§ã™ï¼";
            icon.innerText = "ğŸ†";
        } else if (score >= 80) {
            msg.innerText = "ã™ã”ã„ï¼ã»ã¨ã‚“ã©æ­£è§£ã§ã™ã€‚";
            icon.innerText = "ğŸ˜";
        } else if (score >= 50) {
            msg.innerText = "ã‚ã¨å°‘ã—ï¼ç·´ç¿’ã—ã¾ã—ã‚‡ã†ã€‚";
            icon.innerText = "ğŸ‘";
        } else {
            msg.innerText = "ã‚‚ã†ä¸€åº¦ãƒãƒ£ãƒ¬ãƒ³ã‚¸ã—ã‚ˆã†ï¼";
            icon.innerText = "ğŸ’ª";
        }
    }

</script>