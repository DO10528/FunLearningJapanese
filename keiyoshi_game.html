<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>„Å©„Å£„Å°„Åå„Äá„ÄáÔºü - ÂΩ¢ÂÆπË©û„Ç≤„Éº„É†</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Zen+Maru+Gothic:wght@500;700;900&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --primary: #ab47bc; /* ÂΩ¢ÂÆπË©û„Ç´„É©„Éº */
            --accent: #ffca28;
            --bg-color: #f3e5f5;
            --text-color: #333;
            --card-bg: white;
            --correct: #66bb6a;
            --incorrect: #ef5350;
        }

        body {
            font-family: 'Zen Maru Gothic', sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            margin: 0; padding: 0;
            display: flex; flex-direction: column; align-items: center;
            min-height: 100vh;
        }

        /* --- „Éò„ÉÉ„ÉÄ„Éº --- */
        header {
            background: linear-gradient(135deg, #ab47bc 0%, #8e24aa 100%);
            color: white; padding: 15px 20px; width: 100%;
            display: flex; justify-content: space-between; align-items: center;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            position: sticky; top: 0; z-index: 100;
        }
        .header-left { display: flex; align-items: center; gap: 15px; }
        .back-btn {
            background: rgba(255,255,255,0.2); border: 1px solid rgba(255,255,255,0.4);
            color: white; padding: 5px 12px; border-radius: 20px; text-decoration: none;
            font-size: 0.9em; font-weight: bold;
        }
        #auth-status { font-size: 0.8em; }

        /* --- „Ç≤„Éº„É†„Ç®„É™„Ç¢ --- */
        .game-container {
            max-width: 600px; width: 95%;
            margin: 20px auto;
            text-align: center;
        }

        /* Ë≥™Âïè„Ç´„Éº„Éâ */
        .question-card {
            background: white;
            border-radius: 20px;
            padding: 20px;
            box-shadow: 0 8px 20px rgba(0,0,0,0.1);
            margin-bottom: 30px; /* ÈñìÈöî„ÇíÂ∞ë„ÅóÂ∫É„Åí„Çã */
            position: relative;
            overflow: hidden;
            border: 4px solid white;
        }
        
        .question-word {
            font-size: 3em;
            color: var(--primary);
            font-weight: 900;
            margin: 10px 0;
            line-height: 1.2;
        }
        .question-reading {
            font-size: 1.2em;
            color: #666;
            margin-bottom: 10px;
        }
        .speaker-btn {
            background: var(--accent);
            border: none; width: 50px; height: 50px; border-radius: 50%;
            color: white; font-size: 1.5em; cursor: pointer;
            box-shadow: 0 4px 0 #ff6f00; transition: transform 0.1s;
        }
        .speaker-btn:active { transform: translateY(4px); box-shadow: none; }

        /* ÈÅ∏ÊäûËÇ¢„Ç®„É™„Ç¢ (Â∑¶Âè≥2Êäû) */
        .choices-container {
            display: flex;
            gap: 20px; /* ÈñìÈöî„ÇíÂ∞ë„ÅóÂ∫É„Åí„Çã */
            justify-content: center;
        }

        .choice-card {
            background: white;
            border-radius: 20px;
            
            /* ‚òÖ‰øÆÊ≠£: Êû†„ÇíÂ∞è„Åï„ÅèË™øÊï¥ */
            width: 40%; 
            max-width: 160px; /* ÊúÄÂ§ßÂπÖ„ÇíÂà∂Èôê */
            aspect-ratio: 1 / 1; /* Ê≠£ÊñπÂΩ¢„Å´„Åô„Çã */
            
            display: flex; flex-direction: column; justify-content: center; align-items: center;
            cursor: pointer;
            box-shadow: 0 6px 15px rgba(0,0,0,0.1);
            border: 4px solid transparent;
            transition: transform 0.2s;
            position: relative;
        }
        .choice-card:active { transform: scale(0.95); }
        
        .choice-img {
            font-size: 4rem; /* ÁµµÊñáÂ≠ó„ÇÇÂ∞ë„ÅóÂ∞è„Åï„ÅèË™øÊï¥ */
            line-height: 1;
        }

        /* Ê≠£Ëß£„Éª‰∏çÊ≠£Ëß£„Ç¢„Éã„É°„Éº„Ç∑„Éß„É≥ */
        .correct-anim { border-color: var(--correct); background-color: #e8f5e9; }
        .incorrect-anim { border-color: var(--incorrect); background-color: #ffebee; }
        
        .mark {
            position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
            font-size: 5rem; font-weight: bold; opacity: 0; pointer-events: none; z-index: 10;
        }
        .mark.show { animation: popMark 0.5s forwards; }
        
        @keyframes popMark { 
            0% { opacity: 0; transform: translate(-50%, -50%) scale(0.5); } 
            50% { opacity: 1; transform: translate(-50%, -50%) scale(1.2); } 
            100% { opacity: 1; transform: translate(-50%, -50%) scale(1); } 
        }

        /* „Çπ„Ç≥„Ç¢„Éê„Éº */
        .score-board {
            display: flex; justify-content: space-between;
            background: rgba(255,255,255,0.8); padding: 10px 20px; border-radius: 50px;
            margin-bottom: 15px; font-weight: bold; color: #555;
        }
        .streak-counter { color: #ff9800; }

        /* Ê¨°„Å∏„Éú„Çø„É≥ */
        #next-btn {
            background: var(--primary); color: white;
            border: none; padding: 12px 30px; font-size: 1.1em; font-weight: bold;
            border-radius: 50px; cursor: pointer; margin-top: 30px;
            box-shadow: 0 4px 0 #7b1fa2; display: none;
        }
        #next-btn:active { transform: translateY(4px); box-shadow: none; }

        /* „Éù„Ç§„É≥„Éà„Ç¢„Éã„É°„Éº„Ç∑„Éß„É≥ */
        @keyframes pointGet { 0% { opacity:0; transform:translateY(0); } 50% { opacity:1; transform:translateY(-20px); } 100% { opacity:0; transform:translateY(-40px); } }
        .point-anim { position: absolute; color: #ffca28; font-weight: 900; font-size: 1.5em; pointer-events: none; animation: pointGet 1s ease-out forwards; z-index: 20; }

    </style>
</head>
<body>

<header>
    <div class="header-left">
        <a href="index.html" class="back-btn"><i class="fa-solid fa-house"></i> „Éõ„Éº„É†</a>
        <h1 style="margin:0; font-size:1.2em;">„Å©„Å£„Å°„Åå „Äá„ÄáÔºü</h1>
    </div>
    <div id="auth-status">...</div>
</header>

<div class="game-container">

    <div class="score-board">
        <span><i class="fa-solid fa-star"></i> „Çπ„Ç≥„Ç¢: <span id="score">0</span></span>
        <span class="streak-counter"><i class="fa-solid fa-fire"></i> <span id="streak">0</span> „Çå„Çì„Åû„Åè</span>
    </div>

    <div class="question-card">
        <div class="question-reading" id="q-reading"></div>
        <div class="question-word" id="q-word"></div>
        <button class="speaker-btn" onclick="playQuestionSound()">
            <i class="fa-solid fa-volume-high"></i>
        </button>
    </div>

    <div class="choices-container" id="choices-area">
        </div>

    <button id="next-btn" onclick="nextQuestion()">„Å§„Åé„ÅÆ „ÇÇ„Çì„Å†„ÅÑ <i class="fa-solid fa-arrow-right"></i></button>

</div>

<script type="module" src="js/firebase-config.js"></script>

<script>
    // --- „Ç≤„Éº„É†„Éá„Éº„Çø ---
    const quizData = [
        { word: "„Åä„Åä„Åç„ÅÑ", reading: "„Åä„Åä„Åç„ÅÑ", kanji: "Â§ß„Åç„ÅÑ", correct: "üêò", wrong: "üêú", en: "Big" },
        { word: "„Å°„ÅÑ„Åï„ÅÑ", reading: "„Å°„ÅÑ„Åï„ÅÑ", kanji: "Â∞è„Åï„ÅÑ", correct: "üêú", wrong: "üêò", en: "Small" },
        { word: "„ÅÇ„Å§„ÅÑ", reading: "„ÅÇ„Å§„ÅÑ", kanji: "ÁÜ±„ÅÑ", correct: "üî•", wrong: "üßä", en: "Hot" },
        { word: "„Å§„ÇÅ„Åü„ÅÑ", reading: "„Å§„ÇÅ„Åü„ÅÑ", kanji: "ÂÜ∑„Åü„ÅÑ", correct: "üßä", wrong: "üî•", en: "Cold" },
        { word: "„ÅØ„ÇÑ„ÅÑ", reading: "„ÅØ„ÇÑ„ÅÑ", kanji: "ÈÄü„ÅÑ", correct: "üèéÔ∏è", wrong: "üê¢", en: "Fast" },
        { word: "„Åä„Åù„ÅÑ", reading: "„Åä„Åù„ÅÑ", kanji: "ÈÅÖ„ÅÑ", correct: "üê¢", wrong: "üèéÔ∏è", en: "Slow" },
        { word: "„Åü„Åã„ÅÑ", reading: "„Åü„Åã„ÅÑ", kanji: "È´ò„ÅÑ", correct: "ü¶í", wrong: "üêà", en: "Tall" }, 
        { word: "„Å™„Åå„ÅÑ", reading: "„Å™„Åå„ÅÑ", kanji: "Èï∑„ÅÑ", correct: "üêç", wrong: "üêõ", en: "Long" }, 
        { word: "„Åä„ÇÇ„ÅÑ", reading: "„Åä„ÇÇ„ÅÑ", kanji: "Èáç„ÅÑ", correct: "ü™®", wrong: "ü™∂", en: "Heavy" }, 
        { word: "„Åã„Çã„ÅÑ", reading: "„Åã„Çã„ÅÑ", kanji: "ËªΩ„ÅÑ", correct: "ü™∂", wrong: "ü™®", en: "Light" },
        { word: "„ÅÜ„Çå„Åó„ÅÑ", reading: "„ÅÜ„Çå„Åó„ÅÑ", kanji: "Â¨â„Åó„ÅÑ", correct: "üòÑ", wrong: "üò≠", en: "Happy" },
        { word: "„Åã„Å™„Åó„ÅÑ", reading: "„Åã„Å™„Åó„ÅÑ", kanji: "ÊÇ≤„Åó„ÅÑ", correct: "üò≠", wrong: "üòÑ", en: "Sad" },
        { word: "„ÅÇ„Åæ„ÅÑ", reading: "„ÅÇ„Åæ„ÅÑ", kanji: "Áîò„ÅÑ", correct: "üç∞", wrong: "üçã", en: "Sweet" },
        { word: "„Åô„Å£„Å±„ÅÑ", reading: "„Åô„Å£„Å±„ÅÑ", kanji: "ÈÖ∏„Å£„Å±„ÅÑ", correct: "üçã", wrong: "üç∞", en: "Sour" },
        { word: "„ÅÇ„Åã„Çã„ÅÑ", reading: "„ÅÇ„Åã„Çã„ÅÑ", kanji: "Êòé„Çã„ÅÑ", correct: "‚òÄÔ∏è", wrong: "üåë", en: "Bright" },
        { word: "„Åè„Çâ„ÅÑ", reading: "„Åè„Çâ„ÅÑ", kanji: "Êöó„ÅÑ", correct: "üåë", wrong: "‚òÄÔ∏è", en: "Dark" },
        { word: "„Åä„ÅÑ„Åó„ÅÑ", reading: "„Åä„ÅÑ„Åó„ÅÑ", kanji: "ÁæéÂë≥„Åó„ÅÑ", correct: "üòã", wrong: "ü§¢", en: "Delicious" },
        { word: "„Åè„Åï„ÅÑ", reading: "„Åè„Åï„ÅÑ", kanji: "Ëá≠„ÅÑ", correct: "üí©", wrong: "üå∏", en: "Smelly" },
        { word: "„ÅÇ„Åü„Çâ„Åó„ÅÑ", reading: "„ÅÇ„Åü„Çâ„Åó„ÅÑ", kanji: "Êñ∞„Åó„ÅÑ", correct: "‚ú®üëü", wrong: "üèöÔ∏è", en: "New" },
        { word: "„Åµ„Çã„ÅÑ", reading: "„Åµ„Çã„ÅÑ", kanji: "Âè§„ÅÑ", correct: "üèöÔ∏è", wrong: "‚ú®üè°", en: "Old" }
    ];

    let currentQ = null;
    let score = 0;
    let streak = 0;
    let isAnswering = false;

    // --- Èü≥Â£∞ÂêàÊàê ---
    const synth = window.speechSynthesis;
    let voices = [];
    setTimeout(() => { voices = synth.getVoices(); }, 500);

    function speak(text) {
        synth.cancel();
        const ut = new SpeechSynthesisUtterance(text);
        ut.lang = 'ja-JP';
        ut.rate = 0.9;
        const jpVoices = voices.filter(v => v.lang.includes('ja') || v.lang.includes('JP'));
        let target = jpVoices.find(v => v.name.includes('Google') || v.name.includes('Female'));
        if(!target && jpVoices.length) target = jpVoices[0];
        if(target) ut.voice = target;
        synth.speak(ut);
    }

    function playSeikai() { new Audio('assets/sounds/seikai.mp3').play().catch(()=>{}); }
    function playBubu() { new Audio('assets/sounds/bubu.mp3').play().catch(()=>{}); }

    function playQuestionSound() {
        if(currentQ) speak(currentQ.word); 
    }

    // --- „Ç≤„Éº„É†„É≠„Ç∏„ÉÉ„ÇØ ---
    function initGame() {
        score = 0;
        streak = 0;
        updateScore();
        nextQuestion();
    }

    function nextQuestion() {
        isAnswering = true;
        document.getElementById('next-btn').style.display = 'none';
        
        const randomIndex = Math.floor(Math.random() * quizData.length);
        currentQ = quizData[randomIndex];

        document.getElementById('q-word').innerText = currentQ.kanji;
        document.getElementById('q-reading').innerText = currentQ.reading;
        
        setTimeout(() => playQuestionSound(), 300);

        const container = document.getElementById('choices-area');
        container.innerHTML = '';

        const isLeftCorrect = Math.random() > 0.5;
        const leftContent = isLeftCorrect ? currentQ.correct : currentQ.wrong;
        const rightContent = isLeftCorrect ? currentQ.wrong : currentQ.correct;

        container.appendChild(createCard(leftContent, isLeftCorrect));
        container.appendChild(createCard(rightContent, !isLeftCorrect));
    }

    function createCard(content, isCorrect) {
        const div = document.createElement('div');
        div.className = 'choice-card';
        div.innerHTML = `
            <div class="choice-img">${content}</div>
            <div class="mark" style="color:${isCorrect ? '#4caf50' : '#ef5350'}">
                ${isCorrect ? '<i class="fa-regular fa-circle"></i>' : '<i class="fa-solid fa-xmark"></i>'}
            </div>
        `;
        div.onclick = (e) => checkAnswer(div, isCorrect, e);
        return div;
    }

    function checkAnswer(cardEl, isCorrect, e) {
        if(!isAnswering) return; 
        isAnswering = false;

        const mark = cardEl.querySelector('.mark');
        mark.classList.add('show');

        if(isCorrect) {
            cardEl.classList.add('correct-anim');
            playSeikai();
            
            // ‚òÖ‰øÆÊ≠£: 1ÁÇπÂä†ÁÆó
            score += 1;
            streak++;
            updateScore();
            
            // +1 Pt „Ç¢„Éã„É°„Éº„Ç∑„Éß„É≥
            showPointAnim(e.clientX, e.clientY);
            
            if(window.addPoints) window.addPoints('adj_' + currentQ.reading);

            setTimeout(() => nextQuestion(), 1500);
        } else {
            cardEl.classList.add('incorrect-anim');
            playBubu();
            streak = 0;
            updateScore();
            document.getElementById('next-btn').style.display = 'inline-block';
        }
    }

    function showPointAnim(x, y) {
        const el = document.createElement('div');
        el.className = 'point-anim';
        el.innerText = "+1";
        el.style.left = x + 'px';
        el.style.top = y + 'px';
        document.body.appendChild(el);
        setTimeout(() => el.remove(), 1000);
    }

    function updateScore() {
        document.getElementById('score').innerText = score;
        document.getElementById('streak').innerText = streak;
    }

    initGame();

</script>
</body>
</html>