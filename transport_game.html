<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ã“ã†ã¤ã† ã® ã‚²ãƒ¼ãƒ  - FunLearnJP</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Zen+Maru+Gothic:wght@500;700;900&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --primary: #4facfe;
            --accent: #ffcc5c;
            --bg-color: #f0f9ff;
            --text-color: #333;
        }

        body {
            font-family: 'Zen Maru Gothic', sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            margin: 0; padding: 20px;
            display: flex; flex-direction: column; align-items: center;
            min-height: 100vh;
        }

        h1, h2 { text-align: center; color: #0277bd; margin: 0 0 15px 0; }
        
        /* ã‚³ãƒ³ãƒ†ãƒŠ */
        .game-container {
            background: white;
            max-width: 800px; width: 100%;
            border-radius: 20px;
            padding: 20px;
            box-shadow: 0 8px 20px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }

        /* ç”»é¢åˆ‡ã‚Šæ›¿ãˆ */
        .screen { display: none; animation: fadeIn 0.3s; }
        .screen.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

        /* ã‚¹ã‚¿ãƒ‡ã‚£ãƒ¢ãƒ¼ãƒ‰ */
        .word-section { margin-bottom: 30px; border-bottom: 2px dashed #eee; padding-bottom: 20px; }
        .section-label {
            background: #e1f5fe; padding: 8px 20px; border-radius: 20px;
            display: inline-block; font-weight: bold; margin-bottom: 15px; color: #0277bd; font-size: 1.1em;
        }
        .grid {
            display: grid; grid-template-columns: repeat(auto-fill, minmax(100px, 1fr)); gap: 15px;
        }
        .card {
            background: #fff; border: 2px solid #b3e5fc; border-radius: 15px;
            padding: 10px; text-align: center; cursor: pointer;
            transition: transform 0.1s; display: flex; flex-direction: column; align-items: center; justify-content: center;
            box-shadow: 0 4px 0 rgba(0,0,0,0.05);
        }
        .card:active { transform: scale(0.95); background: #e1f5fe; }
        
        .emoji-img { font-size: 3.5rem; line-height: 1.2; margin-bottom: 5px; }
        .card span { font-size: 0.95em; font-weight: bold; line-height: 1.3; }

        /* ã‚²ãƒ¼ãƒ å…±é€š */
        .question-box {
            background: #fff9c4; padding: 20px; border-radius: 15px;
            text-align: center; font-size: 1.2em; font-weight: bold; margin-bottom: 20px;
            border: 3px solid #fff176;
        }
        .main-image {
            width: 150px; height: 150px; 
            margin: 10px auto; display: flex; justify-content: center; align-items: center;
            background: white; border-radius: 20px; padding: 10px;
            border: 2px solid #eee; font-size: 6rem; /* çµµæ–‡å­—ã‚µã‚¤ã‚º */
        }

        /* ä¸¦ã³æ›¿ãˆãƒ–ãƒ­ãƒƒã‚¯ */
        .sortable-area {
            min-height: 80px; background: #f5f5f5; border-radius: 10px;
            padding: 15px; display: flex; flex-wrap: wrap; gap: 10px; justify-content: center;
            margin-bottom: 20px; border: 2px dashed #ccc;
        }
        .word-block {
            background: white; border: 2px solid var(--primary); color: var(--primary);
            padding: 12px 18px; border-radius: 12px; font-weight: bold; cursor: pointer;
            box-shadow: 0 4px 0 rgba(0,0,0,0.1); user-select: none; font-size: 1.1em;
        }
        .word-block:active { transform: translateY(3px); box-shadow: none; }

        /* Yes/No ãƒœã‚¿ãƒ³ */
        .yes-no-area { display: flex; gap: 20px; justify-content: center; margin-top: 20px; }
        .choice-btn {
            flex: 1; max-width: 150px; padding: 15px; border-radius: 15px;
            border: none; font-size: 1.2em; font-weight: bold; cursor: pointer; color: white;
            box-shadow: 0 4px 0 rgba(0,0,0,0.2); transition: transform 0.1s;
        }
        .choice-btn:active { transform: translateY(4px); box-shadow: none; }
        .btn-yes { background: #66bb6a; }
        .btn-no { background: #ef5350; }
        .choice-btn:disabled { opacity: 0.5; cursor: default; transform: none; box-shadow: none; }
        
        /* é¸æŠè‚¢ãƒœã‚¿ãƒ³ (ä¿®æ­£è³ªå•ç”¨) */
        .fix-area { 
            margin-top: 20px; padding: 15px; background: #ffebee; border-radius: 15px; animation: fadeIn 0.5s; 
        }
        .options-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-top: 10px; }
        .option-btn {
            background: white; border: 2px solid #ddd; padding: 15px; border-radius: 12px;
            font-weight: bold; cursor: pointer; font-size: 1.3em; /* æ–‡å­—ã‚’å¤§ãã */
            box-shadow: 0 3px 0 #eee;
            height: 80px; /* é«˜ã•å›ºå®šã§æŠ¼ã—ã‚„ã™ã */
        }
        .option-btn:active { transform: translateY(2px); box-shadow: none; }

        /* ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ */
        .nav-area { display: flex; flex-wrap: wrap; gap: 10px; justify-content: center; margin-bottom: 20px; }
        .nav-btn {
            padding: 10px 20px; border-radius: 25px; border: none; font-weight: bold; cursor: pointer;
            background: #e0e0e0; color: #555; transition: all 0.2s;
        }
        .nav-btn.active { background: var(--primary); color: white; box-shadow: 0 4px 0 #0277bd; }

        .big-btn {
            background: var(--primary); color: white; border: none; padding: 12px 40px;
            font-size: 1.1em; font-weight: bold; border-radius: 30px; cursor: pointer;
            box-shadow: 0 4px 0 #0277bd; display: block; margin: 20px auto;
        }
        .big-btn:active { transform: translateY(4px); box-shadow: none; }

        /* ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ */
        .feedback-msg {
            text-align: center; font-weight: bold; min-height: 30px; margin-top: 15px; font-size: 1.2em;
        }
    </style>
</head>
<body>

    <h1>ğŸš¦ ã“ã†ã¤ã† ã® ã‚²ãƒ¼ãƒ  ğŸšƒ</h1>

    <div class="nav-area">
        <button class="nav-btn active" onclick="switchScreen('study')">å˜èª(ãŸã‚“ã”)</button>
        <button class="nav-btn" onclick="switchScreen('game1')">Game 1 (æ–‡ä½œã‚Š)</button>
        <button class="nav-btn" onclick="switchScreen('game2')">Game 2 (å ´æ‰€)</button>
        <button class="nav-btn" onclick="switchScreen('game3')">Game 3 (ä¹—ã‚Šç‰©)</button>
        <button class="nav-btn" onclick="switchScreen('game4')">Game 4 (ã¾ã¨ã‚)</button>
    </div>

    <div class="game-container">
        
        <div id="screen-study" class="screen active">
            <h2>ã“ã¨ã° ã‚’ ãŠã¼ãˆã‚ˆã†</h2>
            <p style="text-align:center;">ã‚¯ãƒªãƒƒã‚¯ã—ã¦ éŸ³ã‚’ãã„ã¦ã­</p>

            <div class="word-section">
                <div class="section-label">ğŸ™‚ ã²ã¨ (People)</div>
                <div class="grid" id="grid-people"></div>
            </div>
            <div class="word-section">
                <div class="section-label">ğŸš— ã®ã‚Šã‚‚ã® (Transports)</div>
                <div class="grid" id="grid-transport"></div>
            </div>
            <div class="word-section">
                <div class="section-label">ğŸ« ã°ã—ã‚‡ (Places)</div>
                <div class="grid" id="grid-place"></div>
            </div>
            <div class="word-section">
                <div class="section-label">ğŸƒ ã©ã†ã• (Verbs)</div>
                <div class="grid" id="grid-verb"></div>
            </div>
        </div>

        <div id="screen-game1" class="screen">
            <h2>Game 1: ã¶ã‚“ ã‚’ ã¤ãã‚ã†</h2>
            <div class="question-box" id="q1-text">English Sentence</div>
            <div class="sortable-area" id="area-game1"></div>
            <div class="sortable-area" id="pool-game1" style="border: 2px solid #ddd; background:white;"></div>
            <div id="feedback-game1" class="feedback-msg"></div>
            <button class="big-btn" onclick="checkGame1()">ã“ãŸãˆã‚ã‚ã›</button>
        </div>

        <div id="screen-game2" class="screen">
            <h2>Game 2: ã©ã“ã¸ ã„ãã¾ã™ã‹ï¼Ÿ</h2>
            <div id="img-game2" class="main-image">ğŸ«</div>
            <div class="question-box" id="q2-text">è³ªå•æ–‡</div>
            
            <div id="area-yesno-game2" class="yes-no-area">
                <button id="g2-yes" class="choice-btn btn-yes" onclick="answerGame2(true)">ã¯ã„</button>
                <button id="g2-no" class="choice-btn btn-no" onclick="answerGame2(false)">ã„ã„ãˆ</button>
            </div>
            
            <div id="area-fix-game2" class="fix-area" style="display:none;">
                <p style="text-align:center; font-weight:bold; color:#d32f2f;">ãŸã ã—ã„ ã°ã—ã‚‡ ã¯ ã©ã£ã¡ï¼Ÿ</p>
                <div class="options-grid" id="opts-game2"></div>
            </div>

            <div id="feedback-game2" class="feedback-msg"></div>
        </div>

        <div id="screen-game3" class="screen">
            <h2>Game 3: ã©ã†ã‚„ã£ã¦ ã„ãã¾ã™ã‹ï¼Ÿ</h2>
            <div id="img-game3" class="main-image">ğŸšŒ</div>
            <div class="question-box" id="q3-text">è³ªå•æ–‡</div>
            
            <div id="area-yesno-game3" class="yes-no-area">
                <button id="g3-yes" class="choice-btn btn-yes" onclick="answerGame3(true)">ã¯ã„</button>
                <button id="g3-no" class="choice-btn btn-no" onclick="answerGame3(false)">ã„ã„ãˆ</button>
            </div>
            
            <div id="area-fix-game3" class="fix-area" style="display:none;">
                <p style="text-align:center; font-weight:bold; color:#d32f2f;">ã©ã†ã‚„ã£ã¦ ã„ãã¾ã™ã‹ï¼Ÿ</p>
                <div class="options-grid" id="opts-game3"></div>
            </div>

            <div id="feedback-game3" class="feedback-msg"></div>
        </div>

        <div id="screen-game4" class="screen">
            <h2>Game 4: ãœã‚“ã¶ ã„ãˆã‚‹ã‹ãªï¼Ÿ</h2>
            <p style="text-align:center; font-size:0.9em;">(ã ã‚ŒãŒ â†’ ã©ã†ã‚„ã£ã¦ â†’ ã©ã“ã¸ â†’ ã©ã†ã™ã‚‹)</p>
            <div class="question-box" id="q4-text">English</div>
            <div class="sortable-area" id="area-game4"></div>
            <div class="sortable-area" id="pool-game4" style="border: 2px solid #ddd; background:white;"></div>
            <div id="feedback-game4" class="feedback-msg"></div>
            <button class="big-btn" onclick="checkGame4()">ã“ãŸãˆã‚ã‚ã›</button>
        </div>

    </div>

<script>
    // --- 1. ãƒ‡ãƒ¼ã‚¿å®šç¾© ---

    const verbs = [
        { id: 'go', name: 'ã„ãã¾ã™', en: 'go', emoji: 'â¡ï¸' },
        { id: 'come', name: 'ãã¾ã™', en: 'come', emoji: 'â¬…ï¸' },
        { id: 'return', name: 'ã‹ãˆã‚Šã¾ã™', en: 'return', emoji: 'ğŸ ' }
    ];

    const transports = [
        { id: 'bus', name: 'ãƒã‚¹', en: 'bus', emoji: 'ğŸšŒ', particle: 'ã§' },
        { id: 'train', name: 'ã§ã‚“ã—ã‚ƒ', en: 'train', emoji: 'ğŸšƒ', particle: 'ã§' },
        { id: 'car', name: 'ãã‚‹ã¾', en: 'car', emoji: 'ğŸš—', particle: 'ã§' },
        { id: 'walk', name: 'ã‚ã‚‹ã„ã¦', en: 'on foot', emoji: 'ğŸš¶', particle: '' }, 
        { id: 'bicycle', name: 'ã˜ã¦ã‚“ã—ã‚ƒ', en: 'bicycle', emoji: 'ğŸš²', particle: 'ã§' },
        { id: 'taxi', name: 'ã‚¿ã‚¯ã‚·ãƒ¼', en: 'taxi', emoji: 'ğŸš•', particle: 'ã§' },
        { id: 'shinkansen', name: 'ã—ã‚“ã‹ã‚“ã›ã‚“', en: 'Shinkansen', emoji: 'ğŸš…', particle: 'ã§' },
        { id: 'plane', name: 'ã²ã“ã†ã', en: 'plane', emoji: 'âœˆï¸', particle: 'ã§' },
        { id: 'ship', name: 'ãµã­', en: 'ship', emoji: 'ğŸš¢', particle: 'ã§' },
        { id: 'subway', name: 'ã¡ã‹ã¦ã¤', en: 'subway', emoji: 'ğŸš‡', particle: 'ã§' },
        { id: 'truck', name: 'ãƒˆãƒ©ãƒƒã‚¯', en: 'truck', emoji: 'ğŸšš', particle: 'ã§' },
        { id: 'motorcycle', name: 'ãƒã‚¤ã‚¯', en: 'motorcycle', emoji: 'ğŸï¸', particle: 'ã§' },
        { id: 'policecar', name: 'ãƒ‘ãƒˆã‚«ãƒ¼', en: 'police car', emoji: 'ğŸš“', particle: 'ã§' },
        { id: 'ambulance', name: 'ãã‚…ã†ãã‚…ã†ã—ã‚ƒ', en: 'ambulance', emoji: 'ğŸš‘', particle: 'ã§' }
    ];

    const places = [
        { id: 'school', name: 'ãŒã£ã“ã†', en: 'school', emoji: 'ğŸ«' },
        { id: 'hospital', name: 'ã³ã‚‡ã†ã„ã‚“', en: 'hospital', emoji: 'ğŸ¥' },
        { id: 'restaurant', name: 'ãƒ¬ã‚¹ãƒˆãƒ©ãƒ³', en: 'restaurant', emoji: 'ğŸ½ï¸' },
        { id: 'bank', name: 'ãã‚“ã“ã†', en: 'bank', emoji: 'ğŸ¦' },
        { id: 'home', name: 'ã†ã¡', en: 'home', emoji: 'ğŸ ' },
        { id: 'park', name: 'ã“ã†ãˆã‚“', en: 'park', emoji: 'ğŸ›' },
        { id: 'station', name: 'ãˆã', en: 'station', emoji: 'ğŸš‰' },
        { id: 'supermarket', name: 'ã‚¹ãƒ¼ãƒ‘ãƒ¼', en: 'supermarket', emoji: 'ğŸ›’' },
        { id: 'library', name: 'ã¨ã—ã‚‡ã‹ã‚“', en: 'library', emoji: 'ğŸ“š' },
        { id: 'sea', name: 'ã†ã¿', en: 'sea', emoji: 'ğŸ–ï¸' },
        { id: 'mountain', name: 'ã‚„ã¾', en: 'mountain', emoji: 'â›°ï¸' },
        { id: 'airport', name: 'ãã†ã“ã†', en: 'airport', emoji: 'ğŸ›«' },
        { id: 'postoffice', name: 'ã‚†ã†ã³ã‚“ãã‚‡ã', en: 'post office', emoji: 'ğŸ“®' },
        { id: 'conbini', name: 'ã‚³ãƒ³ãƒ“ãƒ‹', en: 'convenience store', emoji: 'ğŸª' }
    ];

    const people = [
        { id: 'me', name: 'ã‚ãŸã—', en: 'I', emoji: 'ğŸ˜Š' },
        { id: 'you', name: 'ã‚ãªãŸ', en: 'You', emoji: 'ğŸ«µ' },
        { id: 'teacher', name: 'ã›ã‚“ã›ã„', en: 'Teacher', emoji: 'ğŸ‘©â€ğŸ«' },
        { id: 'father', name: 'ãŠã¨ã†ã•ã‚“', en: 'Father', emoji: 'ğŸ‘¨' },
        { id: 'mother', name: 'ãŠã‹ã‚ã•ã‚“', en: 'Mother', emoji: 'ğŸ‘©' },
        { id: 'brother_older', name: 'ãŠã«ã„ã•ã‚“', en: 'Brother', emoji: 'ğŸ‘¦' },
        { id: 'sister_older', name: 'ãŠã­ãˆã•ã‚“', en: 'Sister', emoji: 'ğŸ‘§' },
        { id: 'brother_younger', name: 'ãŠã¨ã†ã¨', en: 'Brother', emoji: 'ğŸ‘¶' },
        { id: 'sister_younger', name: 'ã„ã‚‚ã†ã¨', en: 'Sister', emoji: 'ğŸ‘¶' },
        { id: 'friend', name: 'ã¨ã‚‚ã ã¡', en: 'Friend', emoji: 'ğŸ‘«' },
        { id: 'grandfather', name: 'ãŠã˜ã„ã•ã‚“', en: 'Grandfather', emoji: 'ğŸ‘´' },
        { id: 'grandmother', name: 'ãŠã°ã‚ã•ã‚“', en: 'Grandmother', emoji: 'ğŸ‘µ' }
    ];

    // --- 2. å…±é€šé–¢æ•° ---
    
    function speak(text) {
        window.speechSynthesis.cancel();
        const ut = new SpeechSynthesisUtterance(text);
        ut.lang = 'ja-JP';
        ut.rate = 0.9;
        window.speechSynthesis.speak(ut);
    }

    function playSeikai() {
        const audio = new Audio('assets/sounds/seikai.mp3');
        audio.play().catch(e => console.log('Audio error:', e));
    }
    function playBubu() {
        const audio = new Audio('assets/sounds/bubu.mp3');
        audio.play().catch(e => console.log('Audio error:', e));
    }

    function switchScreen(screenId) {
        document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
        document.getElementById('screen-' + screenId).classList.add('active');
        document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
        if(event && event.target) event.target.classList.add('active');
        
        if (screenId === 'study') initStudy();
        if (screenId === 'game1') initGame1();
        if (screenId === 'game2') initGame2();
        if (screenId === 'game3') initGame3();
        if (screenId === 'game4') initGame4();
    }

    function getRandom(arr) { return arr[Math.floor(Math.random() * arr.length)]; }
    function shuffle(arr) { return arr.sort(() => Math.random() - 0.5); }

    // --- 3. Study Mode ---
    function initStudy() {
        renderGrid('grid-people', people);
        renderGrid('grid-transport', transports);
        renderGrid('grid-place', places);
        renderGrid('grid-verb', verbs);
    }

    function renderGrid(elemId, dataList) {
        const container = document.getElementById(elemId);
        container.innerHTML = '';
        dataList.forEach(item => {
            const div = document.createElement('div');
            div.className = 'card';
            div.innerHTML = `<div class="emoji-img">${item.emoji}</div><span>${item.name}</span>`;
            div.onclick = () => speak(item.name);
            container.appendChild(div);
        });
    }

    // --- 4. Game 1 (åŸºæœ¬ä¸¦ã³æ›¿ãˆ) ---
    let g1Answer = [];
    
    function initGame1() {
        document.getElementById('feedback-game1').innerText = '';
        document.getElementById('area-game1').innerHTML = '';
        
        const sub = getRandom(people);
        const plc = getRandom(places);
        const vrb = getRandom(verbs);

        let enVerb = vrb.en;
        if(sub.id !== 'me' && sub.id !== 'you' && sub.id !== 'friend') enVerb += 's'; 
        if(sub.id === 'you' || sub.id === 'friend' || sub.id === 'me') enVerb = vrb.en;
        const enText = `${sub.en} ${enVerb} to ${plc.en}.`;
        document.getElementById('q1-text').innerText = enText;
        
        const parts = [
            { text: sub.name + 'ã¯', type: 'sub' },
            { text: plc.name + 'ã«', type: 'plc' }, 
            { text: vrb.name, type: 'vrb' }
        ];
        g1Answer = parts.map(p => p.text).join('');

        const pool = document.getElementById('pool-game1');
        pool.innerHTML = '';
        shuffle([...parts]).forEach(p => {
            const btn = document.createElement('div');
            btn.className = 'word-block';
            btn.innerText = p.text;
            btn.onclick = () => moveBlock(btn, 'pool-game1', 'area-game1');
            pool.appendChild(btn);
        });
    }

    function moveBlock(el, fromId, toId) {
        const parent = el.parentNode;
        if(parent.id === fromId) {
            document.getElementById(toId).appendChild(el);
        } else {
            document.getElementById(fromId).appendChild(el);
        }
        speak(el.innerText);
    }

    function checkGame1() {
        const blocks = document.querySelectorAll('#area-game1 .word-block');
        let userAnswer = "";
        blocks.forEach(b => userAnswer += b.innerText);

        const fb = document.getElementById('feedback-game1');
        if (userAnswer === g1Answer) {
            fb.innerText = "â­•ï¸ ã›ã„ã‹ã„ï¼";
            fb.style.color = "green";
            playSeikai();
            // è‡ªå‹•ã§æ¬¡ã¸
            setTimeout(() => initGame1(), 2000);
        } else {
            fb.innerText = "âŒ ã¡ãŒã„ã¾ã™...";
            fb.style.color = "red";
            playBubu();
        }
    }


    // --- 5. Game 2 (å ´æ‰€ Yes/No) ---
    let g2Target, g2Wrong, g2IsCorrectCase;

    function initGame2() {
        resetGameUI('game2');
        g2Target = getRandom(places);
        g2IsCorrectCase = Math.random() > 0.5;

        document.getElementById('img-game2').innerText = g2Target.emoji;

        let qText = "";
        if (g2IsCorrectCase) {
            qText = `${g2Target.name} ã« ã„ãã¾ã™ã‹ï¼Ÿ`;
        } else {
            do { g2Wrong = getRandom(places); } while(g2Wrong.id === g2Target.id);
            qText = `${g2Wrong.name} ã« ã„ãã¾ã™ã‹ï¼Ÿ`;
        }
        document.getElementById('q2-text').innerText = qText;
        speak(qText);
    }

    function answerGame2(isYes) {
        const fb = document.getElementById('feedback-game2');
        
        if ( (g2IsCorrectCase && isYes) || (!g2IsCorrectCase && !isYes) ) {
            // æ­£è§£
            if(isYes) {
                fb.innerText = `â­•ï¸ ã¯ã„ã€${g2Target.name} ã« ã„ãã¾ã™ã€‚`;
                fb.style.color = "green";
                playSeikai();
                // è‡ªå‹•ã§æ¬¡ã¸
                setTimeout(() => initGame2(), 2000);
            } else {
                // Noã¨ç­”ãˆãŸ -> ä¿®æ­£å•é¡Œã¸
                // éŸ³å£°ãŒé‡ãªã‚‰ãªã„ã‚ˆã†ã«ã€SEãŒé³´ã‚Šçµ‚ã‚ã£ãŸé ƒï¼ˆ1ç§’å¾Œï¼‰ã«è³ªå•èª­ã¿ä¸Šã’
                playSeikai(); 
                setTimeout(() => {
                    showFixQuestion2();
                }, 1000);
            }
            disableYesNo('game2');
        } else {
            fb.innerText = "âŒ ã¡ãŒã„ã¾ã™...";
            fb.style.color = "red";
            playBubu();
        }
    }

    function showFixQuestion2() {
        const fixArea = document.getElementById('area-fix-game2');
        fixArea.style.display = 'block';
        
        const optsDiv = document.getElementById('opts-game2');
        optsDiv.innerHTML = '';
        
        let dummy = getRandom(places);
        while(dummy.id === g2Target.id) dummy = getRandom(places);
        
        const choices = shuffle([g2Target, dummy]);
        
        choices.forEach(c => {
            const btn = document.createElement('button');
            btn.className = 'option-btn';
            // â˜…ä¿®æ­£: ã‚¤ãƒ©ã‚¹ãƒˆç„¡ã—ã€æ–‡å­—ã®ã¿
            btn.innerText = c.name;
            btn.onclick = () => {
                if(c.id === g2Target.id) {
                    document.getElementById('feedback-game2').innerText = `â­•ï¸ ã›ã„ã‹ã„ï¼ ${g2Target.name} ã« ã„ãã¾ã™ã€‚`;
                    playSeikai();
                    
                    // æ­£è§£ã—ãŸã®ã§ç¢ºèªç”¨ã«ã‚¤ãƒ©ã‚¹ãƒˆã‚’è¦‹ã›ã‚‹ï¼ˆãƒ¡ã‚¤ãƒ³ç”»åƒã‚’æ›¸ãæ›ãˆã‚‹ãªã©ã®æ¼”å‡ºã§ã‚‚å¯ã§ã™ãŒã€ãƒ¡ã‚¤ãƒ³ç”»åƒã¯æ—¢ã«æ­£è§£ãªã®ã§ãã®ã¾ã¾ã§OKï¼‰
                    
                    const allOpts = optsDiv.querySelectorAll('button');
                    allOpts.forEach(b => b.disabled = true);
                    
                    // è‡ªå‹•ã§æ¬¡ã¸
                    setTimeout(() => initGame2(), 2000);
                } else {
                    playBubu();
                }
            };
            optsDiv.appendChild(btn);
        });
        
        speak("ã©ã“ã¸ ã„ãã¾ã™ã‹ï¼Ÿ");
    }

    // --- 6. Game 3 (æ‰‹æ®µ Yes/No) ---
    let g3Target, g3Wrong, g3IsCorrectCase;

    function initGame3() {
        resetGameUI('game3');
        g3Target = getRandom(transports);
        g3IsCorrectCase = Math.random() > 0.5;

        document.getElementById('img-game3').innerText = g3Target.emoji;

        let qText = "";
        let targetWord = g3Target.name + (g3Target.particle || '');

        if (g3IsCorrectCase) {
            qText = `${targetWord} ã„ãã¾ã™ã‹ï¼Ÿ`;
        } else {
            do { g3Wrong = getRandom(transports); } while(g3Wrong.id === g3Target.id);
            let wrongWord = g3Wrong.name + (g3Wrong.particle || '');
            qText = `${wrongWord} ã„ãã¾ã™ã‹ï¼Ÿ`;
        }
        document.getElementById('q3-text').innerText = qText;
        speak(qText);
    }

    function answerGame3(isYes) {
        const fb = document.getElementById('feedback-game3');
        let targetWord = g3Target.name + (g3Target.particle || '');

        if ( (g3IsCorrectCase && isYes) || (!g3IsCorrectCase && !isYes) ) {
            if(isYes) {
                fb.innerText = `â­•ï¸ ã¯ã„ã€${targetWord} ã„ãã¾ã™ã€‚`;
                fb.style.color = "green";
                playSeikai();
                // è‡ªå‹•ã§æ¬¡ã¸
                setTimeout(() => initGame3(), 2000);
            } else {
                playSeikai();
                // éŸ³å£°ãŒé‡ãªã‚‰ãªã„ã‚ˆã†ã«é…å»¶å®Ÿè¡Œ
                setTimeout(() => {
                    showFixQuestion3();
                }, 1000);
            }
            disableYesNo('game3');
        } else {
            fb.innerText = "âŒ ã¡ãŒã„ã¾ã™...";
            fb.style.color = "red";
            playBubu();
        }
    }

    function showFixQuestion3() {
        document.getElementById('area-fix-game3').style.display = 'block';
        const optsDiv = document.getElementById('opts-game3');
        optsDiv.innerHTML = '';
        
        let dummy = getRandom(transports);
        while(dummy.id === g3Target.id) dummy = getRandom(transports);
        
        const choices = shuffle([g3Target, dummy]);
        
        choices.forEach(c => {
            const btn = document.createElement('button');
            btn.className = 'option-btn';
            // â˜…ä¿®æ­£: ã‚¤ãƒ©ã‚¹ãƒˆç„¡ã—ã€æ–‡å­—ã®ã¿
            btn.innerText = c.name;
            btn.onclick = () => {
                if(c.id === g3Target.id) {
                    let text = c.name + (c.particle || '');
                    document.getElementById('feedback-game3').innerText = `â­•ï¸ ã›ã„ã‹ã„ï¼ ${text} ã„ãã¾ã™ã€‚`;
                    playSeikai();
                    
                    const allOpts = optsDiv.querySelectorAll('button');
                    allOpts.forEach(b => b.disabled = true);
                    
                    // è‡ªå‹•ã§æ¬¡ã¸
                    setTimeout(() => initGame3(), 2000);
                } else {
                    playBubu();
                }
            };
            optsDiv.appendChild(btn);
        });
        speak("ã©ã†ã‚„ã£ã¦ ã„ãã¾ã™ã‹ï¼Ÿ");
    }


    // --- 7. Game 4 (ç·åˆ) ---
    let g4Answer = "";

    function initGame4() {
        document.getElementById('feedback-game4').innerText = '';
        document.getElementById('area-game4').innerHTML = '';

        const sub = getRandom(people);
        const trn = getRandom(transports);
        const plc = getRandom(places);
        const vrb = getRandom(verbs);

        let enVerb = vrb.en;
        if(sub.id !== 'me' && sub.id !== 'you') enVerb += 's';
        let enTrn = trn.id === 'walk' ? 'on foot' : `by ${trn.en}`;
        
        const enText = `${sub.en} ${enVerb} to ${plc.en} ${enTrn}.`;
        document.getElementById('q4-text').innerText = enText;
        
        const p1 = sub.name + 'ã¯';
        const p2 = trn.name + (trn.particle || '');
        const p3 = plc.name + 'ã«';
        const p4 = vrb.name;

        g4Answer = p1 + p2 + p3 + p4;

        const parts = [p1, p2, p3, p4];
        const pool = document.getElementById('pool-game4');
        pool.innerHTML = '';
        shuffle(parts).forEach(txt => {
            const btn = document.createElement('div');
            btn.className = 'word-block';
            btn.innerText = txt;
            btn.onclick = () => moveBlock(btn, 'pool-game4', 'area-game4');
            pool.appendChild(btn);
        });
    }

    function checkGame4() {
        const blocks = document.querySelectorAll('#area-game4 .word-block');
        let userAnswer = "";
        blocks.forEach(b => userAnswer += b.innerText);

        const fb = document.getElementById('feedback-game4');
        if (userAnswer === g4Answer) {
            fb.innerText = "â­•ï¸ ã‹ã‚“ãºãã§ã™ï¼";
            fb.style.color = "green";
            playSeikai();
            // è‡ªå‹•ã§æ¬¡ã¸
            setTimeout(() => initGame4(), 2000);
        } else {
            fb.innerText = "âŒ ãŠã—ã„ï¼";
            fb.style.color = "red";
            playBubu();
        }
    }


    // --- ãƒ˜ãƒ«ãƒ‘ãƒ¼é–¢æ•° ---
    function resetGameUI(gameId) {
        const yesBtn = document.getElementById(`g${gameId.slice(-1)}-yes`);
        const noBtn = document.getElementById(`g${gameId.slice(-1)}-no`);
        yesBtn.disabled = false;
        noBtn.disabled = false;
        
        document.getElementById(`area-fix-${gameId}`).style.display = 'none';
        document.getElementById(`feedback-${gameId}`).innerText = '';
    }

    function disableYesNo(gameId) {
        const yesBtn = document.getElementById(`g${gameId.slice(-1)}-yes`);
        const noBtn = document.getElementById(`g${gameId.slice(-1)}-no`);
        yesBtn.disabled = true;
        noBtn.disabled = true;
    }

    // åˆæœŸåŒ–
    initStudy();

</script>
</body>
</html>