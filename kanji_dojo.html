<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>漢字・かきかた道場 - FunLearnJP</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<link href="https://fonts.googleapis.com/css2?family=Zen+Maru+Gothic:wght@500;700;900&family=Klee+One:wght@600&display=swap" rel="stylesheet">

<style>
    /* --- 共通デザイン --- */
    :root {
        --primary: #42a5f5;
        --accent: #ffcc5c;
        --bg-color: #f0f4f8;
        --text-color: #333;
        
        /* レベルカラー */
        --c-n5: #e57373; 
        --c-n4: #d32f2f; 
        --c-n3: #f57c00;
        --c-n2: #7b1fa2;
        --c-n1: #1976d2;
    }

    *, *::before, *::after { box-sizing: border-box; }

    body {
        font-family: 'Zen Maru Gothic', sans-serif;
        background-color: var(--bg-color);
        color: var(--text-color);
        margin: 0; padding: 0;
        min-height: 100vh;
        display: flex; flex-direction: column;
        user-select: none;
        touch-action: pan-y;
    }

    /* --- ヘッダー --- */
    header {
        background: linear-gradient(135deg, #42a5f5 0%, #4facfe 100%);
        color: white; padding: 15px 20px;
        box-shadow: 0 4px 15px rgba(66, 165, 245, 0.3); z-index: 100;
        display: flex; justify-content: space-between; align-items: center;
        position: sticky; top: 0;
    }
    .logo { font-size: 1.4em; font-weight: 900; color: white; text-decoration: none; text-shadow: 1px 1px 0 rgba(0,0,0,0.1); }
    .home-link { color: white; text-decoration: none; font-weight: bold; background: rgba(255,255,255,0.3); padding: 5px 12px; border-radius: 20px; }

    .container {
        flex-grow: 1; padding: 20px;
        width: 100%; max-width: 1000px; margin: 0 auto;
        display: flex; flex-direction: column; align-items: center;
    }

    /* --- 画面切り替え --- */
    .hidden { display: none !important; }
    .fade-in { animation: fadeIn 0.3s ease-in; }
    @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

    /* --- 1. レベル選択画面 (修正箇所) --- */
    .level-grid {
        display: grid;
        /* PCでは自動調整 */
        grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
        gap: 20px; width: 100%; padding: 10px;
    }

    /* ★スマホ対策：強制的に横2列にするCSS */
    @media (max-width: 600px) {
        .level-grid {
            grid-template-columns: repeat(2, 1fr); /* 2列固定 */
            gap: 15px;
        }
        .level-card {
            padding: 20px 10px; /* スマホ用に余白調整 */
        }
        .level-title {
            font-size: 2.5em; /* 少し文字サイズ調整 */
        }
    }

    .level-card {
        background: white; border-radius: 20px; padding: 30px 15px;
        text-align: center; cursor: pointer;
        box-shadow: 0 5px 15px rgba(0,0,0,0.05);
        transition: transform 0.2s, box-shadow 0.2s;
        border-bottom: 6px solid #ddd;
        position: relative; overflow: hidden;
    }
    .level-card:active { transform: translateY(3px); border-bottom-width: 3px; }
    
    .level-badge {
        display: inline-block; padding: 5px 10px; border-radius: 15px;
        color: white; font-weight: bold; margin-bottom: 10px;
        font-size: 0.8em; letter-spacing: 1px;
    }
    .level-title { font-weight: 900; line-height: 1; margin-bottom: 5px; font-family: 'Klee One', cursive; color: #444; }
    /* PCのデフォルトサイズ */
    @media (min-width: 601px) { .level-title { font-size: 3em; } }

    .level-desc { font-size: 0.85em; color: #888; font-weight: bold; }

    .lv-n5 .level-badge { background-color: var(--c-n5); } .lv-n5 { border-bottom-color: var(--c-n5); }
    .lv-n4 .level-badge { background-color: var(--c-n4); } .lv-n4 { border-bottom-color: var(--c-n4); }
    .lv-n3 .level-badge { background-color: var(--c-n3); } .lv-n3 { border-bottom-color: var(--c-n3); }
    .lv-locked { opacity: 0.6; cursor: not-allowed; background: #f9f9f9; border-bottom-color: #ccc; }
    .lv-locked .level-badge { background-color: #999; }

    /* --- 2. 練習リスト画面 --- */
    .list-header { width: 100%; display: flex; align-items: center; justify-content: space-between; margin-bottom: 20px; }
    .back-btn {
        display: inline-flex; align-items: center; gap: 8px;
        background: white; color: #555; padding: 10px 20px; border-radius: 25px;
        border: 2px solid #eee; font-weight: bold; cursor: pointer;
    }

    .kanji-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(80px, 1fr));
        gap: 15px; width: 100%; padding-bottom: 40px;
    }

    .kanji-card {
        background: white; border-radius: 15px; aspect-ratio: 1;
        display: flex; flex-direction: column; justify-content: center; align-items: center;
        cursor: pointer; box-shadow: 0 4px 0 rgba(0,0,0,0.1);
        transition: transform 0.1s; border: 2px solid transparent;
    }
    .kanji-card:active { transform: translateY(2px); box-shadow: none; }
    
    .kanji-char { font-family: 'Klee One', cursive; font-size: 2.5em; color: #333; line-height: 1; }

    /* --- 練習モーダル --- */
    .modal-overlay {
        position: fixed; top: 0; left: 0; right: 0; bottom: 0;
        background: rgba(0,0,0,0.85); backdrop-filter: blur(5px);
        display: none; justify-content: center; align-items: center;
        z-index: 1000; padding: 10px;
    }
    .modal-overlay.active { display: flex; animation: fadeIn 0.3s; }

    .modal-content {
        background: white; width: 100%; max-width: 800px;
        border-radius: 20px; overflow: hidden;
        display: flex; flex-direction: column; max-height: 95vh;
        box-shadow: 0 10px 30px rgba(0,0,0,0.3);
    }

    .modal-header {
        background: var(--bg-color); padding: 10px 15px;
        display: flex; justify-content: space-between; align-items: center;
        border-bottom: 2px solid #ddd;
    }
    .modal-title { font-weight: bold; font-size: 1.1em; color: #555; }
    .close-btn {
        background: #ddd; border: none; width: 32px; height: 32px; border-radius: 50%;
        font-size: 1.2em; color: #666; cursor: pointer;
    }

    .modal-body {
        display: flex; flex-direction: row;
        overflow-y: auto; flex-grow: 1; padding: 15px; gap: 20px;
        justify-content: center; align-items: flex-start;
    }

    /* 情報パネル */
    .info-panel { flex: 1; max-width: 250px; display: flex; flex-direction: column; gap: 10px; }
    .info-box { background: #f9f9f9; padding: 10px; border-radius: 12px; border-left: 5px solid #ccc; }
    .info-label { font-size: 0.75em; color: #888; font-weight: bold; margin-bottom: 2px; }
    .info-text { font-size: 1em; font-weight: bold; color: #333; line-height: 1.3; }

    /* キャンバス */
    .practice-panel { display: flex; flex-direction: column; align-items: center; gap: 10px; }
    .canvas-container {
        position: relative; width: 300px; height: 300px;
        background: white; border: 4px solid var(--primary); border-radius: 15px;
        cursor: crosshair; touch-action: none;
    }
    .canvas-guide {
        position: absolute; top: 0; left: 0; width: 100%; height: 100%;
        display: flex; justify-content: center; align-items: center;
        font-family: 'Klee One', cursive; font-size: 220px; color: #e0e0e0;
        pointer-events: none; user-select: none;
    }
    .canvas-lines { position: absolute; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; }
    .line-v { position: absolute; left: 50%; top: 10%; bottom: 10%; width: 0; border-left: 1px dashed #ccc; }
    .line-h { position: absolute; top: 50%; left: 10%; right: 10%; height: 0; border-top: 1px dashed #ccc; }
    canvas { position: absolute; top: 0; left: 0; z-index: 10; }

    /* コントロール */
    .controls { display: flex; gap: 10px; width: 100%; justify-content: center; margin-top: 5px; flex-wrap: wrap; }
    .btn {
        padding: 8px 16px; border-radius: 30px; border: none; font-weight: bold;
        cursor: pointer; font-size: 0.9em; display: flex; align-items: center; gap: 5px;
        box-shadow: 0 4px 0 rgba(0,0,0,0.1); font-family: 'Zen Maru Gothic', sans-serif;
    }
    .btn:active { transform: translateY(3px); box-shadow: none; }
    
    .btn-audio { background: #ff9800; color: white; box-shadow: 0 4px 0 #e65100; }
    .btn-clear { background: #f44336; color: white; box-shadow: 0 4px 0 #d32f2f; }
    .btn-done { background: #4caf50; color: white; box-shadow: 0 4px 0 #388e3c; font-size: 1.1em; padding: 10px 30px; }

    @media (max-width: 700px) {
        .modal-body { flex-direction: column; align-items: center; padding: 10px; }
        .info-panel { width: 100%; max-width: 100%; order: 2; flex-direction: row; flex-wrap: wrap; }
        .info-box { flex: 1; min-width: 80px; }
        .practice-panel { width: 100%; order: 1; }
        .canvas-container { width: 280px; height: 280px; }
        .canvas-guide { font-size: 200px; }
    }
</style>
</head>
<body>

<header>
    <a href="#" class="logo" onclick="location.reload()"><i class="fa-solid fa-pen-nib"></i> 漢字・かきかた道場</a>
    <a href="index.html" class="home-link"><i class="fa-solid fa-house"></i> ホーム</a>
</header>

<div class="container">
    
    <div id="level-select-view" class="fade-in">
        <h2 style="text-align:center; color:var(--primary);">レベルを選んでね</h2>
        <div class="level-grid">
            <div class="level-card lv-n5" onclick="selectLevel('n5')">
                <span class="level-badge">BASIC</span>
                <div class="level-title">N5</div>
                <div class="level-desc" id="count-n5">Loading...</div>
            </div>
            <div class="level-card lv-n4" onclick="selectLevel('n4')">
                <span class="level-badge">ELEMENTARY</span>
                <div class="level-title">N4</div>
                <div class="level-desc" id="count-n4">Loading...</div>
            </div>
            <div class="level-card lv-n3" onclick="selectLevel('n3')">
                <span class="level-badge">INTERMEDIATE</span>
                <div class="level-title">N3</div>
                <div class="level-desc" id="count-n3">Loading...</div>
            </div>
            <div class="level-card lv-locked">
                <span class="level-badge"><i class="fa-solid fa-lock"></i></span>
                <div class="level-title">N2</div>
            </div>
            <div class="level-card lv-locked">
                <span class="level-badge"><i class="fa-solid fa-lock"></i></span>
                <div class="level-title">N1</div>
            </div>
        </div>
    </div>

    <div id="kanji-list-view" class="hidden" style="width:100%;">
        <div class="list-header">
            <button class="back-btn" onclick="showLevelSelect()">
                <i class="fa-solid fa-arrow-left"></i> もどる
            </button>
            <h2 id="list-title" style="margin:0; color:var(--primary);">N5</h2>
        </div>
        <div class="kanji-grid" id="kanji-grid">
            </div>
    </div>

</div>

<div id="practice-modal" class="modal-overlay">
    <div class="modal-content">
        <div class="modal-header">
            <div class="modal-title"><i class="fa-solid fa-paintbrush"></i> かきかた</div>
            <button class="close-btn" onclick="closeModal()"><i class="fa-solid fa-times"></i></button>
        </div>
        
        <div class="modal-body">
            <div class="practice-panel">
                <div class="canvas-container" id="canvas-wrapper">
                    <div class="canvas-lines"><div class="line-v"></div><div class="line-h"></div></div>
                    <div id="guide-char" class="canvas-guide"></div>
                    <canvas id="draw-canvas" width="300" height="300"></canvas>
                </div>
                <div class="controls">
                    <button class="btn btn-audio" onclick="playAudio()"><i class="fa-solid fa-volume-high"></i> きく</button>
                    <button class="btn btn-clear" onclick="clearCanvas()"><i class="fa-solid fa-eraser"></i> けす</button>
                    <button class="btn btn-done" onclick="finishPractice()"><i class="fa-regular fa-circle-check"></i> できた！</button>
                </div>
            </div>

            <div class="info-panel">
                <div class="info-box">
                    <div class="info-label">オン (On)</div>
                    <div id="info-on" class="info-text"></div>
                </div>
                <div class="info-box">
                    <div class="info-label">くん (Kun)</div>
                    <div id="info-kun" class="info-text"></div>
                </div>
                <div class="info-box">
                    <div class="info-label">いみ (Meaning)</div>
                    <div id="info-mean" class="info-text"></div>
                </div>
            </div>
        </div>
    </div>
</div>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.2/firebase-app.js";
    import { getFirestore, doc, updateDoc, increment } from "https://www.gstatic.com/firebasejs/11.0.2/firebase-firestore.js";
    import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.0.2/firebase-auth.js";

    const firebaseConfig = {
      apiKey: "AIzaSyDpfbjezbYxrW3XMDegBSC5iFPEQEyD0Ls",
      authDomain: "funlearningjapanese-b8e08.firebaseapp.com",
      projectId: "funlearningjapanese-b8e08",
      storageBucket: "funlearningjapanese-b8e08.appspot.com",
      messagingSenderId: "1055688629268",
      appId: "1:1055688629268:web:248183b62f15c34a2d5b01",
      measurementId: "G-LCMXVLPS81"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);
    const auth = getAuth(app);
    
    window.currentUserId = null;

    onAuthStateChanged(auth, (user) => {
        if (user) {
            window.currentUserId = user.uid;
        } else {
            window.currentUserId = null;
        }
    });

    window.addPoints = async function(points) {
        if (!window.currentUserId) return;
        try {
            const userRef = doc(db, "users", window.currentUserId);
            await updateDoc(userRef, { points: increment(points) });
        } catch (e) {
            console.error(e);
        }
    }
</script>

<script>
    const kanjiDatabase = {
        "n5": [
            { "kanji": "一", "kun": "ひと", "on": "いち", "meaning": "One" }, { "kanji": "二", "kun": "ふた", "on": "に", "meaning": "Two" },
            { "kanji": "三", "kun": "み", "on": "さん", "meaning": "Three" }, { "kanji": "四", "kun": "よ・よん", "on": "し", "meaning": "Four" },
            { "kanji": "五", "kun": "いつ", "on": "ご", "meaning": "Five" }, { "kanji": "六", "kun": "む", "on": "ろく", "meaning": "Six" },
            { "kanji": "七", "kun": "なな", "on": "しち", "meaning": "Seven" }, { "kanji": "八", "kun": "や", "on": "はち", "meaning": "Eight" },
            { "kanji": "九", "kun": "ここの", "on": "く", "meaning": "Nine" }, { "kanji": "十", "kun": "とお", "on": "じゅう", "meaning": "Ten" },
            { "kanji": "百", "kun": "もも", "on": "ひゃく", "meaning": "Hundred" }, { "kanji": "千", "kun": "ち", "on": "せん", "meaning": "Thousand" },
            { "kanji": "万", "kun": "よろず", "on": "まん", "meaning": "10 Thousand" }, { "kanji": "円", "kun": "まる", "on": "えん", "meaning": "Yen/Circle" },
            { "kanji": "時", "kun": "とき", "on": "じ", "meaning": "Time" }, { "kanji": "年", "kun": "とし", "on": "ねん", "meaning": "Year" },
            { "kanji": "月", "kun": "つき", "on": "げつ", "meaning": "Month/Moon" }, { "kanji": "日", "kun": "ひ", "on": "にち", "meaning": "Day/Sun" },
            { "kanji": "上", "kun": "うえ", "on": "じょう", "meaning": "Up" }, { "kanji": "下", "kun": "した", "on": "か", "meaning": "Down" },
            { "kanji": "右", "kun": "みぎ", "on": "う", "meaning": "Right" }, { "kanji": "左", "kun": "ひだり", "on": "さ", "meaning": "Left" },
            { "kanji": "中", "kun": "なか", "on": "ちゅう", "meaning": "Middle" }, { "kanji": "北", "kun": "きた", "on": "ほく", "meaning": "North" },
            { "kanji": "南", "kun": "みなみ", "on": "なん", "meaning": "South" }, { "kanji": "東", "kun": "ひがし", "on": "とう", "meaning": "East" },
            { "kanji": "西", "kun": "にし", "on": "せい", "meaning": "West" }, { "kanji": "人", "kun": "ひと", "on": "じん", "meaning": "Person" },
            { "kanji": "今", "kun": "いま", "on": "こん", "meaning": "Now" }, { "kanji": "休", "kun": "やす", "on": "きゅう", "meaning": "Rest" },
            { "kanji": "会", "kun": "あ", "on": "かい", "meaning": "Meet" }, { "kanji": "何", "kun": "なに", "on": "か", "meaning": "What" },
            { "kanji": "先", "kun": "さき", "on": "せん", "meaning": "Previous" }, { "kanji": "入", "kun": "はい", "on": "にゅう", "meaning": "Enter" },
            { "kanji": "出", "kun": "で", "on": "しゅつ", "meaning": "Exit" }, { "kanji": "分", "kun": "わ", "on": "ふん", "meaning": "Minute/Part" },
            { "kanji": "前", "kun": "まえ", "on": "ぜん", "meaning": "Before" }, { "kanji": "午", "kun": "なし", "on": "ご", "meaning": "Noon" },
            { "kanji": "半", "kun": "なか", "on": "はん", "meaning": "Half" }, { "kanji": "友", "kun": "とも", "on": "ゆう", "meaning": "Friend" },
            { "kanji": "口", "kun": "くち", "on": "こう", "meaning": "Mouth" }, { "kanji": "古", "kun": "ふる", "on": "こ", "meaning": "Old" },
            { "kanji": "名", "kun": "な", "on": "めい", "meaning": "Name" }, { "kanji": "国", "kun": "くに", "on": "こく", "meaning": "Country" },
            { "kanji": "土", "kun": "つち", "on": "ど", "meaning": "Soil/Earth" }, { "kanji": "外", "kun": "そと", "on": "がい", "meaning": "Outside" },
            { "kanji": "多", "kun": "おお", "on": "た", "meaning": "Many" }, { "kanji": "大", "kun": "おお", "on": "だい", "meaning": "Big" },
            { "kanji": "天", "kun": "あま", "on": "てん", "meaning": "Heaven" }, { "kanji": "女", "kun": "おんな", "on": "じょ", "meaning": "Woman" },
            { "kanji": "子", "kun": "こ", "on": "し", "meaning": "Child" }, { "kanji": "学", "kun": "まな", "on": "がく", "meaning": "Study" },
            { "kanji": "安", "kun": "やす", "on": "あん", "meaning": "Cheap/Safe" }, { "kanji": "小", "kun": "ちい", "on": "しょう", "meaning": "Small" },
            { "kanji": "少", "kun": "すく", "on": "しょう", "meaning": "Few" }, { "kanji": "山", "kun": "やま", "on": "さん", "meaning": "Mountain" },
            { "kanji": "川", "kun": "かわ", "on": "せん", "meaning": "River" }, { "kanji": "店", "kun": "みせ", "on": "てん", "meaning": "Shop" },
            { "kanji": "後", "kun": "あと", "on": "ご", "meaning": "After" }, { "kanji": "手", "kun": "て", "on": "しゅ", "meaning": "Hand" },
            { "kanji": "新", "kun": "あたら", "on": "しん", "meaning": "New" }, { "kanji": "書", "kun": "か", "on": "しょ", "meaning": "Write" },
            { "kanji": "木", "kun": "き", "on": "もく", "meaning": "Tree" }, { "kanji": "本", "kun": "もと", "on": "ほん", "meaning": "Book" },
            { "kanji": "来", "kun": "く", "on": "らい", "meaning": "Come" }, { "kanji": "校", "kun": "なし", "on": "こう", "meaning": "School" },
            { "kanji": "母", "kun": "はは", "on": "ぼ", "meaning": "Mother" }, { "kanji": "毎", "kun": "なし", "on": "まい", "meaning": "Every" },
            { "kanji": "気", "kun": "なし", "on": "き", "meaning": "Spirit" }, { "kanji": "水", "kun": "みず", "on": "すい", "meaning": "Water" },
            { "kanji": "火", "kun": "ひ", "on": "か", "meaning": "Fire" }, { "kanji": "父", "kun": "ちち", "on": "ふ", "meaning": "Father" },
            { "kanji": "生", "kun": "い", "on": "せい", "meaning": "Life" }, { "kanji": "男", "kun": "おとこ", "on": "だん", "meaning": "Man" },
            { "kanji": "白", "kun": "しろ", "on": "はく", "meaning": "White" }, { "kanji": "目", "kun": "め", "on": "もく", "meaning": "Eye" },
            { "kanji": "社", "kun": "やしろ", "on": "しゃ", "meaning": "Company" }, { "kanji": "空", "kun": "そら", "on": "くう", "meaning": "Sky" },
            { "kanji": "立", "kun": "た", "on": "りつ", "meaning": "Stand" }, { "kanji": "耳", "kun": "みみ", "on": "じ", "meaning": "Ear" },
            { "kanji": "聞", "kun": "き", "on": "ぶん", "meaning": "Listen" }, { "kanji": "花", "kun": "はな", "on": "か", "meaning": "Flower" },
            { "kanji": "行", "kun": "い", "on": "こう", "meaning": "Go" }, { "kanji": "見", "kun": "み", "on": "けん", "meaning": "See" },
            { "kanji": "言", "kun": "い", "on": "げん", "meaning": "Say" }, { "kanji": "話", "kun": "はなし", "on": "わ", "meaning": "Talk" },
            { "kanji": "語", "kun": "かた", "on": "ご", "meaning": "Language" }, { "kanji": "読", "kun": "よ", "on": "どく", "meaning": "Read" },
            { "kanji": "買", "kun": "か", "on": "ばい", "meaning": "Buy" }, { "kanji": "足", "kun": "あし", "on": "そく", "meaning": "Foot/Leg" },
            { "kanji": "車", "kun": "くるま", "on": "しゃ", "meaning": "Car" }, { "kanji": "週", "kun": "なし", "on": "しゅう", "meaning": "Week" },
            { "kanji": "道", "kun": "みち", "on": "どう", "meaning": "Road" }, { "kanji": "金", "kun": "かね", "on": "きん", "meaning": "Gold" },
            { "kanji": "長", "kun": "なが", "on": "ちょう", "meaning": "Long" }, { "kanji": "間", "kun": "あいだ", "on": "かん", "meaning": "Between" },
            { "kanji": "雨", "kun": "あめ", "on": "う", "meaning": "Rain" }, { "kanji": "電", "kun": "なし", "on": "でん", "meaning": "Electricity" },
            { "kanji": "食", "kun": "た", "on": "しょく", "meaning": "Eat" }, { "kanji": "飲", "kun": "の", "on": "いん", "meaning": "Drink" },
            { "kanji": "駅", "kun": "なし", "on": "えき", "meaning": "Station" }, { "kanji": "高", "kun": "たか", "on": "こう", "meaning": "High" },
            { "kanji": "魚", "kun": "さかな", "on": "ぎょ", "meaning": "Fish" }
        ],
        "n4": [
            { "kanji": "不", "kun": "", "on": "ふ", "meaning": "negative, non-, bad" },
            { "kanji": "世", "kun": "よ", "on": "せ、せい", "meaning": "world, generation" },
            { "kanji": "主", "kun": "おも、ぬし", "on": "しゅ", "meaning": "master, main" },
            { "kanji": "乗", "kun": "の(る)", "on": "じょう", "meaning": "ride" },
            { "kanji": "事", "kun": "こと", "on": "じ", "meaning": "matter, thing" },
            { "kanji": "京", "kun": "", "on": "きょう", "meaning": "capital" },
            { "kanji": "仕", "kun": "つか(える)", "on": "し", "meaning": "serve, do" },
            { "kanji": "代", "kun": "か(わる)", "on": "だい", "meaning": "substitute, age" },
            { "kanji": "以", "kun": "", "on": "い", "meaning": "by means of, compared with" },
            { "kanji": "低", "kun": "ひく(い)", "on": "てい", "meaning": "low" },
            { "kanji": "住", "kun": "す(む)", "on": "じゅう", "meaning": "dwell, live" },
            { "kanji": "体", "kun": "からだ", "on": "たい", "meaning": "body" },
            { "kanji": "作", "kun": "つく(る)", "on": "さく、さ", "meaning": "make" },
            { "kanji": "使", "kun": "つか(う)", "on": "し", "meaning": "use" },
            { "kanji": "便", "kun": "たよ(り)", "on": "べん、びん", "meaning": "convenience, letter" },
            { "kanji": "借", "kun": "か(りる)", "on": "しゃく", "meaning": "borrow" },
            { "kanji": "働", "kun": "はたら(く)", "on": "どう", "meaning": "work" },
            { "kanji": "元", "kun": "もと", "on": "げん、がん", "meaning": "origin, former" },
            { "kanji": "兄", "kun": "あに", "on": "きょう", "meaning": "older brother" },
            { "kanji": "光", "kun": "ひかり、ひか(る)", "on": "こう", "meaning": "light" },
            { "kanji": "写", "kun": "うつ(す)", "on": "しゃ", "meaning": "copy, photograph" },
            { "kanji": "冬", "kun": "ふゆ", "on": "とう", "meaning": "winter" },
            { "kanji": "切", "kun": "き(る)", "on": "せつ", "meaning": "cut" },
            { "kanji": "別", "kun": "わか(れる)", "on": "べつ", "meaning": "separate" },
            { "kanji": "力", "kun": "ちから", "on": "りょく", "meaning": "power" },
            { "kanji": "勉", "kun": "つと(める)", "on": "べん", "meaning": "exertion" },
            { "kanji": "動", "kun": "うご(く)", "on": "どう", "meaning": "move" },
            { "kanji": "区", "kun": "", "on": "く", "meaning": "ward, district" },
            { "kanji": "医", "kun": "", "on": "い", "meaning": "doctor, medicine" },
            { "kanji": "去", "kun": "さ(る)", "on": "きょ、こ", "meaning": "leave, past" },
            { "kanji": "台", "kun": "", "on": "だい、たい", "meaning": "stand, pedestal" },
            { "kanji": "合", "kun": "あ(う)", "on": "ごう", "meaning": "fit, join" },
            { "kanji": "同", "kun": "おな(じ)", "on": "どう", "meaning": "same" },
            { "kanji": "味", "kun": "あじ", "on": "み", "meaning": "taste" },
            { "kanji": "品", "kun": "しな", "on": "ひん", "meaning": "goods, refinement" },
            { "kanji": "員", "kun": "", "on": "いん", "meaning": "member" },
            { "kanji": "問", "kun": "と(う)", "on": "もん", "meaning": "question" },
            { "kanji": "回", "kun": "まわ(る)", "on": "かい", "meaning": "turn, times" },
            { "kanji": "図", "kun": "", "on": "ず、と", "meaning": "map, drawing" },
            { "kanji": "地", "kun": "", "on": "ち、じ", "meaning": "ground, earth" },
            { "kanji": "堂", "kun": "", "on": "どう", "meaning": "public chamber, hall" },
            { "kanji": "場", "kun": "ば", "on": "じょう", "meaning": "place" },
            { "kanji": "声", "kun": "こえ", "on": "せい", "meaning": "voice" },
            { "kanji": "売", "kun": "う(る)", "on": "ばい", "meaning": "sell" },
            { "kanji": "夏", "kun": "なつ", "on": "か", "meaning": "summer" },
            { "kanji": "夕", "kun": "ゆう", "on": "せき", "meaning": "evening" },
            { "kanji": "夜", "kun": "よる", "on": "や", "meaning": "night" },
            { "kanji": "太", "kun": "ふと(い)", "on": "たい", "meaning": "fat, thick" },
            { "kanji": "好", "kun": "す(き)", "on": "こう", "meaning": "like" },
            { "kanji": "妹", "kun": "いもうと", "on": "まい", "meaning": "younger sister" },
            { "kanji": "姉", "kun": "あね", "on": "し", "meaning": "older sister" },
            { "kanji": "始", "kun": "はじ(まる)", "on": "し", "meaning": "begin" },
            { "kanji": "字", "kun": "", "on": "じ", "meaning": "character" },
            { "kanji": "室", "kun": "むろ", "on": "しつ", "meaning": "room" },
            { "kanji": "家", "kun": "いえ、や", "on": "か", "meaning": "house" },
            { "kanji": "寒", "kun": "さむ(い)", "on": "かん", "meaning": "cold" },
            { "kanji": "屋", "kun": "や", "on": "おく", "meaning": "roof, shop" },
            { "kanji": "工", "kun": "", "on": "こう", "meaning": "construction, industry" },
            { "kanji": "市", "kun": "いち", "on": "し", "meaning": "city, market" },
            { "kanji": "帰", "kun": "かえ(る)", "on": "き", "meaning": "return" },
            { "kanji": "広", "kun": "ひろ(い)", "on": "こう", "meaning": "wide" },
            { "kanji": "度", "kun": "たび", "on": "ど", "meaning": "degree, time(s)" },
            { "kanji": "建", "kun": "た(てる)", "on": "けん", "meaning": "build" },
            { "kanji": "引", "kun": "ひ(く)", "on": "いん", "meaning": "pull" },
            { "kanji": "弟", "kun": "おとうと", "on": "だい", "meaning": "younger brother" },
            { "kanji": "弱", "kun": "よわ(い)", "on": "じゃく", "meaning": "weak" },
            { "kanji": "強", "kun": "つよ(い)", "on": "きょう", "meaning": "strong" },
            { "kanji": "待", "kun": "ま(つ)", "on": "たい", "meaning": "wait" },
            { "kanji": "心", "kun": "こころ", "on": "しん", "meaning": "heart" },
            { "kanji": "思", "kun": "おも(う)", "on": "し", "meaning": "think" },
            { "kanji": "急", "kun": "いそ(ぐ)", "on": "きゅう", "meaning": "hurry" },
            { "kanji": "悪", "kun": "わる(い)", "on": "あく", "meaning": "bad" },
            { "kanji": "意", "kun": "", "on": "い", "meaning": "mind, meaning" },
            { "kanji": "所", "kun": "ところ", "on": "しょ", "meaning": "place" },
            { "kanji": "持", "kun": "も(つ)", "on": "じ", "meaning": "hold" },
            { "kanji": "教", "kun": "おし(える)", "on": "きょう", "meaning": "teach" },
            { "kanji": "文", "kun": "ふみ", "on": "ぶん、もん", "meaning": "sentence, literature" },
            { "kanji": "料", "kun": "", "on": "りょう", "meaning": "fee, material" },
            { "kanji": "方", "kun": "かた", "on": "ほう", "meaning": "direction, person" },
            { "kanji": "旅", "kun": "たび", "on": "りょ", "meaning": "travel" },
            { "kanji": "族", "kun": "", "on": "ぞく", "meaning": "tribe, family" },
            { "kanji": "早", "kun": "はや(い)", "on": "そう", "meaning": "early" },
            { "kanji": "明", "kun": "あか(るい)", "on": "めい", "meaning": "bright" },
            { "kanji": "映", "kun": "うつ(る)", "on": "えい", "meaning": "reflect, projection" },
            { "kanji": "春", "kun": "はる", "on": "しゅん", "meaning": "spring" },
            { "kanji": "昼", "kun": "ひる", "on": "ちゅう", "meaning": "noon, daytime" },
            { "kanji": "暑", "kun": "あつ(い)", "on": "しょ", "meaning": "hot (weather)" },
            { "kanji": "暗", "kun": "くら(い)", "on": "あん", "meaning": "dark" },
            { "kanji": "曜", "kun": "", "on": "よう", "meaning": "weekday" },
            { "kanji": "有", "kun": "あ(る)", "on": "ゆう", "meaning": "have, exist" },
            { "kanji": "服", "kun": "", "on": "ふく", "meaning": "clothes" },
            { "kanji": "朝", "kun": "あさ", "on": "ちょう", "meaning": "morning" },
            { "kanji": "村", "kun": "むら", "on": "そん", "meaning": "village" },
            { "kanji": "林", "kun": "はやし", "on": "りん", "meaning": "grove" },
            { "kanji": "森", "kun": "もり", "on": "しん", "meaning": "forest" },
            { "kanji": "業", "kun": "", "on": "ぎょう", "meaning": "business, industry" },
            { "kanji": "楽", "kun": "たの(しい)", "on": "らく、がく", "meaning": "comfort, music" },
            { "kanji": "歌", "kun": "うた", "on": "か", "meaning": "song" },
            { "kanji": "止", "kun": "と(まる)", "on": "し", "meaning": "stop" },
            { "kanji": "正", "kun": "ただ(しい)", "on": "せい、しょう", "meaning": "correct" },
            { "kanji": "歩", "kun": "ある(く)", "on": "ほ", "meaning": "walk" },
            { "kanji": "死", "kun": "し(ぬ)", "on": "し", "meaning": "death" },
            { "kanji": "民", "kun": "たみ", "on": "みん", "meaning": "people, nation" },
            { "kanji": "池", "kun": "いけ", "on": "ち", "meaning": "pond" },
            { "kanji": "注", "kun": "そそ(ぐ)", "on": "ちゅう", "meaning": "pour, note" },
            { "kanji": "洋", "kun": "", "on": "よう", "meaning": "ocean, western" },
            { "kanji": "洗", "kun": "あら(う)", "on": "せん", "meaning": "wash" },
            { "kanji": "海", "kun": "うみ", "on": "かい", "meaning": "sea" },
            { "kanji": "漢", "kun": "", "on": "かん", "meaning": "China" },
            { "kanji": "牛", "kun": "うし", "on": "ぎゅう", "meaning": "cow" },
            { "kanji": "物", "kun": "もの", "on": "ぶつ", "meaning": "thing" },
            { "kanji": "特", "kun": "", "on": "とく", "meaning": "special" },
            { "kanji": "犬", "kun": "いぬ", "on": "けん", "meaning": "dog" },
            { "kanji": "理", "kun": "", "on": "り", "meaning": "reason, logic" },
            { "kanji": "産", "kun": "う(む)", "on": "さん", "meaning": "give birth, product" },
            { "kanji": "用", "kun": "もち(いる)", "on": "よう", "meaning": "use, business" },
            { "kanji": "田", "kun": "た", "on": "でん", "meaning": "rice field" },
            { "kanji": "町", "kun": "まち", "on": "ちょう", "meaning": "town" },
            { "kanji": "画", "kun": "", "on": "が、かく", "meaning": "picture, stroke" },
            { "kanji": "界", "kun": "", "on": "かい", "meaning": "world, boundary" },
            { "kanji": "病", "kun": "やまい", "on": "びょう", "meaning": "sick" },
            { "kanji": "発", "kun": "", "on": "はつ", "meaning": "departure, emit" },
            { "kanji": "県", "kun": "", "on": "けん", "meaning": "prefecture" },
            { "kanji": "真", "kun": "ま", "on": "しん", "meaning": "true" },
            { "kanji": "着", "kun": "き(る)、つ(く)", "on": "ちゃく", "meaning": "wear, arrive" },
            { "kanji": "知", "kun": "し(る)", "on": "ち", "meaning": "know" },
            { "kanji": "短", "kun": "みじか(い)", "on": "たん", "meaning": "short" },
            { "kanji": "研", "kun": "と(ぐ)", "on": "けん", "meaning": "sharpen, study" },
            { "kanji": "私", "kun": "わたし", "on": "し", "meaning": "I, private" },
            { "kanji": "秋", "kun": "あき", "on": "しゅう", "meaning": "autumn" },
            { "kanji": "究", "kun": "きわ(める)", "on": "きゅう", "meaning": "research" },
            { "kanji": "答", "kun": "こた(える)", "on": "とう", "meaning": "answer" },
            { "kanji": "紙", "kun": "かみ", "on": "し", "meaning": "paper" },
            { "kanji": "終", "kun": "お(わる)", "on": "しゅう", "meaning": "end" },
            { "kanji": "習", "kun": "なら(う)", "on": "しゅう", "meaning": "learn" },
            { "kanji": "考", "kun": "かんが(える)", "on": "こう", "meaning": "think" },
            { "kanji": "者", "kun": "もの", "on": "しゃ", "meaning": "person" },
            { "kanji": "肉", "kun": "", "on": "にく", "meaning": "meat" },
            { "kanji": "自", "kun": "みずか(ら)", "on": "じ", "meaning": "self" },
            { "kanji": "色", "kun": "いろ", "on": "しょく", "meaning": "color" },
            { "kanji": "英", "kun": "", "on": "えい", "meaning": "England, brilliant" },
            { "kanji": "茶", "kun": "", "on": "ちゃ、さ", "meaning": "tea" },
            { "kanji": "菜", "kun": "な", "on": "さい", "meaning": "vegetable" },
            { "kanji": "薬", "kun": "くすり", "on": "やく", "meaning": "medicine" },
            { "kanji": "親", "kun": "おや", "on": "しん", "meaning": "parent" },
            { "kanji": "計", "kun": "はか(る)", "on": "けい", "meaning": "measure" },
            { "kanji": "試", "kun": "ため(す)", "on": "し", "meaning": "test" },
            { "kanji": "説", "kun": "と(く)", "on": "せつ", "meaning": "explain" },
            { "kanji": "貸", "kun": "か(す)", "on": "たい", "meaning": "lend" },
            { "kanji": "質", "kun": "", "on": "しつ", "meaning": "quality" },
            { "kanji": "赤", "kun": "あか", "on": "せき", "meaning": "red" },
            { "kanji": "走", "kun": "はし(る)", "on": "そう", "meaning": "run" },
            { "kanji": "起", "kun": "お(きる)", "on": "き", "meaning": "wake up" },
            { "kanji": "転", "kun": "ころ(ぶ)", "on": "てん", "meaning": "revolve" },
            { "kanji": "軽", "kun": "かる(い)", "on": "けい", "meaning": "light (weight)" },
            { "kanji": "近", "kun": "ちか(い)", "on": "きん", "meaning": "near" },
            { "kanji": "送", "kun": "おく(る)", "on": "そう", "meaning": "send" },
            { "kanji": "通", "kun": "とお(る)", "on": "つう", "meaning": "pass through" },
            { "kanji": "進", "kun": "すす(む)", "on": "しん", "meaning": "advance" },
            { "kanji": "運", "kun": "はこ(ぶ)", "on": "うん", "meaning": "carry, luck" },
            { "kanji": "遠", "kun": "とお(い)", "on": "えん", "meaning": "far" },
            { "kanji": "都", "kun": "みやこ", "on": "と", "meaning": "metropolis" },
            { "kanji": "重", "kun": "おも(い)", "on": "じゅう", "meaning": "heavy" },
            { "kanji": "野", "kun": "の", "on": "や", "meaning": "field" },
            { "kanji": "銀", "kun": "", "on": "ぎん", "meaning": "silver" },
            { "kanji": "門", "kun": "かど", "on": "もん", "meaning": "gate" },
            { "kanji": "開", "kun": "あ(ける)、ひら(く)", "on": "かい", "meaning": "open" },
            { "kanji": "院", "kun": "", "on": "いん", "meaning": "institution" },
            { "kanji": "集", "kun": "あつ(まる)", "on": "しゅう", "meaning": "gather" },
            { "kanji": "青", "kun": "あお", "on": "せい", "meaning": "blue" },
            { "kanji": "音", "kun": "おと", "on": "おん", "meaning": "sound" },
            { "kanji": "頭", "kun": "あたま", "on": "とう", "meaning": "head" },
            { "kanji": "題", "kun": "", "on": "だい", "meaning": "topic" },
            { "kanji": "顔", "kun": "かお", "on": "がん", "meaning": "face" },
            { "kanji": "風", "kun": "かぜ", "on": "ふう", "meaning": "wind" },
            { "kanji": "飯", "kun": "めし", "on": "はん", "meaning": "meal, rice" },
            { "kanji": "館", "kun": "", "on": "かん", "meaning": "building" },
            { "kanji": "首", "kun": "くび", "on": "しゅ", "meaning": "neck" },
            { "kanji": "験", "kun": "", "on": "けん", "meaning": "verification, test" },
            { "kanji": "鳥", "kun": "とり", "on": "ちょう", "meaning": "bird" },
            { "kanji": "黒", "kun": "くろ", "on": "こく", "meaning": "black" }
        ],
        "n3": [
            { "kanji": "与", "kun": "あた(える)", "on": "よ", "meaning": "give, award" },
            { "kanji": "両", "kun": "", "on": "りょう", "meaning": "both" },
            { "kanji": "予", "kun": "あらかじ(め)", "on": "よ", "meaning": "beforehand, previous" },
            { "kanji": "争", "kun": "あらそ(う)", "on": "そう", "meaning": "contend, dispute" },
            { "kanji": "互", "kun": "たが(い)", "on": "ご", "meaning": "mutually" },
            { "kanji": "亡", "kun": "な(くなる)", "on": "ぼう", "meaning": "deceased" },
            { "kanji": "交", "kun": "まじ(わる)", "on": "こう", "meaning": "mingle, mixing" },
            { "kanji": "他", "kun": "ほか", "on": "た", "meaning": "other" },
            { "kanji": "付", "kun": "つ(く)", "on": "ふ", "meaning": "adhere, attach" },
            { "kanji": "件", "kun": "", "on": "けん", "meaning": "affair, case" },
            { "kanji": "任", "kun": "まか(せる)", "on": "にん", "meaning": "responsibility" },
            { "kanji": "伝", "kun": "つた(える)", "on": "でん", "meaning": "transmit" },
            { "kanji": "似", "kun": "に(る)", "on": "じ", "meaning": "resemble" },
            { "kanji": "位", "kun": "くらい", "on": "い", "meaning": "rank" },
            { "kanji": "余", "kun": "あま(る)", "on": "よ", "meaning": "surplus" },
            { "kanji": "例", "kun": "たと(える)", "on": "れい", "meaning": "example" },
            { "kanji": "供", "kun": "とも", "on": "きょう", "meaning": "offer, attendant" },
            { "kanji": "係", "kun": "かか(る)", "on": "けい", "meaning": "person in charge" },
            { "kanji": "信", "kun": "", "on": "しん", "meaning": "faith, truth" },
            { "kanji": "倒", "kun": "たお(れる)", "on": "とう", "meaning": "overthrow, fall" },
            { "kanji": "候", "kun": "そうろう", "on": "こう", "meaning": "climate, season" },
            { "kanji": "値", "kun": "ね、あたい", "on": "ち", "meaning": "price, cost, value" },
            { "kanji": "偉", "kun": "えら(い)", "on": "い", "meaning": "admirable, greatness" },
            { "kanji": "側", "kun": "がわ", "on": "そく", "meaning": "side" },
            { "kanji": "偶", "kun": "", "on": "ぐう", "meaning": "accidentally, even number" },
            { "kanji": "備", "kun": "そな(える)", "on": "び", "meaning": "equip, provision" },
            { "kanji": "優", "kun": "やさ(しい)", "on": "ゆう", "meaning": "tenderness, excel" },
            { "kanji": "全", "kun": "すべ(て)", "on": "ぜん", "meaning": "whole" },
            { "kanji": "共", "kun": "とも", "on": "きょう", "meaning": "together" },
            { "kanji": "具", "kun": "", "on": "ぐ", "meaning": "tool" },
            { "kanji": "内", "kun": "うち", "on": "ない", "meaning": "inside" },
            { "kanji": "最", "kun": "もっと(も)", "on": "さい", "meaning": "utmost" },
            { "kanji": "冷", "kun": "つめ(たい)", "on": "れい", "meaning": "cool" },
            { "kanji": "処", "kun": "", "on": "しょ", "meaning": "dispose, manage" },
            { "kanji": "列", "kun": "", "on": "れつ", "meaning": "file, row" },
            { "kanji": "初", "kun": "はじ(め)", "on": "しょ", "meaning": "first" },
            { "kanji": "判", "kun": "", "on": "はん", "meaning": "judgement, signature" },
            { "kanji": "利", "kun": "き(く)", "on": "り", "meaning": "profit" },
            { "kanji": "到", "kun": "", "on": "とう", "meaning": "arrival" },
            { "kanji": "制", "kun": "", "on": "せい", "meaning": "system, law" },
            { "kanji": "刻", "kun": "きざ(む)", "on": "こく", "meaning": "engrave, cut" },
            { "kanji": "割", "kun": "わ(る)", "on": "かつ", "meaning": "divide, proportion" },
            { "kanji": "加", "kun": "くわ(える)", "on": "か", "meaning": "add" },
            { "kanji": "助", "kun": "たす(ける)", "on": "じょ", "meaning": "help" },
            { "kanji": "努", "kun": "つと(める)", "on": "ど", "meaning": "toil, diligent" },
            { "kanji": "労", "kun": "", "on": "ろう", "meaning": "labor" },
            { "kanji": "務", "kun": "つと(める)", "on": "む", "meaning": "task, duty" },
            { "kanji": "勝", "kun": "か(つ)", "on": "しょう", "meaning": "win" },
            { "kanji": "勤", "kun": "つと(める)", "on": "きん", "meaning": "diligence, employed" },
            { "kanji": "化", "kun": "ば(ける)", "on": "か", "meaning": "change" },
            { "kanji": "単", "kun": "", "on": "たん", "meaning": "simple" },
            { "kanji": "危", "kun": "あぶ(ない)", "on": "き", "meaning": "dangerous" },
            { "kanji": "原", "kun": "はら", "on": "げん", "meaning": "meadow, original" },
            { "kanji": "参", "kun": "まい(る)", "on": "さん", "meaning": "visit, three" },
            { "kanji": "反", "kun": "そ(る)", "on": "はん", "meaning": "anti-" },
            { "kanji": "収", "kun": "おさ(める)", "on": "しゅう", "meaning": "income, obtain" },
            { "kanji": "取", "kun": "と(る)", "on": "しゅ", "meaning": "take" },
            { "kanji": "受", "kun": "う(ける)", "on": "じゅ", "meaning": "accept" },
            { "kanji": "号", "kun": "", "on": "ごう", "meaning": "number, item" },
            { "kanji": "向", "kun": "む(く)", "on": "こう", "meaning": "yonder, facing" },
            { "kanji": "君", "kun": "きみ", "on": "くん", "meaning": "you, ruler" },
            { "kanji": "否", "kun": "いな", "on": "ひ", "meaning": "negate" },
            { "kanji": "吸", "kun": "す(う)", "on": "きゅう", "meaning": "suck" },
            { "kanji": "吹", "kun": "ふ(く)", "on": "すい", "meaning": "blow" },
            { "kanji": "告", "kun": "つ(げる)", "on": "こく", "meaning": "revelation, inform" },
            { "kanji": "呼", "kun": "よ(ぶ)", "on": "こ", "meaning": "call" },
            { "kanji": "命", "kun": "いのち", "on": "めい", "meaning": "fate, life" },
            { "kanji": "和", "kun": "やわ(らぐ)", "on": "わ", "meaning": "harmony, peace" },
            { "kanji": "商", "kun": "あきな(う)", "on": "しょう", "meaning": "make a deal, merchant" },
            { "kanji": "喜", "kun": "よろこ(ぶ)", "on": "き", "meaning": "rejoice" },
            { "kanji": "因", "kun": "よ(る)", "on": "いん", "meaning": "cause" },
            { "kanji": "困", "kun": "こま(る)", "on": "こん", "meaning": "quandary" },
            { "kanji": "園", "kun": "その", "on": "えん", "meaning": "park, garden" },
            { "kanji": "在", "kun": "あ(る)", "on": "ざい", "meaning": "exist" },
            { "kanji": "報", "kun": "むく(いる)", "on": "ほう", "meaning": "report" },
            { "kanji": "増", "kun": "ふ(える)", "on": "ぞう", "meaning": "increase" },
            { "kanji": "変", "kun": "か(わる)", "on": "へん", "meaning": "unusual, change" },
            { "kanji": "夢", "kun": "ゆめ", "on": "む", "meaning": "dream" },
            { "kanji": "夫", "kun": "おっと", "on": "ふ", "meaning": "husband" },
            { "kanji": "失", "kun": "うしな(う)", "on": "しつ", "meaning": "lose" },
            { "kanji": "妻", "kun": "つま", "on": "さい", "meaning": "wife" },
            { "kanji": "娘", "kun": "むすめ", "on": "じょう", "meaning": "daughter" },
            { "kanji": "婚", "kun": "", "on": "こん", "meaning": "marriage" },
            { "kanji": "婦", "kun": "", "on": "ふ", "meaning": "lady" },
            { "kanji": "存", "kun": "", "on": "そん", "meaning": "exist" },
            { "kanji": "宅", "kun": "", "on": "たく", "meaning": "home" },
            { "kanji": "守", "kun": "まも(る)", "on": "しゅ", "meaning": "guard, protect" },
            { "kanji": "完", "kun": "", "on": "かん", "meaning": "perfect, completion" },
            { "kanji": "官", "kun": "", "on": "かん", "meaning": "bureaucrat" },
            { "kanji": "定", "kun": "さだ(める)", "on": "てい", "meaning": "determine" },
            { "kanji": "実", "kun": "み", "on": "じつ", "meaning": "reality, truth" },
            { "kanji": "客", "kun": "", "on": "きゃく", "meaning": "guest" },
            { "kanji": "害", "kun": "", "on": "がい", "meaning": "harm" },
            { "kanji": "容", "kun": "", "on": "よう", "meaning": "contain, form" },
            { "kanji": "宿", "kun": "やど", "on": "しゅく", "meaning": "inn, lodging" },
            { "kanji": "寄", "kun": "よ(る)", "on": "き", "meaning": "draw near" },
            { "kanji": "富", "kun": "とみ", "on": "ふ", "meaning": "wealth" },
            { "kanji": "寝", "kun": "ね(る)", "on": "しん", "meaning": "sleep" },
            { "kanji": "察", "kun": "", "on": "さつ", "meaning": "guess, presume" },
            { "kanji": "対", "kun": "", "on": "たい", "meaning": "vis-a-vis, opposite" },
            { "kanji": "局", "kun": "", "on": "きょく", "meaning": "bureau" },
            { "kanji": "居", "kun": "い(る)", "on": "きょ", "meaning": "reside" },
            { "kanji": "差", "kun": "さ(す)", "on": "さ", "meaning": "distinction, difference" },
            { "kanji": "師", "kun": "", "on": "し", "meaning": "expert, teacher" },
            { "kanji": "席", "kun": "", "on": "せき", "meaning": "seat" },
            { "kanji": "常", "kun": "つね", "on": "じょう", "meaning": "usual" },
            { "kanji": "平", "kun": "たい(ら)", "on": "へい", "meaning": "even, flat, peace" },
            { "kanji": "幸", "kun": "さち、しあわ(せ)", "on": "こう", "meaning": "happiness" },
            { "kanji": "幾", "kun": "いく", "on": "き", "meaning": "how many" },
            { "kanji": "座", "kun": "すわ(る)", "on": "ざ", "meaning": "sit" },
            { "kanji": "庭", "kun": "にわ", "on": "てい", "meaning": "courtyard, garden" },
            { "kanji": "式", "kun": "", "on": "しき", "meaning": "style, ceremony" },
            { "kanji": "当", "kun": "あ(たる)", "on": "とう", "meaning": "hit, right" },
            { "kanji": "形", "kun": "かたち", "on": "けい", "meaning": "shape" },
            { "kanji": "役", "kun": "", "on": "やく", "meaning": "duty, role" },
            { "kanji": "彼", "kun": "かれ", "on": "ひ", "meaning": "he" },
            { "kanji": "徒", "kun": "", "on": "と", "meaning": "on foot, junior" },
            { "kanji": "得", "kun": "え(る)", "on": "とく", "meaning": "gain" },
            { "kanji": "御", "kun": "おん", "on": "ぎょ", "meaning": "honorable" },
            { "kanji": "必", "kun": "かなら(ず)", "on": "ひつ", "meaning": "invariably, certain" },
            { "kanji": "忘", "kun": "わす(れる)", "on": "ぼう", "meaning": "forget" },
            { "kanji": "忙", "kun": "いそが(しい)", "on": "ぼう", "meaning": "busy" },
            { "kanji": "念", "kun": "", "on": "ねん", "meaning": "wish, sense" },
            { "kanji": "怒", "kun": "おこ(る)", "on": "ど", "meaning": "angry" },
            { "kanji": "怖", "kun": "こわ(い)", "on": "ふ", "meaning": "dreadful" },
            { "kanji": "性", "kun": "", "on": "せい", "meaning": "sex, gender, nature" },
            { "kanji": "恐", "kun": "おそ(れる)", "on": "きょう", "meaning": "fear" },
            { "kanji": "恥", "kun": "は(じる)", "on": "ち", "meaning": "shame" },
            { "kanji": "息", "kun": "いき", "on": "そく", "meaning": "breath" },
            { "kanji": "悲", "kun": "かな(しい)", "on": "ひ", "meaning": "sad" },
            { "kanji": "情", "kun": "なさ(け)", "on": "じょう", "meaning": "feelings" },
            { "kanji": "想", "kun": "", "on": "そう", "meaning": "concept, think" },
            { "kanji": "愛", "kun": "", "on": "あい", "meaning": "love" },
            { "kanji": "感", "kun": "", "on": "かん", "meaning": "emotion, feeling" },
            { "kanji": "慣", "kun": "な(れる)", "on": "かん", "meaning": "accustomed" },
            { "kanji": "成", "kun": "な(る)", "on": "せい", "meaning": "turn into" },
            { "kanji": "戦", "kun": "たたか(う)", "on": "せん", "meaning": "war" },
            { "kanji": "戻", "kun": "もど(る)", "on": "れい", "meaning": "re-" },
            { "kanji": "才", "kun": "", "on": "さい", "meaning": "genius" },
            { "kanji": "打", "kun": "う(つ)", "on": "だ", "meaning": "strike" },
            { "kanji": "払", "kun": "はら(う)", "on": "ふつ", "meaning": "pay" },
            { "kanji": "投", "kun": "な(げる)", "on": "とう", "meaning": "throw" },
            { "kanji": "折", "kun": "お(る)", "on": "せつ", "meaning": "fold, break" },
            { "kanji": "抜", "kun": "ぬ(く)", "on": "ばつ", "meaning": "slip out" },
            { "kanji": "抱", "kun": "だ(く)", "on": "ほう", "meaning": "embrace" },
            { "kanji": "押", "kun": "お(す)", "on": "おう", "meaning": "push" },
            { "kanji": "招", "kun": "まね(く)", "on": "しょう", "meaning": "beckon" },
            { "kanji": "指", "kun": "ゆび", "on": "し", "meaning": "finger" },
            { "kanji": "捕", "kun": "と(る)", "on": "ほ", "meaning": "catch" },
            { "kanji": "掛", "kun": "か(ける)", "on": "かい", "meaning": "hang" },
            { "kanji": "探", "kun": "さが(す)", "on": "たん", "meaning": "grope, search" },
            { "kanji": "支", "kun": "ささ(える)", "on": "し", "meaning": "branch, support" },
            { "kanji": "放", "kun": "はな(す)", "on": "ほう", "meaning": "set free" },
            { "kanji": "政", "kun": "まつりごと", "on": "せい", "meaning": "politics" },
            { "kanji": "敗", "kun": "やぶ(れる)", "on": "はい", "meaning": "failure" },
            { "kanji": "散", "kun": "ち(る)", "on": "さん", "meaning": "scatter" },
            { "kanji": "数", "kun": "かず", "on": "すう", "meaning": "number" },
            { "kanji": "断", "kun": "ことわ(る)", "on": "だん", "meaning": "decline" },
            { "kanji": "易", "kun": "やさ(しい)", "on": "えき", "meaning": "easy" },
            { "kanji": "昔", "kun": "むかし", "on": "せき", "meaning": "once upon a time" },
            { "kanji": "昨", "kun": "", "on": "さく", "meaning": "yesterday" },
            { "kanji": "晩", "kun": "", "on": "ばん", "meaning": "nightfall" },
            { "kanji": "景", "kun": "", "on": "けい", "meaning": "scenery" },
            { "kanji": "晴", "kun": "は(れる)", "on": "せい", "meaning": "clear up" },
            { "kanji": "暮", "kun": "く(れる)", "on": "ぼ", "meaning": "livelihood" },
            { "kanji": "曲", "kun": "ま(がる)", "on": "きょく", "meaning": "bend, music" },
            { "kanji": "更", "kun": "さら", "on": "こう", "meaning": "grow late, again" },
            { "kanji": "望", "kun": "のぞ(む)", "on": "ぼう", "meaning": "ambition, hope" },
            { "kanji": "期", "kun": "", "on": "き", "meaning": "period" },
            { "kanji": "未", "kun": "", "on": "み", "meaning": "not yet" },
            { "kanji": "末", "kun": "すえ", "on": "まつ", "meaning": "end" },
            { "kanji": "束", "kun": "たば", "on": "そく", "meaning": "bundle" },
            { "kanji": "杯", "kun": "さかずき", "on": "はい", "meaning": "counter for cupfuls" },
            { "kanji": "果", "kun": "は(たす)", "on": "か", "meaning": "fruit" },
            { "kanji": "格", "kun": "", "on": "かく", "meaning": "status" },
            { "kanji": "構", "kun": "かま(う)", "on": "こう", "meaning": "posture, build" },
            { "kanji": "様", "kun": "さま", "on": "よう", "meaning": "Esq., way" },
            { "kanji": "権", "kun": "", "on": "けん", "meaning": "authority" },
            { "kanji": "横", "kun": "よこ", "on": "おう", "meaning": "horizontal" },
            { "kanji": "機", "kun": "はた", "on": "き", "meaning": "machine" },
            { "kanji": "欠", "kun": "か(ける)", "on": "けつ", "meaning": "lack" },
            { "kanji": "次", "kun": "つぎ", "on": "じ", "meaning": "next" },
            { "kanji": "欲", "kun": "ほっ(する)", "on": "よく", "meaning": "longing" },
            { "kanji": "歯", "kun": "は", "on": "し", "meaning": "tooth" },
            { "kanji": "歳", "kun": "", "on": "さい", "meaning": "year-end, age" },
            { "kanji": "残", "kun": "のこ(る)", "on": "ざん", "meaning": "remainder" },
            { "kanji": "段", "kun": "", "on": "だん", "meaning": "grade, steps" },
            { "kanji": "殺", "kun": "ころ(す)", "on": "さつ", "meaning": "kill" },
            { "kanji": "求", "kun": "もと(める)", "on": "きゅう", "meaning": "request" },
            { "kanji": "決", "kun": "き(める)", "on": "けつ", "meaning": "decide" },
        ]
    };

    // --- 変数 ---
    const views = {
        select: document.getElementById('level-select-view'),
        list: document.getElementById('kanji-list-view')
    };
    const listTitle = document.getElementById('list-title');
    const grid = document.getElementById('kanji-grid');
    const modal = document.getElementById('practice-modal');
    const canvas = document.getElementById('draw-canvas');
    const ctx = canvas.getContext('2d');
    
    const synth = window.speechSynthesis;
    let voices = [];
    if(synth) synth.onvoiceschanged = () => { voices = synth.getVoices(); };

    let isDrawing = false;
    let currentKanji = null;

    // --- 初期表示: レベルの文字数 ---
    document.addEventListener('DOMContentLoaded', () => {
        document.getElementById('count-n5').textContent = kanjiDatabase['n5'].length + " Kanji";
        document.getElementById('count-n4').textContent = kanjiDatabase['n4'].length + " Kanji";
        document.getElementById('count-n3').textContent = kanjiDatabase['n3'].length + " Kanji";
        setTimeout(() => { if(synth) voices = synth.getVoices(); }, 500);
        setupCanvas();
    });

    // --- 画面切り替え ---
    window.selectLevel = (level) => {
        const data = kanjiDatabase[level];
        // リスト表示
        grid.innerHTML = '';
        data.forEach((item) => {
            const card = document.createElement('div');
            card.className = 'kanji-card';
            card.innerHTML = `<div class="kanji-char">${item.kanji}</div>`;
            card.onclick = () => openModal(item);
            grid.appendChild(card);
        });

        // タイトル色設定
        const colorVar = getComputedStyle(document.documentElement).getPropertyValue(`--c-${level}`);
        listTitle.textContent = `${level.toUpperCase()} 道場 (${data.length}字)`;
        listTitle.style.color = colorVar;

        // 遷移
        views.select.classList.add('hidden');
        views.list.classList.remove('hidden');
        views.list.classList.add('fade-in');
        window.scrollTo(0, 0);
    };

    window.showLevelSelect = () => {
        views.list.classList.add('hidden');
        views.select.classList.remove('hidden');
        views.select.classList.add('fade-in');
    };

    // --- モーダル操作 ---
    window.openModal = (item) => {
        currentKanji = item;
        
        document.getElementById('info-on').textContent = item.on;
        document.getElementById('info-kun').textContent = item.kun;
        document.getElementById('info-mean').textContent = item.meaning;
        document.getElementById('guide-char').textContent = item.kanji;
        
        // 色をリセット
        document.getElementById('canvas-wrapper').style.borderColor = listTitle.style.color || '#42a5f5';

        clearCanvas();
        modal.classList.add('active');
    };

    window.closeModal = () => {
        modal.classList.remove('active');
        currentKanji = null;
    };

    // --- 音声再生 ---
    window.playAudio = () => {
        if (!currentKanji || !synth) return;
        if (synth.speaking) synth.cancel();

        let text = `${currentKanji.kanji}。`;
        if (currentKanji.on !== '-') text += `おん、${currentKanji.on}。`;
        if (currentKanji.kun !== '-') text += `くん、${currentKanji.kun}`;
        
        const utterThis = new SpeechSynthesisUtterance(text);
        utterThis.lang = 'ja-JP';
        utterThis.rate = 0.9;
        
        const jpVoices = voices.filter(v => v.lang.includes('ja') || v.lang.includes('JP'));
        let targetVoice = jpVoices.find(v => v.name.includes('Google') || v.name.includes('Kyoko'));
        if (targetVoice) utterThis.voice = targetVoice;
        
        synth.speak(utterThis);
    };

    // --- キャンバスロジック ---
    function setupCanvas() {
        canvas.addEventListener('mousedown', startDraw);
        canvas.addEventListener('mousemove', draw);
        canvas.addEventListener('mouseup', stopDraw);
        canvas.addEventListener('mouseout', stopDraw);
        canvas.addEventListener('touchstart', (e) => { e.preventDefault(); startDraw(e.touches[0]); }, { passive: false });
        canvas.addEventListener('touchmove', (e) => { e.preventDefault(); draw(e.touches[0]); }, { passive: false });
        canvas.addEventListener('touchend', stopDraw);
    }

    function startDraw(e) {
        isDrawing = true;
        const rect = canvas.getBoundingClientRect();
        ctx.lineWidth = 12;
        ctx.lineCap = 'round';
        ctx.lineJoin = 'round';
        ctx.strokeStyle = '#333';
        ctx.globalAlpha = 0.9;
        ctx.beginPath();
        const x = (e.clientX - rect.left) * (canvas.width / rect.width);
        const y = (e.clientY - rect.top) * (canvas.height / rect.height);
        ctx.moveTo(x, y);
    }

    function draw(e) {
        if (!isDrawing) return;
        const rect = canvas.getBoundingClientRect();
        const x = (e.clientX - rect.left) * (canvas.width / rect.width);
        const y = (e.clientY - rect.top) * (canvas.height / rect.height);
        ctx.lineTo(x, y);
        ctx.stroke();
    }

    function stopDraw() {
        isDrawing = false;
        ctx.closePath();
    }

    window.clearCanvas = () => {
        ctx.clearRect(0, 0, canvas.width, canvas.height);
    };

    window.finishPractice = () => {
        if (window.addPoints) window.addPoints(1);
        
        const btn = document.querySelector('.btn-done');
        const originalText = btn.innerHTML;
        btn.innerHTML = '<i class="fa-solid fa-star"></i> すごい！';
        btn.style.background = '#ff9800';
        
        setTimeout(() => {
            closeModal();
            setTimeout(() => {
                btn.innerHTML = originalText;
                btn.style.background = '#4caf50';
            }, 500);
        }, 800);
    };

</script>
</body>
</html>