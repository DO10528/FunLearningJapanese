<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>æ–‡æ³•ä¸¦ã³æ›¿ãˆã‚²ãƒ¼ãƒ </title>
    
    <link rel="stylesheet" href="css/style.css"> 
    
    <style>
        /* ======================================== */
        /* æ–‡æ³•ä¸¦ã³æ›¿ãˆã‚²ãƒ¼ãƒ å°‚ç”¨ã‚¹ã‚¿ã‚¤ãƒ« (sp- ã§ç«¶åˆã‚’å›é¿) */
        /* ======================================== */

        /* ã‚²ãƒ¼ãƒ ç”»é¢ã®ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒ†ãƒŠèª¿æ•´ */
        #sp-game-main-container {
            max-width: 850px; 
        }

        /* ä¸¦ã³æ›¿ãˆã‚²ãƒ¼ãƒ ã®ãƒ¡ã‚¤ãƒ³ã‚¨ãƒªã‚¢ */
        #sp-puzzle-area {
            display: flex;
            flex-direction: column; 
            gap: 25px;
            margin-top: 25px;
        }

        /* å„ã‚¨ãƒªã‚¢ã®ã‚¿ã‚¤ãƒˆãƒ« */
        .sp-area-title {
            font-size: 1.1em;
            font-weight: bold;
            color: #3f51b5;
            margin-bottom: 10px;
            text-align: left;
        }

        /* --- 1. ãƒ‰ãƒ­ãƒƒãƒ—ã‚¾ãƒ¼ãƒ³ï¼ˆè§£ç­”ã‚¨ãƒªã‚¢ï¼‰ --- */
        #sp-drop-zone-container {
            background-color: #eef2f8; /* è–„ã„é’ */
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }

        /* é«˜ã•å›ºå®š */
        #sp-drop-zone {
            min-height: 120px; 
            border: 3px dashed #ff6f61; /* ç‚¹ç·š */
            background-color: white;
            border-radius: 10px;
            display: flex;
            flex-wrap: wrap;
            align-items: center;
            justify-content: flex-start;
            gap: 10px;
            padding: 15px;
        }

        /* --- 2. ã‚«ãƒ¼ãƒ‰é¸æŠã‚¨ãƒªã‚¢ (ã‚¯ãƒªãƒƒã‚¯å…ƒ) --- */
        #sp-card-selection-area {
            background-color: #fffde7; /* è–„ã„é»„è‰² */
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
            border: 1px solid #ffcc5c;
        }

        #sp-card-container {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 10px;
            min-height: 50px;
            padding-top: 10px;
        }

        /* ======================================== */
        /* â˜… 3. å˜èªã‚«ãƒ¼ãƒ‰ã®ãƒ‡ã‚¶ã‚¤ãƒ³ ( .puzzle-card ) â˜… */
        /* ======================================== */

        .puzzle-card {
            background-color: #ffcc5c; 
            color: #333;
            padding: 12px 18px; 
            border-radius: 8px;
            font-size: 1.3em; 
            font-weight: bold;
            cursor: pointer; /* æŠ¼ã›ã‚‹ã‚ˆã†ã« */
            user-select: none;
            
            /* ç«‹ä½“çš„ãªãƒœã‚¿ãƒ³ãƒ‡ã‚¶ã‚¤ãƒ³ */
            box-shadow: 0 4px 0 #f0a000; 
            border: 1px solid #f0a000;
            transition: transform 0.1s, opacity 0.1s, background-color 0.3s, box-shadow 0.1s;
        }

        /* ã‚«ãƒ¼ãƒ‰ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ãŸã¨ãã®ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ */
        .puzzle-card:active {
            transform: translateY(4px);
            box-shadow: 0 0 0 #f0a000;
        }

        /* ãƒ‰ãƒ­ãƒƒãƒ—ã‚¨ãƒªã‚¢ã®ã‚«ãƒ¼ãƒ‰ (è‰²ã‚’å¤‰ãˆã‚‹) */
        #sp-drop-zone .puzzle-card {
            background-color: #fff8e1; 
            border-color: #ff6f61;
        }

        /* æ­£è§£æ™‚ã®ã‚«ãƒ¼ãƒ‰ (JSã® .correct-slot ã«å¯¾å¿œ) */
        .puzzle-card.correct-slot {
            background-color: #4CAF50; /* ç·‘ */
            color: white;
            border-color: #28a745;
            box-shadow: 0 4px 0 #28a745; 
        }

        /* ä¸æ­£è§£æ™‚ã®ã‚«ãƒ¼ãƒ‰ (JSã® .wrong-slot ã«å¯¾å¿œ) */
        .puzzle-card.wrong-slot {
            background-color: #ff6f61; /* èµ¤ */
            color: white;
            border-color: #dc3545;
            box-shadow: 0 4px 0 #dc3545;
        }

        /* ======================================== */
        /* 4. ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãƒœã‚¿ãƒ³ã®å…±é€šåŒ– */
        /* ======================================== */

        .sp-game-controls-area {
            margin-top: 30px;
            display: flex;
            justify-content: center;
            gap: 20px;
        }

        .sp-action-button {
            min-width: 150px; 
            padding: 12px 25px;
            font-size: 1.2em;
            font-weight: bold;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            box-shadow: 0 4px 0 rgba(0, 0, 0, 0.2);
            transition: all 0.2s;
            text-decoration: none;
            display: inline-flex;
            justify-content: center;
            align-items: center;
        }

        .sp-action-button:active {
            transform: translateY(4px);
            box-shadow: 0 0 0;
        }

        .sp-action-button.sp-primary {
            background-color: #3f51b5; /* ç­”ãˆåˆã‚ã›ãƒœã‚¿ãƒ³ */
            color: white;
            box-shadow: 0 4px 0 #1a237e;
        }

        .sp-action-button.sp-secondary {
            background-color: #ff6f61; /* ãƒªã‚»ãƒƒãƒˆãƒœã‚¿ãƒ³ */
            color: white;
            box-shadow: 0 4px 0 #dc3545;
        }

        .sp-action-button.sp-tertiary { /* ãƒ›ãƒ¼ãƒ ã«æˆ»ã‚‹ãƒœã‚¿ãƒ³ */
            background-color: #3f51b5;
            color: white;
            box-shadow: 0 4px 0 #1a237e;
        }

        /* --- ãƒ†ã‚­ã‚¹ãƒˆ / ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ --- */
        .sp-quiz-hint-text {
            /* style.cssã‹ã‚‰ç¶™æ‰¿ */
        }

        .sp-quiz-feedback-message {
            font-weight: bold;
            margin: 15px 0;
            text-align: center;
            font-size: 1.1em;
        }
        .sp-quiz-feedback-message.hidden {
            display: none;
        }
        .sp-quiz-feedback-message.feedback-correct {
            color: #155724; /* ç·‘ */
        }
        .sp-quiz-feedback-message.feedback-incorrect {
            color: #721c24; /* èµ¤ */
        }

    </style>
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-0BX3DD42C1"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
    
      gtag('config', 'G-0BX3DD42C1');
    </script>
    </head>
<body>
    
    <h1>æ–‡æ³•ä¸¦ã³æ›¿ãˆãƒ‘ã‚ºãƒ«</h1>
    
    <div id="sp-game-main-container" class="container">
        
        <div id="sp-status-area">
            <p id="sp-score-display">æ­£è§£æ•°: 0 / 0 å•</p>
            <h3 id="sp-question-text" class="sp-quiz-hint-text">æ–‡ã‚’æ­£ã—ãä¸¦ã³æ›¿ãˆã¦å®Œæˆã•ã›ã‚ˆã†ï¼</h3>
        </div>

        <div id="sp-puzzle-area">
            
            <div id="sp-drop-zone-container">
                <p class="sp-area-title">ã€ç­”ãˆã‚’ä½œã‚‹å ´æ‰€ã€‘</p>
                <div id="sp-drop-zone">
                    </div>
            </div>

            <div id="sp-english-translation-container">
                <p class="sp-area-title">ã€ç­”ãˆã®è‹±æ–‡ã€‘</p>
                <p id="sp-english-translation" style="font-size: 1.3em; color: #4CAF50; font-weight: bold; padding: 10px; border: 2px dashed #4CAF50; border-radius: 8px;">
                    Loading...
                </p>
            </div>
            <div id="sp-card-selection-area">
                <p class="sp-area-title">ã€ä½¿ã†ã‚«ãƒ¼ãƒ‰ã€‘</p>
                <div id="sp-card-container">
                    </div>
            </div>
            
            <p id="sp-feedback-message" class="sp-quiz-feedback-message hidden">ç­”ãˆã‚’é¸ã‚“ã§ã­ï¼</p>

            <div id="sp-action-buttons" class="sp-game-controls-area">
                <button id="sp-reset-button" class="sp-action-button sp-secondary">ãƒªã‚»ãƒƒãƒˆ</button>
                <button id="sp-check-button" class="sp-action-button sp-primary">ç­”ãˆåˆã‚ã›</button>
            </div>
            </div>

        <div style="margin-top: 30px;">
             <a href="index.html" class="sp-action-button sp-tertiary">ãƒ›ãƒ¼ãƒ ã«æˆ»ã‚‹</a>
        </div>
    </div>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            
            // ----------------------------------------------------
            // â˜…â˜…â˜… ãƒã‚¤ãƒ³ãƒˆã‚·ã‚¹ãƒ†ãƒ è¨­å®š (ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆIDã”ã¨ã«1æ—¥1å›) â˜…â˜…â˜…
            // ----------------------------------------------------
            const GAME_ID_SENTENCE = 'sentence_order_puzzle'; // ã‚²ãƒ¼ãƒ ID
            
            const USER_STORAGE_KEY_SENTENCE = 'user_accounts'; 
            const SESSION_STORAGE_KEY_SENTENCE = 'current_user'; 
            const GUEST_NAME_SENTENCE = 'ã‚²ã‚¹ãƒˆ'; 

            function getTodayDateString() {
                const now = new Date();
                const year = now.getFullYear();
                const month = String(now.getMonth() + 1).padStart(2, '0');
                const day = String(now.getDate()).padStart(2, '0');
                return `${year}-${month}-${day}`;
            }

            // ãƒã‚¤ãƒ³ãƒˆåŠ ç®—ãƒ»ãƒã‚§ãƒƒã‚¯é–¢æ•° (ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆIDã‚’ã‚­ãƒ¼ã«ã™ã‚‹)
            function checkAndAwardPoints(templateId) {
                const currentUser = sessionStorage.getItem(SESSION_STORAGE_KEY_SENTENCE);
                if (!currentUser || currentUser === GUEST_NAME_SENTENCE) return "guest"; 

                const usersJson = localStorage.getItem(USER_STORAGE_KEY_SENTENCE);
                let users = usersJson ? JSON.parse(usersJson) : {};
                let user = users[currentUser];
                if (!user) return "error"; 

                const today = getTodayDateString();
                // ã‚­ãƒ¼ã‚’ã€Œã‚²ãƒ¼ãƒ ID + ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆIDã€ã«ã™ã‚‹
                // (IDãŒãªã„å ´åˆã¯å•é¡Œæ–‡ã®ä¸€éƒ¨ã‚’ã‚­ãƒ¼ã«ã™ã‚‹æƒ³å®š)
                const progressKey = `${GAME_ID_SENTENCE}_template_${templateId}`;

                user.progress = user.progress || {};
                user.progress[progressKey] = user.progress[progressKey] || {};

                if (user.progress[progressKey][today] === true) return "already_scored"; 

                // ãƒã‚¤ãƒ³ãƒˆåŠ ç®—
                user.points = (user.points || 0) + 1;
                user.progress[progressKey][today] = true;
                
                users[currentUser] = user;
                localStorage.setItem(USER_STORAGE_KEY_SENTENCE, JSON.stringify(users));
                console.log(`[Game] ${currentUser} gained 1 point for template "${templateId}". Total: ${user.points}`);
                return "scored"; 
            }
            // ----------------------------------------------------
            // â˜…â˜…â˜… ãƒã‚¤ãƒ³ãƒˆã‚·ã‚¹ãƒ†ãƒ è¨­å®š (ã“ã“ã¾ã§) â˜…â˜…â˜…
            // ----------------------------------------------------


            // ----------------------------------------------------
            // DOMè¦ç´ ã¨å®šæ•°ã®å®šç¾©
            // ----------------------------------------------------
            const DATA_PATH = 'data/sentence_data.json';

            const dropZone = document.getElementById('sp-drop-zone');
            const cardContainer = document.getElementById('sp-card-container');
            const checkButton = document.getElementById('sp-check-button');
            const resetButton = document.getElementById('sp-reset-button');
            const feedbackMessage = document.getElementById('sp-feedback-message');
            const questionText = document.getElementById('sp-question-text');
            const scoreDisplay = document.getElementById('sp-score-display');
            const englishTranslation = document.getElementById('sp-english-translation');

            const SOUND_CORRECT_PATH = 'assets/sounds/seikai.mp3'; 
            const SOUND_INCORRECT_PATH = 'assets/sounds/bubu.mp3'; 
            
            let allTemplates = [];         
            let wordPool = {};             
            let currentCorrectParts = [];
            let currentTemplate = null; // â˜…è¿½åŠ : ç¾åœ¨ã®ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’ä¿æŒ
            let score = 0;
            let totalQuestions = 0;
            let currentQuestionIndex = 0;

            // ----------------------------------------------------
            // åˆæœŸåŒ–ã¨ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿
            // ----------------------------------------------------

            async function initializeGame() {
                try {
                    const response = await fetch(DATA_PATH);
                    const data = await response.json();
                    
                    allTemplates = shuffleArray(data.templates); 
                    wordPool = data.word_pool;
                    totalQuestions = allTemplates.length;

                    if (totalQuestions === 0) {
                        questionText.textContent = "ã‚¨ãƒ©ãƒ¼: å•é¡Œãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆãŒã‚ã‚Šã¾ã›ã‚“ã€‚";
                        return;
                    }

                    checkButton.addEventListener('click', checkAnswer);
                    resetButton.addEventListener('click', resetPuzzle);
                    
                    startNewQuestion();
                } catch (error) {
                    console.error("ãƒ‡ãƒ¼ã‚¿ã®èª­ã¿è¾¼ã¿ã¾ãŸã¯ã‚²ãƒ¼ãƒ åˆæœŸåŒ–ã«å¤±æ•—ã—ã¾ã—ãŸ:", error);
                    questionText.textContent = "ã‚¨ãƒ©ãƒ¼: ã‚²ãƒ¼ãƒ ã‚’é–‹å§‹ã§ãã¾ã›ã‚“ã§ã—ãŸã€‚ãƒ•ã‚¡ã‚¤ãƒ«ãƒ‘ã‚¹ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚";
                }
            }

            /**
             * æ–°ã—ã„å•é¡Œã‚’å‡ºé¡Œã™ã‚‹
             */
            function startNewQuestion() {
                if (currentQuestionIndex >= totalQuestions) {
                    endGame();
                    return;
                }

                currentTemplate = allTemplates[currentQuestionIndex]; // ç¾åœ¨ã®ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆä¿æŒ
                const { japaneseParts, englishText } = generateRandomSentence(currentTemplate);
                currentCorrectParts = japaneseParts; 

                // 1. UIã‚’ãƒªã‚»ãƒƒãƒˆ
                dropZone.innerHTML = '';
                cardContainer.innerHTML = '';
                feedbackMessage.classList.add('hidden');
                feedbackMessage.className = 'sp-quiz-feedback-message hidden'; 
                checkButton.disabled = false;
                resetButton.disabled = false;
                
                // 2. å•é¡Œæƒ…å ±ã‚’è¡¨ç¤º
                questionText.textContent = `ãƒ’ãƒ³ãƒˆ: ${currentTemplate.hint}`;
                englishTranslation.textContent = englishText; 
                updateScoreDisplay();

                // 3. ã‚«ãƒ¼ãƒ‰ã‚’ç”Ÿæˆã—ã€ã‚·ãƒ£ãƒƒãƒ•ãƒ«ã—ã¦é…ç½®
                const shuffledParts = shuffleArray([...japaneseParts]);
                
                shuffledParts.forEach((part, index) => {
                    const card = document.createElement('div');
                    card.textContent = part; 
                    card.classList.add('puzzle-card'); 
                    
                    card.dataset.id = `${part}-${index}-${currentQuestionIndex}`; 
                    cardContainer.appendChild(card);
                });
                
                // 4. ã‚¯ãƒªãƒƒã‚¯ã‚¤ãƒ™ãƒ³ãƒˆã‚’è¨­å®š
                setupCardEvents();
            }

            /**
             * æ–‡å‹ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã¨å˜èªãƒ—ãƒ¼ãƒ«ã‹ã‚‰ãƒ©ãƒ³ãƒ€ãƒ ãªæ–‡ã¨è‹±æ–‡ã‚’ç”Ÿæˆã™ã‚‹
             */
            function generateRandomSentence(template) {
                const japaneseParts = [];
                let englishText = template.english; 
                const replacements = [];

                template.pattern.forEach(partKey => {
                    if (partKey.startsWith('P_') || partKey.startsWith('N_') || partKey.startsWith('A_') || partKey.startsWith('V_')) {
                        const pool = wordPool[partKey];
                        
                        if (pool && pool.length > 0) {
                            const randomItem = pool[Math.floor(Math.random() * pool.length)];
                            japaneseParts.push(randomItem.japanese);
                            replacements.push({ 
                                placeholder: `(${partKey})`, 
                                replacement: randomItem.english 
                            });
                        } else {
                            japaneseParts.push("[ã‚¨ãƒ©ãƒ¼]"); 
                        }
                    } else {
                        japaneseParts.push(partKey);
                    }
                });
                
                replacements.forEach(item => {
                    englishText = englishText.replace(item.placeholder, item.replacement);
                });
                
                englishText = englishText.replace(/\(N_[^\)]+\)|\(A_[^\)]+\)|\(V_[^\)]+\)|\(P_[^\)]+\)/g, '');
                
                if (!englishText.match(/[.!?]$/)) {
                    englishText += '.';
                }

                return { japaneseParts, englishText: englishText.trim() };
            }

            // ----------------------------------------------------
            // ã‚¤ãƒ™ãƒ³ãƒˆè¨­å®šã¨ã‚¯ãƒªãƒƒã‚¯å‡¦ç†
            // ----------------------------------------------------
            
            function setupCardEvents() {
                document.querySelectorAll('.puzzle-card').forEach(card => {
                    card.addEventListener('click', handleCardClick); 
                });
            }

            function handleCardClick(e) {
                const clickedCard = e.target.closest('.puzzle-card');
                if (!clickedCard) return;

                if (clickedCard.classList.contains('correct-slot')) {
                    return;
                }

                if (clickedCard.parentNode === dropZone) {
                    cardContainer.appendChild(clickedCard);
                    clickedCard.classList.remove('wrong-slot');
                } 
                else {
                    dropZone.appendChild(clickedCard);
                }
                
                feedbackMessage.classList.add('hidden');
            }

            // ----------------------------------------------------
            // æ­£èª¤åˆ¤å®šã¨ã‚²ãƒ¼ãƒ åˆ¶å¾¡
            // ----------------------------------------------------

            function checkAnswer() {
                checkButton.disabled = true;
                resetButton.disabled = true;
                
                const droppedCards = [...dropZone.querySelectorAll('.puzzle-card')];
                
                if (droppedCards.length !== currentCorrectParts.length) {
                    displayFeedback(false, `âŒ ã‚«ãƒ¼ãƒ‰ã®æ•°ãŒé•ã„ã¾ã™ã€‚ï¼ˆ${currentCorrectParts.length}æšå¿…è¦ã§ã™ï¼‰`);
                    checkButton.disabled = false;
                    resetButton.disabled = false;
                    return;
                }

                let isCorrect = true;
                
                droppedCards.forEach((card, index) => {
                    const correctWord = currentCorrectParts[index];
                    
                    if (card.textContent === correctWord) {
                        card.classList.add('correct-slot');
                        card.classList.remove('wrong-slot');
                    } else {
                        card.classList.add('wrong-slot');
                        card.classList.remove('correct-slot');
                        isCorrect = false;
                    }
                });

                if (isCorrect) {
                    playSound(SOUND_CORRECT_PATH); 
                    
                    // â˜…â˜…â˜… ãƒã‚¤ãƒ³ãƒˆä»˜ä¸ (ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆIDã€ãªã‘ã‚Œã°è‹±æ–‡ã‚’ã‚­ãƒ¼ã«ã™ã‚‹) â˜…â˜…â˜…
                    // IDãŒãªã„å ´åˆã®ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ã¨ã—ã¦è‹±æ–‡ã‚’ä½¿ç”¨
                    const pointKey = currentTemplate.id || currentTemplate.english;
                    const result = checkAndAwardPoints(pointKey);
                    
                    let msg = `ğŸ‰ ç´ æ™´ã‚‰ã—ã„ï¼æ­£è§£ã§ã™ã€‚`;
                    if (result === "scored") {
                        msg += ' (+1 ãƒã‚¤ãƒ³ãƒˆï¼)';
                    }
                    // â˜…â˜…â˜…â˜…â˜…â˜…â˜…â˜…â˜…â˜…â˜…â˜…â˜…â˜…â˜…â˜…â˜…â˜…â˜…â˜…â˜…â˜…â˜…

                    score++;
                    currentQuestionIndex++;
                    displayFeedback(true, msg);
                    
                    setTimeout(startNewQuestion, 2000);
                    
                } else {
                    playSound(SOUND_INCORRECT_PATH); 
                    displayFeedback(false, `ğŸ¤” æ®‹å¿µã€ä¸¦ã³é †ãŒé•ã„ã¾ã™ã€‚ã‚«ãƒ¼ãƒ‰ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦æˆ»ã™ã‹ã€ãƒªã‚»ãƒƒãƒˆã—ã¦å†æŒ‘æˆ¦ï¼`);
                    checkButton.disabled = false;
                    resetButton.disabled = false;
                }
            }

            function resetPuzzle() {
                const cardsToMove = [...dropZone.querySelectorAll('.puzzle-card')];
                
                cardsToMove.forEach(card => {
                    cardContainer.appendChild(card);
                    card.classList.remove('correct-slot', 'wrong-slot');
                });
                
                dropZone.innerHTML = '';
                displayFeedback(false, `ãƒ‘ã‚ºãƒ«ã‚’ãƒªã‚»ãƒƒãƒˆã—ã¾ã—ãŸã€‚`);
                feedbackMessage.className = 'sp-quiz-feedback-message hidden';
                checkButton.disabled = false;
                resetButton.disabled = false;
            }

            function displayFeedback(isCorrect, message) {
                feedbackMessage.textContent = message;
                feedbackMessage.classList.remove('hidden'); 
                feedbackMessage.classList.remove('feedback-correct', 'feedback-incorrect');
                
                if (isCorrect) {
                    feedbackMessage.classList.add('feedback-correct');
                } else {
                    feedbackMessage.classList.add('feedback-incorrect');
                }
            }

            function updateScoreDisplay() {
                scoreDisplay.textContent = `æ­£è§£æ•°: ${score} / ${totalQuestions} å•`;
            }

            function endGame() {
                playSound(SOUND_CORRECT_PATH); 
                questionText.textContent = `ğŸ‰ ã‚²ãƒ¼ãƒ ã‚¯ãƒªã‚¢ï¼`;
                englishTranslation.textContent = `ãŠã‚ã§ã¨ã†ã”ã–ã„ã¾ã™ï¼`;
                dropZone.innerHTML = '';
                cardContainer.innerHTML = '';
                checkButton.disabled = true;
                resetButton.disabled = true;
                displayFeedback(true, `å…¨å•çµ‚äº†ï¼æœ€çµ‚ã‚¹ã‚³ã‚¢ã¯ ${score} ç‚¹ã§ã™ã€‚`);
            }

            // ----------------------------------------------------
            // ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£
            // ----------------------------------------------------
            
            function playSound(path) {
                const audio = new Audio(path);
                audio.play().catch(e => console.error("éŸ³å£°å†ç”Ÿã‚¨ãƒ©ãƒ¼:", e));
            }

            function shuffleArray(array) {
                let newArray = [...array];
                for (let i = newArray.length - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    [newArray[i], newArray[j]] = [newArray[j], newArray[i]];
                }
                return newArray;
            }

            // ã‚²ãƒ¼ãƒ é–‹å§‹
            initializeGame();
        });
    </script>
    </body>
</html>