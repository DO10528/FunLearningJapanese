<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>ます形タイピング - FunLearnJP</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<link href="https://fonts.googleapis.com/css2?family=Zen+Maru+Gothic:wght@500;700;900&family=Klee+One:wght@600&display=swap" rel="stylesheet">

<style>
    /* --- 共通デザイン --- */
    :root {
        --primary: #00bcd4;
        --bg-color: #f0f8ff;
        --text-color: #333;
        --grp1-color: #f48fb1;
        --grp2-color: #80deea;
        --grp3-color: #9575cd;
    }

    body {
        font-family: 'Zen Maru Gothic', sans-serif;
        background-color: var(--bg-color);
        color: var(--text-color);
        margin: 0; padding: 0; min-height: 100vh;
        display: flex; flex-direction: column; align-items: center;
    }

    header {
        width: 100%; background: #FFF; border-bottom: 3px solid var(--primary);
        padding: 10px 20px; display: flex; justify-content: space-between; align-items: center;
    }
    .logo { font-size: 1.2em; font-weight: 900; color: var(--primary); text-decoration: none; }
    .home-icon { color: var(--primary); font-size: 1.5em; }

    .container { width: 100%; max-width: 600px; padding: 20px; text-align: center; flex-grow: 1; }

    /* メニュー画面 */
    #menu-screen { animation: fadeIn 0.5s; }
    .title { font-size: 1.8em; color: var(--primary); margin-bottom: 10px; }
    .desc { color: #666; margin-bottom: 30px; }

    .group-btn {
        display: block; width: 100%; max-width: 300px; margin: 15px auto;
        padding: 20px; border-radius: 20px; border: none;
        color: white; font-size: 1.3em; font-weight: 900; cursor: pointer;
        box-shadow: 0 5px 0 rgba(0,0,0,0.1); transition: transform 0.1s;
    }
    .group-btn:active { transform: translateY(4px); box-shadow: none; }
    
    .btn-g1 { background: var(--grp1-color); }
    .btn-g2 { background: var(--grp2-color); }
    .btn-g3 { background: var(--grp3-color); }

    /* ゲーム画面 */
    #game-screen { display: none; width: 100%; }
    
    .question-card {
        background: white; border-radius: 20px; padding: 40px 20px;
        box-shadow: 0 8px 20px rgba(0,0,0,0.1); margin-bottom: 30px;
        border: 4px solid var(--primary);
    }
    .q-word { font-size: 2.5em; font-weight: bold; color: #555; margin-bottom: 10px; }
    .q-sub { font-size: 1em; color: #999; }

    /* 入力エリア */
    .input-area { position: relative; width: 100%; max-width: 300px; margin: 0 auto; }
    input[type="text"] {
        width: 100%; padding: 15px; font-size: 1.5em; text-align: center;
        border: 3px solid #ccc; border-radius: 15px; outline: none;
        font-family: 'Klee One', cursive;
    }
    input[type="text"]:focus { border-color: var(--primary); background: #e0f7fa; }

    .feedback-msg {
        height: 30px; margin-top: 10px; font-weight: bold; font-size: 1.2em;
    }

    /* プログレスバー */
    .progress-container {
        width: 100%; height: 10px; background: #ddd; border-radius: 5px; margin-bottom: 20px; overflow: hidden;
    }
    .progress-bar { height: 100%; background: var(--primary); width: 0%; transition: width 0.3s; }

    /* アニメーション */
    @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    .shake { animation: shake 0.4s; border-color: #ff5252 !important; background: #ffebee !important; }
    @keyframes shake { 0%, 100% { transform: translateX(0); } 25% { transform: translateX(-10px); } 75% { transform: translateX(10px); } }

    /* ボタン */
    .submit-btn {
        margin-top: 20px; background: var(--primary); color: white; border: none;
        padding: 12px 40px; border-radius: 50px; font-size: 1.2em; font-weight: bold;
        cursor: pointer; box-shadow: 0 4px 0 #0097a7;
    }
    .submit-btn:active { transform: translateY(3px); box-shadow: none; }
    
    /* 認証ステータス */
    #auth-status {
        text-align: center; font-size: 0.9em; margin-bottom: 15px; font-weight: bold; color: var(--primary);
    }

</style>
</head>
<body>

<header>
    <a href="index.html" class="logo"><i class="fa-solid fa-keyboard"></i> FunLearnJP</a>
    <a href="index.html" class="home-icon"><i class="fa-solid fa-house"></i></a>
</header>

<div class="container">

    <div id="auth-status">認証中...</div>

    <div id="menu-screen">
        <h1 class="title">ます形 タイピング</h1>
        <p class="desc">グループをえらんでね！<br>えいご をみて にほんご をいれよう。</p>
        
        <button class="group-btn btn-g1" onclick="startGame('grp1')">Group I (i-masu)</button>
        <button class="group-btn btn-g2" onclick="startGame('grp2')">Group II (e-masu)</button>
        <button class="group-btn btn-g3" onclick="startGame('grp3')">Group III (Irr)</button>
        
        <a href="verb_list.html" style="display:block; margin-top:30px; color:#999; text-decoration:none;">リストにもどる</a>
    </div>

    <div id="game-screen">
        <div class="progress-container"><div id="progress-bar" class="progress-bar"></div></div>
        
        <div class="question-card" id="q-card">
            <div id="q-text" class="q-word">Eat</div>
            <div class="q-sub">にほんご で かいてね</div>
        </div>

        <div class="input-area">
            <input type="text" id="answer-input" placeholder="ここに入力" autocomplete="off">
            <div id="feedback" class="feedback-msg"></div>
        </div>

        <button class="submit-btn" onclick="checkAnswer()">決定 (Enter)</button>
        
        <button onclick="location.reload()" style="margin-top:20px; background:none; border:none; color:#999; cursor:pointer;">やめる</button>
    </div>

</div>

<audio id="snd-correct" src="assets/sounds/seikai.mp3"></audio>
<audio id="snd-incorrect" src="assets/sounds/bubu.mp3"></audio>

<script type="module" src="js/firebase-config.js"></script>

<script>
    // データセット（英語 -> ます形）
    const verbData = {
        grp1: [
            { en: "Write", jp: "かきます" }, { en: "Listen", jp: "ききます" },
            { en: "Go", jp: "いきます" }, { en: "Swim", jp: "およぎます" },
            { en: "Drink", jp: "のみます" }, { en: "Read", jp: "よみます" },
            { en: "Rest", jp: "やすみます" }, { en: "Play", jp: "あそびます" },
            { en: "Buy", jp: "かいます" }, { en: "Meet", jp: "あいます" },
            { en: "Wait", jp: "まちます" }, { en: "Return", jp: "かえります" }
        ],
        grp2: [
            { en: "Eat", jp: "たべます" }, { en: "Sleep", jp: "ねます" },
            { en: "Give", jp: "あげます" }, { en: "Open", jp: "あけます" },
            { en: "Watch/See", jp: "みます" }, { en: "Wake up", jp: "おきます" },
            { en: "Can do", jp: "できます" }, { en: "Borrow", jp: "かります" }
        ],
        grp3: [
            { en: "Study", jp: "べんきょうします" }, { en: "Shop", jp: "かいものします" },
            { en: "Walk", jp: "さんぽします" }, { en: "Copy", jp: "コピーします" },
            { en: "Come", jp: "きます" }, { en: "Bring", jp: "もってきます" }
        ]
    };

    let currentQueue = [];
    let currentQ = null;
    let totalQ = 0;
    // Firebase関数ダミー
    if (typeof window.addPointsToUser !== 'function') {
        window.addPointsToUser = async () => false;
    }
    const POINTS_PER_QUESTION = 1;
    
    const menuScreen = document.getElementById('menu-screen');
    const gameScreen = document.getElementById('game-screen');
    const qText = document.getElementById('q-text');
    const input = document.getElementById('answer-input');
    const feedback = document.getElementById('feedback');
    const progressBar = document.getElementById('progress-bar');
    const qCard = document.getElementById('q-card');

    const sndCorrect = document.getElementById('snd-correct');
    const sndIncorrect = document.getElementById('snd-incorrect');

    function startGame(group) {
        // テーマカラーの変更
        let color = '#00bcd4';
        if(group === 'grp1') color = '#f48fb1';
        if(group === 'grp2') color = '#80deea';
        if(group === 'grp3') color = '#9575cd';
        qCard.style.borderColor = color;

        currentQueue = [...verbData[group]];
        // シャッフル
        currentQueue.sort(() => Math.random() - 0.5);
        totalQ = currentQueue.length;
        
        menuScreen.style.display = 'none';
        gameScreen.style.display = 'block';
        
        nextQuestion();
    }

    function nextQuestion() {
        if (currentQueue.length === 0) {
            alert("クリア！おめでとう！");
            location.reload();
            return;
        }

        currentQ = currentQueue.pop();
        qText.textContent = currentQ.en;
        input.value = "";
        input.focus();
        feedback.textContent = "";
        
        // 進捗バー
        const percent = ((totalQ - currentQueue.length - 1) / totalQ) * 100;
        progressBar.style.width = percent + '%';
    }

    // ★ async に変更
    async function checkAnswer() {
        const userVal = input.value.trim();
        
        if (userVal === currentQ.jp) {
            // 正解
            sndCorrect.currentTime = 0;
            sndCorrect.play();
            feedback.style.color = "green";
            feedback.textContent = "せいかい！";

            // ★Firebaseポイント加算
            await window.addPointsToUser(POINTS_PER_QUESTION, currentQ.en); // 英語をID代わりに

            setTimeout(nextQuestion, 800);
        } else {
            // 不正解
            sndIncorrect.currentTime = 0;
            sndIncorrect.play();
            input.classList.add('shake');
            feedback.style.color = "red";
            feedback.textContent = `こたえ: ${currentQ.jp}`;
            setTimeout(() => input.classList.remove('shake'), 500);
        }
    }

    // Enterキー対応
    input.addEventListener('keypress', (e) => {
        if (e.key === 'Enter') checkAnswer();
    });

</script>
</body>
</html>