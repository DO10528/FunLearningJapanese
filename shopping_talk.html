<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>実戦！お買い物トーク (完全版) - FunLearnJP</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<link href="https://fonts.googleapis.com/css2?family=Zen+Maru+Gothic:wght@400;700;900&display=swap" rel="stylesheet">

<link rel="stylesheet" href="css/shopping_talk.css">

<link rel="stylesheet" href="css/common_ui.css">
</head>
<body>

<header>
    <a href="index.html" class="logo"><i class="fa-solid fa-shapes"></i> FunLearnJP</a>
    <a href="index.html" class="home-link"><i class="fa-solid fa-house"></i> ホーム</a>
</header>

<div class="container">
    <div id="auth-status">認証中...</div>

    <div id="menu-screen" class="screen active">
        <h2 style="text-align:center; color:#555; margin-bottom:20px;"><i class="fa-solid fa-store"></i> お店を選んでね (Select Shop)</h2>
        <div class="menu-grid">
            <div class="scenario-card" onclick="loadScenario('konbini')" style="border-bottom: 4px solid #ffcc5c;">
                <i class="fa-solid fa-store card-icon" style="color:#ffcc5c;"></i>
                <span class="card-title">コンビニ</span>
            </div>
            <div class="scenario-card" onclick="loadScenario('burger')" style="border-bottom: 4px solid #ef5350;">
                <i class="fa-solid fa-burger card-icon" style="color:#ef5350;"></i>
                <span class="card-title">ハンバーガー</span>
            </div>
            <div class="scenario-card" onclick="loadScenario('cafe')" style="border-bottom: 4px solid #8d6e63;">
                <i class="fa-solid fa-mug-hot card-icon" style="color:#8d6e63;"></i>
                <span class="card-title">カフェ</span>
            </div>
            <div class="scenario-card" onclick="loadScenario('ramen')" style="border-bottom: 4px solid #e67e22;">
                <i class="fa-solid fa-bowl-food card-icon" style="color:#e67e22;"></i>
                <span class="card-title">ラーメン屋</span>
            </div>
            <div class="scenario-card" onclick="loadScenario('yakiniku')" style="border-bottom: 4px solid #d32f2f;">
                <i class="fa-solid fa-fire card-icon" style="color:#d32f2f;"></i>
                <span class="card-title">焼肉屋</span>
            </div>
            <div class="scenario-card" onclick="loadScenario('izakaya')" style="border-bottom: 4px solid #3f51b5;">
                <i class="fa-solid fa-beer-mug-empty card-icon" style="color:#3f51b5;"></i>
                <span class="card-title">居酒屋</span>
            </div>
            <div class="scenario-card" onclick="loadScenario('pizza')" style="border-bottom: 4px solid #4caf50;">
                <i class="fa-solid fa-pizza-slice card-icon" style="color:#4caf50;"></i>
                <span class="card-title">ピザ屋</span>
            </div>
            <div class="scenario-card" onclick="loadScenario('restaurant')" style="border-bottom: 4px solid #607d8b;">
                <i class="fa-solid fa-utensils card-icon" style="color:#607d8b;"></i>
                <span class="card-title">ファミレス</span>
            </div>
            
            <div class="scenario-card" onclick="loadScenario('random')" style="border-bottom: 4px solid #9c27b0;">
                <i class="fa-solid fa-dice card-icon" style="color:#9c27b0;"></i>
                <span class="card-title">ランダム<br>(応用)</span>
            </div>
        </div>
    </div>

    <div id="practice-screen" class="screen">
        <div class="sim-header">
            <div class="top-controls">
                <button class="action-btn btn-secondary btn-small" onclick="showScreen('menu-screen')">
                    <i class="fa-solid fa-arrow-left"></i> もどる
                </button>
            </div>
            <h2 id="practice-title" style="margin:5px 0; color:var(--primary);"></h2>
            <p style="margin:0; font-size:0.9em; color:#777;">会話を練習しましょう！この中からクイズに出ます。</p>
        </div>
        <div id="practice-list" class="practice-list"></div>
    </div>

    <div id="sim-screen" class="screen">
        <div class="sim-header">
            <div style="display:flex; justify-content:space-between; align-items:center;">
                 <span style="font-weight:bold;">Step <span id="step-count">1</span> / <span id="total-step">3</span></span>
                 <button class="action-btn btn-secondary btn-small" onclick="goBackFromSim()">
                    <i class="fa-solid fa-arrow-left"></i> 戻る
                 </button>
            </div>
        </div>

        <div class="clerk-area">
            <div class="clerk-icon"><i class="fa-solid fa-user-tie"></i></div>
            <div class="speech-bubble">
                <div id="clerk-role-label" style="font-size:0.85em; color:#999; font-weight:bold; margin-bottom:5px;">店員 / Situation</div>
                <div id="clerk-text-jp" style="font-size:1.2em; font-weight:bold; margin-bottom:5px;"></div>
                <div id="clerk-text-en" style="font-size:0.9em; color:#888;"></div>
                <button onclick="replayClerkVoice()" style="background:none; border:none; color:var(--primary); cursor:pointer; margin-top:10px; font-weight:bold;">
                    <i class="fa-solid fa-volume-high"></i> もう一度聞く
                </button>
            </div>
        </div>

        <div class="user-area">
            <div class="target-phrase-box">
                <div class="target-label"><i class="fa-solid fa-bullhorn"></i> こう答えてみよう！(Try saying this)</div>
                <div id="target-phrase" class="target-text"></div>
                <div id="target-sub" class="target-sub"></div>
            </div>

            <div style="margin-bottom:15px; font-weight:bold; color:#555;">マイクを押して話してください</div>
            
            <button id="mic-btn" class="mic-btn" onclick="toggleRecording()">
                <i class="fa-solid fa-microphone"></i>
            </button>

            <div class="result-display">
                <div id="recognized-text" class="recognized-text">...</div>
                <div id="score-result"></div>
            </div>
            
            <button id="next-btn" class="action-btn" onclick="nextStep()" style="display:none; margin-top:10px;">次へ</button>
        </div>
    </div>

    <div id="result-screen" class="screen" style="text-align:center; padding-top:40px;">
        <i class="fa-solid fa-award" style="font-size:4em; color:var(--primary);"></i>
        <h2 style="color:var(--primary);">Test Clear!</h2>
        <p style="font-size:1.2em;">お買い物ができました！</p>
        <div id="final-msg" style="margin:20px; font-weight:bold;"></div>
        <button class="action-btn" onclick="location.reload()">メニューに戻る</button>
    </div>

</div>

<div id="fixed-footer-practice" class="fixed-footer">
    <button class="action-btn" onclick="startSimulation()">
        <i class="fa-solid fa-microphone"></i> スピーキングテスト！
    </button>
</div>

<script type="module" src="js/firebase-config.js"></script>

<script src="js/shopping_talk.js"></script>

<script src="js/common_ui.js"></script>
</body>
</html>