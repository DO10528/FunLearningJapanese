<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>æ—¥æœ¬ã®è¡Œäº‹ - Festival Calendar</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<link href="https://fonts.googleapis.com/css2?family=Zen+Maru+Gothic:wght@400;700;900&display=swap" rel="stylesheet">

<style>
    /* --- å…±é€šè¨­å®š --- */
    :root {
        --primary: #9c27b0; /* ç´«ï¼šé«˜è²´ãƒ»æ–‡åŒ–çš„ãªã‚¤ãƒ¡ãƒ¼ã‚¸ */
        --accent: #ffeb3b;
        --bg-color: #f3e5f5;
        --text-color: #333;
        
        /* å­£ç¯€ã®è‰² */
        --spring: #fce4ec; /* Pink */
        --summer: #e3f2fd; /* Blue */
        --autumn: #fbe9e7; /* Orange */
        --winter: #f5f5f5; /* Grey/White */
        --spring-txt: #e91e63;
        --summer-txt: #2196f3;
        --autumn-txt: #ff5722;
        --winter-txt: #607d8b;
    }

    *, *::before, *::after { box-sizing: border-box; }

    body {
        font-family: 'Zen Maru Gothic', sans-serif;
        background-color: var(--bg-color);
        color: var(--text-color);
        margin: 0; padding: 0; padding-bottom: 100px;
        min-height: 100vh;
        display: flex; flex-direction: column;
        transition: background-color 0.5s ease;
        -webkit-tap-highlight-color: transparent;
    }

    /* ãƒ˜ãƒƒãƒ€ãƒ¼ */
    header {
        background: linear-gradient(135deg, #ab47bc 0%, #7b1fa2 100%);
        color: white; padding: 15px 20px; width: 100%;
        display: flex; justify-content: space-between; align-items: center;
        box-shadow: 0 4px 15px rgba(156, 39, 176, 0.3);
        position: sticky; top: 0; z-index: 100;
    }
    .logo { font-size: 1.2em; font-weight: 900; display: flex; align-items: center; gap: 10px; text-decoration: none; color: white; }
    
    /* ç”»é¢ã‚³ãƒ³ãƒ†ãƒŠ */
    .screen { display: none; padding: 20px; width: 100%; max-width: 600px; margin: 0 auto; animation: fadeIn 0.4s ease-out; }
    .screen.active { display: block; }
    @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

    /* æˆ»ã‚‹ãƒœã‚¿ãƒ³ */
    .btn-back-nav {
        background: rgba(255,255,255,0.2); border: 1px solid rgba(255,255,255,0.5);
        color: white; padding: 5px 12px; border-radius: 20px; cursor: pointer; font-size: 0.9em; font-weight: bold;
    }

    /* --- 1. ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼å›³é‘‘ (List) --- */
    .calendar-grid {
        display: grid; grid-template-columns: repeat(auto-fill, minmax(140px, 1fr)); gap: 15px;
    }
    .event-card {
        background: white; border-radius: 15px; padding: 15px;
        text-align: center; position: relative; overflow: hidden;
        box-shadow: 0 4px 10px rgba(0,0,0,0.05); border: 2px solid transparent;
    }
    .event-emoji { font-size: 3em; margin-bottom: 5px; display: block; }
    .event-month {
        position: absolute; top: 0; left: 0;
        background: #333; color: white; padding: 3px 10px;
        font-size: 0.8em; border-bottom-right-radius: 10px; font-weight: bold;
    }
    .event-name { font-weight: 900; font-size: 1.1em; margin-bottom: 5px; color: #444; }
    .event-en { font-size: 0.8em; color: #888; margin-bottom: 5px; }
    .event-desc { font-size: 0.75em; color: #666; background: #f9f9f9; padding: 5px; border-radius: 8px; }

    /* å­£ç¯€ã”ã¨ã®ã‚«ãƒ¼ãƒ‰è‰² */
    .season-spring { border-color: var(--spring-txt); background: #fff0f5; }
    .season-summer { border-color: var(--summer-txt); background: #f0f8ff; }
    .season-autumn { border-color: var(--autumn-txt); background: #fffaf0; }
    .season-winter { border-color: var(--winter-txt); background: #fafafa; }

    /* --- 2. ãƒ¬ãƒ™ãƒ«é¸æŠ --- */
    .level-list { display: flex; flex-direction: column; gap: 15px; }
    .level-card {
        background: white; border-radius: 15px; padding: 20px;
        display: flex; align-items: center; gap: 15px;
        box-shadow: 0 4px 10px rgba(0,0,0,0.05); cursor: pointer;
        border-left: 8px solid #ccc; transition: transform 0.1s;
    }
    .level-card:active { transform: scale(0.98); }
    .lvl-icon { font-size: 2em; width: 50px; text-align: center; }
    .lvl-info h3 { margin: 0; font-size: 1.2em; }
    .lvl-info p { margin: 5px 0 0; font-size: 0.85em; color: #777; }

    /* --- 3. ã‚²ãƒ¼ãƒ ç”»é¢ --- */
    .quiz-display {
        background: white; border-radius: 20px; padding: 30px 20px;
        text-align: center; margin-bottom: 20px;
        box-shadow: 0 8px 20px rgba(0,0,0,0.1);
        position: relative; overflow: hidden;
    }
    .q-image { font-size: 5em; margin-bottom: 10px; animation: bounce 2s infinite; }
    @keyframes bounce { 0%, 20%, 50%, 80%, 100% {transform: translateY(0);} 40% {transform: translateY(-10px);} 60% {transform: translateY(-5px);} }
    
    .q-text { font-size: 1.5em; font-weight: 900; margin-bottom: 5px; }
    .q-sub { font-size: 1em; color: #666; }

    .choice-container { display: grid; gap: 15px; grid-template-columns: 1fr 1fr; }
    .btn-choice {
        background: white; border: none; padding: 15px; border-radius: 12px;
        font-size: 1.1em; font-weight: bold; color: #444;
        box-shadow: 0 4px 0 rgba(0,0,0,0.1); cursor: pointer;
        display: flex; flex-direction: column; align-items: center; justify-content: center;
        min-height: 80px; transition: transform 0.1s;
    }
    .btn-choice:active { transform: translateY(3px); box-shadow: none; }
    .btn-choice.full-width { grid-column: span 2; } /* æ¨ªé•·ãƒœã‚¿ãƒ³ */

    /* å­£ç¯€ä»•åˆ†ã‘ç”¨ãƒœã‚¿ãƒ³ */
    .season-btn { color: white; text-shadow: 1px 1px 0 rgba(0,0,0,0.2); }
    .season-btn.sp { background: #f06292; }
    .season-btn.su { background: #42a5f5; }
    .season-btn.au { background: #ff7043; }
    .season-btn.wi { background: #90a4ae; }

    /* å›ºå®šãƒ•ãƒƒã‚¿ãƒ¼ */
    .fixed-footer {
        position: fixed; bottom: 0; left: 0; width: 100%;
        background: white; padding: 15px;
        box-shadow: 0 -4px 15px rgba(0,0,0,0.1); text-align: center; z-index: 200;
    }
    .btn-start {
        background: var(--primary); color: white; border: none;
        padding: 15px 40px; border-radius: 50px; font-weight: 900; font-size: 1.2em;
        width: 100%; max-width: 300px; cursor: pointer; box-shadow: 0 4px 0 #7b1fa2;
        display: inline-flex; align-items: center; justify-content: center; gap: 10px;
    }
    .btn-start:active { transform: translateY(3px); box-shadow: none; }

    /* çµæœç”»é¢ */
    .result-score { font-size: 4em; color: var(--primary); font-weight: 900; margin: 10px 0; }
    .feedback-overlay {
        position: absolute; top: 0; left: 0; right: 0; bottom: 0;
        display: flex; justify-content: center; align-items: center;
        font-size: 8em; font-weight: 900; opacity: 0; pointer-events: none; z-index: 50;
    }
    @keyframes popFeedback { 0% { opacity: 0; transform: scale(0.5); } 50% { opacity: 1; transform: scale(1.2); } 100% { opacity: 0; transform: scale(1); } }

</style>
</head>
<body>

<header>
    <a href="index.html" class="logo"><i class="fa-solid fa-calendar-days"></i> æ—¥æœ¬ã®è¡Œäº‹</a>
    <button class="btn-back-nav" onclick="goBack()"><i class="fa-solid fa-arrow-left"></i> ã‚‚ã©ã‚‹</button>
</header>

<div id="screen-list" class="screen active">
    <div style="text-align:center; margin-bottom:20px;">
        <h2><i class="fa-solid fa-book-open"></i> è¡Œäº‹ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼</h2>
        <p>æ—¥æœ¬ã®12ãƒ¶æœˆã‚’è¦šãˆã¾ã—ã‚‡ã†ï¼</p>
    </div>

    <div id="calendar-container" class="calendar-grid"></div>
    <div style="height:80px;"></div>
</div>

<div id="footer-start" class="fixed-footer">
    <button class="btn-start" onclick="showScreen('screen-level')">
        <i class="fa-solid fa-gamepad"></i> ã‚²ãƒ¼ãƒ ã‚¹ã‚¿ãƒ¼ãƒˆ
    </button>
</div>

<div id="screen-level" class="screen">
    <h2 style="text-align:center; margin-bottom:20px;">ãƒ¬ãƒ™ãƒ«ã‚’é¸ã‚“ã§ã­</h2>
    <div class="level-list">
        <div class="level-card" style="border-color:#4caf50;" onclick="startGame(1)">
            <div class="lvl-icon" style="color:#4caf50;"><i class="fa-regular fa-calendar-check"></i></div>
            <div class="lvl-info">
                <h3>Level 1: ã„ã¤ï¼Ÿ (When?)</h3>
                <p>ã€Œã‚¯ãƒªã‚¹ãƒã‚¹ã€ã¯ã€Œ12æœˆã€ï¼æœˆã‚’å½“ã¦ã‚ˆã†ã€‚</p>
            </div>
        </div>
        <div class="level-card" style="border-color:#ff9800;" onclick="startGame(2)">
            <div class="lvl-icon" style="color:#ff9800;"><i class="fa-solid fa-gift"></i></div>
            <div class="lvl-info">
                <h3>Level 2: ã‚¢ã‚¤ãƒ†ãƒ  (Item)</h3>
                <p>ã€Œç¯€åˆ†ã€ã¨ã„ãˆã°ï¼Ÿé–¢é€£ã™ã‚‹ç‰©ã‚’é¸ã¼ã†ã€‚</p>
            </div>
        </div>
        <div class="level-card" style="border-color:#2196f3;" onclick="startGame(3)">
            <div class="lvl-icon" style="color:#2196f3;"><i class="fa-solid fa-person-running"></i></div>
            <div class="lvl-info">
                <h3>Level 3: ä½•ã‚’ã™ã‚‹ï¼Ÿ (Action)</h3>
                <p>ã€Œä¸ƒå¤•ã€ã«ã¯ä½•ã‚’ã™ã‚‹ï¼Ÿç¿’æ…£ã‚’è¦šãˆã‚ˆã†ã€‚</p>
            </div>
        </div>
        <div class="level-card" style="border-color:#e91e63;" onclick="startGame(4)">
            <div class="lvl-icon" style="color:#e91e63;"><i class="fa-solid fa-layer-group"></i></div>
            <div class="lvl-info">
                <h3>Level 4: å­£ç¯€ä»•åˆ†ã‘ (Season Sort)</h3>
                <p>æ˜¥ãƒ»å¤ãƒ»ç§‹ãƒ»å†¬ã€ã©ã£ã¡ï¼Ÿã‚¹ãƒ”ãƒ¼ãƒ‰å‹è² ï¼</p>
            </div>
        </div>
    </div>
</div>

<div id="screen-game" class="screen">
    <div style="display:flex; justify-content:space-between; margin-bottom:10px; font-weight:bold;">
        <span>Level <span id="game-lvl">1</span></span>
        <span>Q <span id="q-current">1</span> / 10</span>
    </div>

    <div class="quiz-display">
        <div id="q-image" class="q-image">ğŸ</div>
        <div id="q-text" class="q-text">ãŠæ­£æœˆ</div>
        <div id="q-sub" class="q-sub">New Year</div>
    </div>

    <div id="choice-container" class="choice-container">
        </div>

    <div id="feedback" class="feedback-overlay"></div>
</div>

<div id="screen-result" class="screen" style="text-align:center; padding-top:40px;">
    <h2>çµæœç™ºè¡¨</h2>
    <div class="result-score"><span id="final-score">0</span><span style="font-size:0.5em;">/10</span></div>
    <p id="result-msg" style="font-size:1.2em; font-weight:bold; margin-bottom:30px;">...</p>
    
    <button class="btn-start" onclick="showScreen('screen-level')">ã‚‚ã†ä¸€åº¦éŠã¶</button>
    <br><br>
    <button class="btn-back-nav" style="background:#999; border:none; width:100%; max-width:300px; padding:15px;" onclick="showScreen('screen-list')">
        å›³é‘‘ã«æˆ»ã‚‹
    </button>
</div>

<script>
    // --- ãƒ‡ãƒ¼ã‚¿ã‚»ãƒƒãƒˆ ---
    // season: 1=Spring, 2=Summer, 3=Autumn, 4=Winter
    const eventsData = [
        { id: 1, name: "ãŠæ­£æœˆ", en: "New Year", month: 1, season: 4, icon: "ğŸ", item: "ãŠã›ã¡ (Osechi)", itemIcon:"ğŸ±", action: "åˆè©£ã«è¡Œã (Go to Shrine)", desc: "1å¹´ã®å§‹ã¾ã‚Šã‚’ç¥ã„ã¾ã™ã€‚" },
        { id: 2, name: "ç¯€åˆ†", en: "Setsubun", month: 2, season: 4, icon: "ğŸ‘¹", item: "è±† (Beans)", itemIcon:"ğŸ¥œ", action: "è±†ã‚’æŠ•ã’ã‚‹ (Throw Beans)", desc: "é¬¼ã¯å¤–ï¼ç¦ã¯å†…ï¼" },
        { id: 3, name: "ãƒãƒ¬ãƒ³ã‚¿ã‚¤ãƒ³", en: "Valentine's", month: 2, season: 4, icon: "ğŸ«", item: "ãƒãƒ§ã‚³ (Chocolate)", itemIcon:"ğŸ’", action: "ãƒãƒ§ã‚³ã‚’ã‚ã’ã‚‹ (Give Choco)", desc: "å¥½ããªäººã«ãƒãƒ§ã‚³ã‚’ã‚ã’ã¾ã™ã€‚" },
        { id: 4, name: "ã²ãªç¥­ã‚Š", en: "Girls' Day", month: 3, season: 1, icon: "ğŸ", item: "ã²ãªäººå½¢ (Dolls)", itemIcon:"ğŸ", action: "äººå½¢ã‚’é£¾ã‚‹ (Display Dolls)", desc: "å¥³ã®å­ã®æˆé•·ã‚’ç¥ã„ã¾ã™ã€‚" },
        { id: 5, name: "å’æ¥­å¼", en: "Graduation", month: 3, season: 1, icon: "ğŸ“", item: "è¨¼æ›¸ (Diploma)", itemIcon:"ğŸ“œ", action: "æ³£ã (Cry)", desc: "å­¦æ ¡ã‚’å’æ¥­ã—ã¾ã™ã€‚" },
        { id: 6, name: "ãŠèŠ±è¦‹", en: "Cherry Blossom", month: 4, season: 1, icon: "ğŸŒ¸", item: "å›£å­ (Dango)", itemIcon:"ğŸ¡", action: "æ¡œã‚’è¦‹ã‚‹ (See Sakura)", desc: "æ¡œã®ä¸‹ã§ãƒ‘ãƒ¼ãƒ†ã‚£ãƒ¼ã‚’ã—ã¾ã™ã€‚" },
        { id: 7, name: "å…¥å­¦å¼", en: "Entrance Ceremony", month: 4, season: 1, icon: "ğŸ«", item: "ãƒ©ãƒ³ãƒ‰ã‚»ãƒ« (Bag)", itemIcon:"ğŸ’", action: "å†™çœŸã‚’æ’®ã‚‹ (Take Photo)", desc: "æ–°ã—ã„å­¦æ ¡ãŒå§‹ã¾ã‚Šã¾ã™ã€‚" },
        { id: 8, name: "ã“ã©ã‚‚ã®æ—¥", en: "Children's Day", month: 5, season: 1, icon: "ğŸ", item: "ã“ã„ã®ã¼ã‚Š (Carp)", itemIcon:"ğŸ", action: "æŸé¤…ã‚’é£Ÿã¹ã‚‹ (Eat Mochi)", desc: "å­ä¾›ã®æˆé•·ã‚’ç¥ã„ã¾ã™ã€‚" },
        { id: 9, name: "æ¢…é›¨", en: "Rainy Season", month: 6, season: 2, icon: "â˜”", item: "ã‚ã˜ã•ã„ (Hydrangea)", itemIcon:"ğŸŒ", action: "å‚˜ã‚’ã•ã™ (Use Umbrella)", desc: "é›¨ãŒãŸãã•ã‚“é™ã‚Šã¾ã™ã€‚" },
        { id: 10, name: "ä¸ƒå¤•", en: "Star Festival", month: 7, season: 2, icon: "ğŸ‹", item: "çŸ­å†Š (Paper Strip)", itemIcon:"ğŸ”–", action: "é¡˜ã„ã‚’æ›¸ã (Write Wish)", desc: "æ˜Ÿã«é¡˜ã„ã‚’ã‹ã‘ã¾ã™ã€‚" },
        { id: 11, name: "èŠ±ç«å¤§ä¼š", en: "Fireworks", month: 8, season: 2, icon: "ğŸ†", item: "æµ´è¡£ (Yukata)", itemIcon:"ğŸ‘˜", action: "èŠ±ç«ã‚’è¦‹ã‚‹ (Watch Fireworks)", desc: "å¤ç¥­ã‚Šã«è¡Œãã¾ã™ã€‚" },
        { id: 12, name: "ãŠç›†", en: "Obon", month: 8, season: 2, icon: "ğŸ®", item: "ç›†è¸Šã‚Š (Dance)", itemIcon:"ğŸ’ƒ", action: "è¸Šã‚‹ (Dance)", desc: "å…ˆç¥–ãŒå¸°ã£ã¦ãã¾ã™ã€‚" },
        { id: 13, name: "ãŠæœˆè¦‹", en: "Moon Viewing", month: 9, season: 3, icon: "ğŸ‘", item: "æœˆè¦‹å›£å­ (Dango)", itemIcon:"ğŸŒ•", action: "æœˆã‚’è¦‹ã‚‹ (View Moon)", desc: "ç§‹ã®æœˆã¯ãã‚Œã„ã§ã™ã€‚" },
        { id: 14, name: "é‹å‹•ä¼š", en: "Sports Day", month: 10, season: 3, icon: "ğŸƒ", item: "ãŠå¼å½“ (Bento)", itemIcon:"ğŸ™", action: "èµ°ã‚‹ (Run)", desc: "å­¦æ ¡ã®ã¿ã‚“ãªã§é‹å‹•ã—ã¾ã™ã€‚" },
        { id: 15, name: "ãƒãƒ­ã‚¦ã‚£ãƒ³", en: "Halloween", month: 10, season: 3, icon: "ğŸƒ", item: "ã‚«ãƒœãƒãƒ£ (Pumpkin)", itemIcon:"ğŸ¬", action: "ä»®è£…ã™ã‚‹ (Cosplay)", desc: "ãŠåŒ–ã‘ã®æ ¼å¥½ã‚’ã—ã¾ã™ã€‚" },
        { id: 16, name: "ä¸ƒäº”ä¸‰", en: "7-5-3", month: 11, season: 3, icon: "â›©ï¸", item: "åƒæ­³é£´ (Candy)", itemIcon:"ğŸ­", action: "ç¥ç¤¾ã«è¡Œã (Go to Shrine)", desc: "3æ­³ã€5æ­³ã€7æ­³ã‚’ç¥ã„ã¾ã™ã€‚" },
        { id: 17, name: "ç´…è‘‰", en: "Autumn Leaves", month: 11, season: 3, icon: "ğŸ", item: "ã‚‚ã¿ã˜ (Maple)", itemIcon:"ğŸ‚", action: "å±±ã«è¡Œã (Go Mountain)", desc: "å±±ãŒèµ¤ã‚„é»„è‰²ã«ãªã‚Šã¾ã™ã€‚" },
        { id: 18, name: "ã‚¯ãƒªã‚¹ãƒã‚¹", en: "Christmas", month: 12, season: 4, icon: "ğŸ„", item: "ã‚±ãƒ¼ã‚­ (Cake)", itemIcon:"ğŸ‚", action: "ãƒã‚­ãƒ³ã‚’é£Ÿã¹ã‚‹ (Eat Chicken)", desc: "ã‚µãƒ³ã‚¿ã•ã‚“ãŒæ¥ã¾ã™ã€‚" },
        { id: 19, name: "å¤§æ™¦æ—¥", en: "New Year's Eve", month: 12, season: 4, icon: "ğŸ””", item: "ãã° (Soba)", itemIcon:"ğŸœ", action: "ãã°ã‚’é£Ÿã¹ã‚‹ (Eat Soba)", desc: "1å¹´æœ€å¾Œã®æ—¥ã§ã™ã€‚" },
        { id: 20, name: "é›ªç¥­ã‚Š", en: "Snow Festival", month: 2, season: 4, icon: "â›„", item: "é›ªã ã‚‹ã¾ (Snowman)", itemIcon:"â„ï¸", action: "é›ªã§éŠã¶ (Play Snow)", desc: "åŒ—æµ·é“ã®ç¥­ã‚ŠãŒæœ‰åã§ã™ã€‚" }
    ];

    // --- çŠ¶æ…‹å¤‰æ•° ---
    let currentLevel = 1;
    let quizList = [];
    let currentQIndex = 0;
    let score = 0;

    // --- ç”»é¢é·ç§» ---
    window.showScreen = (id) => {
        document.querySelectorAll('.screen').forEach(el => el.classList.remove('active'));
        document.getElementById(id).classList.add('active');
        
        const footer = document.getElementById('footer-start');
        footer.style.display = (id === 'screen-list') ? 'block' : 'none';
        window.scrollTo(0,0);
        
        // èƒŒæ™¯è‰²ãƒªã‚»ãƒƒãƒˆ
        document.body.style.backgroundColor = "var(--bg-color)";
    };

    window.goBack = () => {
        const activeId = document.querySelector('.screen.active').id;
        if (activeId === 'screen-level') showScreen('screen-list');
        else if (activeId === 'screen-game') {
            if(confirm("ã‚²ãƒ¼ãƒ ã‚’ã‚„ã‚ã¾ã™ã‹ï¼Ÿ")) showScreen('screen-level');
        }
        else if (activeId === 'screen-result') showScreen('screen-level');
        else window.location.href = 'index.html';
    };

    // --- å›³é‘‘ç”Ÿæˆ ---
    function initList() {
        const container = document.getElementById('calendar-container');
        // æœˆé †ã«ã‚½ãƒ¼ãƒˆ
        const sorted = [...eventsData].sort((a,b) => {
            if(a.month !== b.month) return a.month - b.month;
            return a.id - b.id;
        });

        sorted.forEach(ev => {
            const card = document.createElement('div');
            card.className = 'event-card';
            
            // å­£ç¯€ã‚¯ãƒ©ã‚¹ä»˜ä¸
            if(ev.season === 1) card.classList.add('season-spring');
            else if(ev.season === 2) card.classList.add('season-summer');
            else if(ev.season === 3) card.classList.add('season-autumn');
            else card.classList.add('season-winter');

            card.textContent = `
                <div class="event-month">${ev.month}æœˆ</div>
                <span class="event-emoji">${ev.icon}</span>
                <div class="event-name">${ev.name}</div>
                <div class="event-en">${ev.en}</div>
                <div class="event-desc">${ev.desc}</div>
            `;
            container.appendChild(card);
        });
    }

    // --- ã‚²ãƒ¼ãƒ ãƒ­ã‚¸ãƒƒã‚¯ ---
    window.startGame = (level) => {
        currentLevel = level;
        document.getElementById('game-lvl').textContent = level;
        
        // å•é¡Œãƒªã‚¹ãƒˆç”Ÿæˆï¼ˆ10å•ãƒ©ãƒ³ãƒ€ãƒ ï¼‰
        // Lv4ä»¥å¤–ã¯å…¨ãƒ‡ãƒ¼ã‚¿ã‹ã‚‰ã€Lv4ã¯ä»•åˆ†ã‘ãªã®ã§å…¨ãƒ‡ãƒ¼ã‚¿ä½¿ãˆã‚‹
        let source = [...eventsData];
        quizList = [];
        for(let i=0; i<10; i++) {
            const rand = Math.floor(Math.random() * source.length);
            quizList.push(source[rand]);
        }
        
        currentQIndex = 0;
        score = 0;
        showScreen('screen-game');
        nextQuestion();
    };

    function nextQuestion() {
        if(currentQIndex >= 10) {
            endGame();
            return;
        }

        const q = quizList[currentQIndex];
        document.getElementById('q-current').textContent = currentQIndex + 1;
        
        // å­£ç¯€ã«ã‚ˆã‚‹èƒŒæ™¯å¤‰æ›´
        updateBackground(q.season);

        // å•é¡Œè¡¨ç¤º
        const imgEl = document.getElementById('q-image');
        const txtEl = document.getElementById('q-text');
        const subEl = document.getElementById('q-sub');
        const btnContainer = document.getElementById('choice-container');
        btnContainer.textContent = '';

        if (currentLevel === 4) {
            // Lv4: å­£ç¯€ä»•åˆ†ã‘ (ç”»åƒã‚’è¦‹ã¦å­£ç¯€ã‚’å½“ã¦ã‚‹)
            // ã“ã®å ´åˆã€è¡¨ç¤ºã¯Itemã‹EventIconã®ã©ã¡ã‚‰ã‹ã‚’ãƒ©ãƒ³ãƒ€ãƒ ã«
            const useItem = Math.random() < 0.5;
            imgEl.textContent = useItem ? q.itemIcon : q.icon;
            txtEl.textContent = useItem ? q.item.split(' ')[0] : q.name;
            subEl.textContent = useItem ? "ã“ã®ã‚¢ã‚¤ãƒ†ãƒ ã®å­£ç¯€ã¯ï¼Ÿ" : "ã“ã®è¡Œäº‹ã®å­£ç¯€ã¯ï¼Ÿ";

            // å›ºå®š4æŠãƒœã‚¿ãƒ³
            const seasons = [
                { id: 1, name: "æ˜¥ (Spring)", cls: "sp" },
                { id: 2, name: "å¤ (Summer)", cls: "su" },
                { id: 3, name: "ç§‹ (Autumn)", cls: "au" },
                { id: 4, name: "å†¬ (Winter)", cls: "wi" }
            ];
            seasons.forEach(s => {
                const btn = document.createElement('button');
                btn.className = `btn-choice season-btn ${s.cls}`;
                btn.textContent = s.name;
                btn.onclick = () => checkAnswer(s.id === q.season);
                btnContainer.appendChild(btn);
            });

        } else {
            // Lv1~3: ã‚¯ã‚¤ã‚ºå½¢å¼
            imgEl.textContent = q.icon;
            txtEl.textContent = q.name;
            subEl.textContent = q.en;

            // æ­£è§£ã¨èª¤ç­”ã®ç”Ÿæˆ
            let correctAnswer, correctText;
            if(currentLevel === 1) { // ã„ã¤ï¼Ÿ
                correctAnswer = q.month;
                correctText = q.month + "æœˆ";
            } else if(currentLevel === 2) { // ã‚¢ã‚¤ãƒ†ãƒ 
                correctAnswer = q.item;
                correctText = `${q.itemIcon} ${q.item}`;
            } else { // ã‚¢ã‚¯ã‚·ãƒ§ãƒ³
                correctAnswer = q.action;
                correctText = q.action;
            }

            // èª¤ç­”å€™è£œã‚’ä½œæˆ
            let wrongOptions = [];
            while(wrongOptions.length < 3) {
                const rand = eventsData[Math.floor(Math.random() * eventsData.length)];
                let wrongVal, wrongTxt;
                
                if(currentLevel === 1) {
                    if(rand.month === q.month) continue; // åŒã˜æœˆã¯é™¤å¤–
                    wrongVal = rand.month;
                    wrongTxt = rand.month + "æœˆ";
                } else if(currentLevel === 2) {
                    if(rand.id === q.id) continue;
                    wrongVal = rand.item;
                    wrongTxt = `${rand.itemIcon} ${rand.item}`;
                } else {
                    if(rand.id === q.id) continue;
                    wrongVal = rand.action;
                    wrongTxt = rand.action;
                }
                
                // é‡è¤‡ãƒã‚§ãƒƒã‚¯
                if(!wrongOptions.some(w => w.val === wrongVal)) {
                    wrongOptions.push({ val: wrongVal, txt: wrongTxt });
                }
            }

            // é¸æŠè‚¢ã‚’ãƒãƒ¼ã‚¸ã—ã¦ã‚·ãƒ£ãƒƒãƒ•ãƒ«
            let options = [{ val: correctAnswer, txt: correctText, isCorrect: true }];
            wrongOptions.forEach(w => options.push({ val: w.val, txt: w.txt, isCorrect: false }));
            options.sort(() => 0.5 - Math.random());

            options.forEach(opt => {
                const btn = document.createElement('button');
                btn.className = 'btn-choice full-width'; // Lv1-3ã¯é¸æŠè‚¢ã®æ–‡å­—æ•°ãŒå¤šã„ã®ã§æ¨ªé•·ã«
                btn.textContent = opt.txt;
                btn.onclick = () => checkAnswer(opt.isCorrect);
                btnContainer.appendChild(btn);
            });
        }
    }

    function updateBackground(season) {
        let color = "";
        if(season === 1) color = "var(--spring)";
        else if(season === 2) color = "var(--summer)";
        else if(season === 3) color = "var(--autumn)";
        else color = "var(--winter)";
        document.body.style.backgroundColor = color;
    }

    function checkAnswer(isCorrect) {
        const fb = document.getElementById('feedback');
        fb.textContent = isCorrect ? 'â­•' : 'âŒ';
        fb.style.color = isCorrect ? '#4caf50' : '#f44336';
        fb.style.animation = 'none';
        fb.offsetHeight; 
        fb.style.animation = 'popFeedback 0.6s ease';

        if(isCorrect) score++;

        // ãƒœã‚¿ãƒ³ãƒ­ãƒƒã‚¯
        const btns = document.querySelectorAll('.btn-choice');
        btns.forEach(b => b.disabled = true);

        setTimeout(() => {
            currentQIndex++;
            nextQuestion();
        }, 1000);
    }

    function endGame() {
        document.body.style.backgroundColor = "var(--bg-color)";
        showScreen('screen-result');
        document.getElementById('final-score').textContent = score;
        
        const msg = document.getElementById('result-msg');
        if(score === 10) msg.textContent = "å®Œç’§ï¼æ—¥æœ¬é€šã§ã™ã­ï¼ğŸŒ";
        else if(score >= 8) msg.textContent = "ã™ã”ã„ï¼æ—¥æœ¬ã®æ–‡åŒ–ã‚’ã‚ˆãçŸ¥ã£ã¦ã„ã¾ã™ã€‚âœ¨";
        else if(score >= 5) msg.textContent = "Good! ã‚‚ã†å°‘ã—ã§ãƒã‚¹ã‚¿ãƒ¼ã§ã™ã€‚ğŸ‘";
        else msg.textContent = "å›³é‘‘ã‚’è¦‹ã¦å¾©ç¿’ã—ã¾ã—ã‚‡ã†ï¼ğŸ“–";
    }

    // åˆæœŸåŒ–
    initList();

</script>
</body>
</html>