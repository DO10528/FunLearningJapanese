<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title data-i18n="main_title">Fun Learning Japanese</title>
<meta name="description" content="Learn Hiragana, Katakana, Kanji, and grammar with fun, free Japanese learning games! Perfect for beginners.">

<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#5c7aff">

<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="apple-mobile-web-app-title" content="FunLearnJP">
<link rel="apple-touch-icon" href="images/icons/icon-192x192.png"> 
<link rel="stylesheet" href="css/style.css">
<style>
/* æ—¢å­˜ã®èªè¨¼UIã¨ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã®CSS */
.menu-group { background-color: #f0f8ff; border: 2px solid #5c7aff; border-radius: 15px; padding: 15px 20px; margin-bottom: 25px; box-shadow: 0 2px 4px rgba(0,0,0,0.05); }
.menu-group h2 { text-align: center; color: #5c7aff; font-size: 1.5em; margin-bottom: 20px; }
#auth-status-bar { width: 100%; max-width: 800px; margin: 10px auto 20px; padding: 10px 20px; background-color: #fff; border-radius: 10px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; }
#user-status-container { display: flex; flex-direction: column; align-items: flex-start; padding: 5px 0; } 
#user-info { font-size: 1.1em; font-weight: bold; color: #333; } 
#streak-display { font-size: 0.9em; font-weight: 800; color: #ff6b6b; } 
#points-display { font-size: 0.9em; font-weight: 800; color: #5cb85c; } 
#auth-buttons button { margin-left: 10px; padding: 8px 15px; border: none; border-radius: 8px; cursor: pointer; font-weight: 700; transition: background-color 0.2s; }
.btn-login { background-color: #5cb85c; color: white; }
.btn-signup { background-color: #007bff; color: white; }
.btn-guest { background-color: #f0ad4e; color: white; }
.btn-logout { background-color: #d9534f; color: white; }
.modal-overlay { position: fixed; top: 0; left: 0; right: 0; bottom: 0; background-color: rgba(0, 0, 0, 0.6); display: flex; justify-content: center; align-items: center; z-index: 2000; }
.modal-content { background-color: white; padding: 30px; border-radius: 15px; width: 90%; max-width: 400px; box-shadow: 0 5px 15px rgba(0,0,0,0.3); }
.modal-content h2 { margin-top: 0; color: #005bb5; }
.modal-content input { width: 100%; padding: 12px; margin-bottom: 15px; border: 1px solid #ccc; border-radius: 8px; box-sizing: border-box; }
.modal-content button { width: 100%; padding: 12px; border: none; border-radius: 8px; font-weight: bold; cursor: pointer; margin-top: 10px; }
.modal-content .btn-submit { background-color: #007bff; color: white; }
.modal-content .btn-close { background-color: #ccc; color: #333; margin-top: 10px; }
.form-message { color: #d9534f; margin-bottom: 10px; font-weight: bold; }
#main-menu.locked { filter: blur(2px); pointer-events: none; user-select: none; }
#initial-message { text-align: center; padding: 50px 20px; font-size: 1.1em; color: #d9534f; font-weight: bold; border: 2px dashed #d9534f50; border-radius: 10px; margin-top: 20px; }
@media (max-width: 600px) { #auth-status-bar { flex-direction: column; gap: 10px; } #user-status-container { width: 100%; align-items: center; } #auth-buttons { width: 100%; display: flex; justify-content: space-between; } #auth-buttons button { margin: 0 2px; flex-grow: 1; } }


/* ========================================= */
/* ãƒ©ãƒ³ã‚­ãƒ³ã‚°æ©Ÿèƒ½ã®CSS */
/* ========================================= */
#ranking-container {
    background-color: #fff;
    border: 3px solid #ffca28; /* ã‚´ãƒ¼ãƒ«ãƒ‰ã£ã½ã„æ ç·š */
    border-radius: 15px;
    padding: 10px;
    box-shadow: 0 4px 10px rgba(0,0,0,0.1);
    z-index: 1000;
}

#ranking-container h3 {
    margin: 0 0 10px 0;
    font-size: 1em;
    text-align: center;
    color: #ff6f00;
    font-weight: 800;
}

#ranking-list {
    list-style: none;
    padding: 0;
    margin: 0;
}

#ranking-list li {
    margin-bottom: 5px;
    font-weight: bold;
    font-size: 0.9em;
    border-bottom: 1px dashed #eee;
    white-space: nowrap; 
}

/* 1ä½ã€œ3ä½ã®ã‚¢ã‚¤ã‚³ãƒ³è‰² */
#ranking-list li:nth-child(1) { color: #d4af37; } 
#ranking-list li:nth-child(2) { color: #c0c0c0; } 
#ranking-list li:nth-child(3) { color: #cd7f32; } 

/* -----------------------------------------
   ã‚¹ãƒãƒ› (FunLearningJapaneseã®ä¸‹ã«æ¨ªä¸¦ã³)
   ----------------------------------------- */
@media (max-width: 1023px) {
    #ranking-container {
        width: 90%;
        max-width: 600px;
        margin: 10px auto 20px auto; 
        text-align: center;
    }

    #ranking-list {
        display: flex;          
        overflow-x: auto;       
        justify-content: flex-start; 
        gap: 15px;               
    }

    #ranking-list li {
        flex-shrink: 0;         
        border-bottom: none;    
        background: #fff8e1;
        padding: 5px 10px;
        border-radius: 10px;
    }
}

/* -----------------------------------------
   PC/iPad (ç”»é¢å·¦å´ã«å›ºå®šã—ã¦ç¸¦ä¸¦ã³)
   ----------------------------------------- */
@media (min-width: 1024px) {
    #ranking-container {
        position: fixed;        
        left: 20px;             
        top: 150px;             
        width: 200px;           
    }
    
    #ranking-list {
        display: block;         
    }
    #main-menu {
        margin-left: 240px; 
    }
}
</style>

<script async src="https://www.googletagmanager.com/gtag/js?id=G-0BX3DD42C1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-0BX3DD42C1');
</script>
</head>
<body>
    
<div id="language-switcher">
    <button onclick="setLanguage('ja')" id="lang-ja" class="lang-button active">ã«ã»ã‚“ã”</button>
    <button onclick="setLanguage('en')" id="lang-en" class="lang-button">English</button>
</div>

<div id="auth-status-bar">
    <div id="user-status-container">
        <span id="user-info" data-i18n="auth_status_default">ãƒ­ã‚°ã‚¤ãƒ³ã—ã¦ã„ã¾ã›ã‚“</span>
        <span id="streak-display" style="display: none;"></span>
        <span id="points-display" style="display: none;"></span>
    </div>
    <div id="auth-buttons">
        <button id="login-btn" class="btn-login" data-i18n="btn_login">ãƒ­ã‚°ã‚¤ãƒ³</button>
        <button id="signup-btn" class="btn-signup" data-i18n="btn_signup">æ–°è¦ç™»éŒ²</button>
        <button id="guest-btn" class="btn-guest" data-i18n="btn_guest">ã‚²ã‚¹ãƒˆã§ãƒ—ãƒ¬ã‚¤</button>
        <button id="logout-btn" class="btn-logout" data-i18n="btn_logout" style="display:none;">ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ</button>
    </div>
</div>

<h1 data-i18n="main_title">Fun Learning Japanese</h1>

<div id="ranking-container" style="display: none;">
    <h3>ğŸ† ä»Šæœˆã®ãƒˆãƒƒãƒ—5</h3>
    <ul id="ranking-list"></ul>
</div>

<div id="initial-message" style="display: none;">
    <p data-i18n="msg_initial_1">ã‚²ãƒ¼ãƒ ã‚’å§‹ã‚ã‚‹ã«ã¯ã€ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã«**ãƒ­ã‚°ã‚¤ãƒ³**ã™ã‚‹ã‹ã€**æ–°è¦ç™»éŒ²**ã‚’ã—ã¦ãã ã•ã„ã€‚</p>
    <p data-i18n="msg_initial_2">é€²æ—ã‚’ä¿å­˜ã—ãªã„å ´åˆã¯ã€**ã‚²ã‚¹ãƒˆ**ã¨ã—ã¦ãƒ—ãƒ¬ã‚¤ã™ã‚‹ã“ã¨ã‚‚ã§ãã¾ã™ã€‚</p>
</div>

<div id="main-menu" class="container">
    <div class="menu-group">
        <h2 data-i18n="group_kiso">ãããƒ»ãŸã‚“ã”ãƒªã‚¹ãƒˆ</h2>
        <div class="menu-buttons-grid">
            <a href="kiso.html" class="menu-card-button menu-card-reset" data-i18n-html="btn_kiso">
                ğŸ“<br>ã²ã‚‰ãŒãªãƒ»ã‚«ã‚¿ã‚«ãƒŠåŸºç¤
            </a>
            <a href="hiragana_video_list.html" class="menu-card-button menu-card-reset" data-i18n-html="btn_hiragana_video">
                ğŸ¥<br>ã²ã‚‰ãŒãªç·´ç¿’
            </a>
            <a href="keiyoshi_list.html" class="menu-card-button menu-card-reset" data-i18n-html="btn_keiyoshi_list">
                ğŸ“š<br>å½¢å®¹è©ãƒªã‚¹ãƒˆ
            </a>
            <a href="kanji_list.html" class="menu-card-button menu-card-reset" data-i18n-html="btn_kanji_list">
                ğŸ“–<br>æ¼¢å­—ãƒªã‚¹ãƒˆ (å°1)
            </a>
        </div>
    </div>

    <div class="menu-group">
        <h2 data-i18n="group_game">ãªã«ã‚’ã—ã¦ã‚ãã¶?</h2>
        <div class="menu-buttons-grid">
            <a href="hiragana.html" class="menu-card-button menu-card-reset" data-i18n-html="btn_hiragana_game">
                ğŸ®<br>ã²ã‚‰ãŒãªå˜èªã‚²ãƒ¼ãƒ 
            </a>
            <a href="hiragana2.html" class="menu-card-button menu-card-reset" data-i18n-html="btn_hiragana_game2">
                â­<br>ã²ã‚‰ãŒãªã‚²ãƒ¼ãƒ 2 (ä¸¦ã³æ›¿ãˆ)
            </a>
            <a href="hiragana_drag_match.html" class="menu-card-button menu-card-reset" data-i18n-html="btn_hiragana_drag">
                ğŸ§©<br>ã²ã‚‰ãŒãªå˜èªã‚ã‚ã›
            </a>
            <a href="katakana_drag_match.html" class="menu-card-button menu-card-reset" data-i18n-html="btn_katakana_drag">
                ğŸ§©<br>ã‚«ã‚¿ã‚«ãƒŠå˜èªã‚ã‚ã›
            </a>
            <a href="shiritori.html" class="menu-card-button menu-card-reset" data-i18n-html="btn_shiritori">
                ğŸ—£ï¸<br>ã—ã‚Šã¨ã‚Šã‚²ãƒ¼ãƒ 
            </a>
            <a href="shiritori2.html" class="menu-card-button menu-card-reset" data-i18n-html="btn_shiritori2">
                ğŸ—£ï¸<br>ã—ã‚Šã¨ã‚Šã‚²ãƒ¼ãƒ 2
            </a>
            <a href="clock.html" class="menu-card-button menu-card-reset" data-i18n-html="btn_clock">
                ğŸ—£ï¸<br>ã¨ã‘ã„ã‚²ãƒ¼ãƒ 
            </a>
            <a href="clock2.html" class="menu-card-button menu-card-reset" data-i18n-html="btn_clock2">
                ğŸ—£ï¸<br>ã¨ã‘ã„ã‚²ãƒ¼ãƒ 2
            </a>
            <a href="keiyoshi.html" class="menu-card-button menu-card-reset" data-i18n-html="btn_keiyoshi_quiz">
                ğŸ¤”<br>å½¢å®¹è©ã‚¯ã‚¤ã‚º
            </a>
            <a href="adjective_quiz.html" class="menu-card-button menu-card-reset" data-i18n-html="btn_adjective_quiz">
                ğŸ¤”<br>å½¢å®¹è©ã‚¯ã‚¤ã‚º2
            </a>
            <a href="kanji_quiz.html" class="menu-card-button menu-card-reset" data-i18n-html="btn_kanji_quiz">
                ğŸˆ³<br>æ¼¢å­—ã‚¯ã‚¤ã‚º (å°1)
            </a>
            <a href="aisatsu_quiz.html" class="menu-card-button menu-card-reset" data-i18n-html="btn_aisatsu_quiz">
                ğŸ—£ï¸<br>æŒ¨æ‹¶ã‚¯ã‚¤ã‚º
            </a>
            <a href="verb.html" class="menu-card-button menu-card-reset" data-i18n-html="btn_verb_game">
                ğŸ—£ï¸<br>å‹•è©ã‚²ãƒ¼ãƒ 
            </a>
            <a href="sentence_puzzle.html" class="menu-card-button menu-card-reset" data-i18n-html="btn_sentence_puzzle">
                ğŸ—£ï¸<br>æ–‡æ³•ä¸¦ã³æ›¿ãˆã‚²ãƒ¼ãƒ 
            </a>
            <a href="meteor_quiz.html" class="menu-card-button menu-card-reset" data-i18n-html="btn_meteor_quiz">
                ğŸ—£ï¸<br>éš•çŸ³ã‚¯ã‚¤ã‚º
            </a>
            <a href="treasure_Hunt.html" class="menu-card-button menu-card-reset" data-i18n-html="btn_treasure_hunt">
                ğŸ—£ï¸<br>ãŸã‹ã‚‰ã•ãŒã—ã‚²ãƒ¼ãƒ 
            </a>
        </div>
    </div>
</div>
<div id="game-area" class="container" style="display:none;">
    <p>ã‚²ãƒ¼ãƒ ã‚’èª­ã¿è¾¼ã‚“ã§ã„ã¾ã™...</p>
</div>

<div id="auth-modal" class="modal-overlay" style="display:none;">
    <div class="modal-content">
        <div id="login-view">
            <h2 data-i18n="login_title">ãƒ­ã‚°ã‚¤ãƒ³</h2>
            <div id="login-message" class="form-message"></div>
            <input type="text" id="login-gamename" data-i18n-placeholder="placeholder_gamename" placeholder="ã‚²ãƒ¼ãƒ å" required>
            <input type="password" id="login-password" data-i18n-placeholder="placeholder_password" placeholder="ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰" required>
            <button id="login-submit-btn" class="btn-submit" data-i18n="btn_login">ãƒ­ã‚°ã‚¤ãƒ³</button>
            <button class="btn-close" data-i18n="btn_cancel">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
        </div>
        
        <div id="signup-view" style="display:none;">
            <h2 data-i18n="signup_title">æ–°è¦ç™»éŒ²</h2>
            <div id="signup-message" class="form-message"></div>
            <p style="font-size: 0.9em; color: #555;" data-i18n="msg_signup_note">â€»ã‚µã‚¤ãƒ³ã‚¢ãƒƒãƒ—ã™ã‚‹ã¨ã‚²ãƒ¼ãƒ ã®é€²æ—ãŒä¿å­˜ã•ã‚Œã¾ã™ã€‚</p>
            <input type="text" id="signup-gamename" data-i18n-placeholder="placeholder_new_gamename" placeholder="æ–°ã—ã„ã‚²ãƒ¼ãƒ å (å¿…é ˆ)" required>
            <input type="password" id="signup-password" data-i18n-placeholder="placeholder_password" placeholder="ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ (å¿…é ˆ)" required>
            <button id="signup-submit-btn" class="btn-submit" data-i18n="btn_signup_submit">ç™»éŒ²ã—ã¦ãƒ­ã‚°ã‚¤ãƒ³</button>
            <button class="btn-close" data-i18n="btn_cancel">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
        </div>
    </div>
</div>

<script>
    // ----------------------------------------------------
    // â˜…â˜…â˜… ã‚µãƒ¼ãƒ“ã‚¹ãƒ¯ãƒ¼ã‚«ãƒ¼ã¯å‰Šé™¤ã—ãªã„ã§ãã ã•ã„ â˜…â˜…â˜…
    // ----------------------------------------------------
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        navigator.serviceWorker.register('/service-worker.js')
          .then(registration => {
            console.log('ServiceWorker registered: ', registration);
          })
          .catch(registrationError => {
            console.log('ServiceWorker registration failed: ', registrationError);
          });
      });
    }

    // ----------------------------------------------------
    // è¨€èªãƒ‡ãƒ¼ã‚¿
    // ----------------------------------------------------
    const translations = {
        'ja': {
            'main_title': 'Fun Learning Japanese',
            'group_kiso': 'ãããƒ»ãŸã‚“ã”ãƒªã‚¹ãƒˆ',
            'group_game': 'ãªã«ã‚’ã—ã¦ã‚ãã¶?',
            'auth_status_default': 'ãƒ­ã‚°ã‚¤ãƒ³ã—ã¦ã„ã¾ã›ã‚“',
            'btn_login': 'ãƒ­ã‚°ã‚¤ãƒ³',
            'btn_signup': 'æ–°è¦ç™»éŒ²',
            'btn_guest': 'ã‚²ã‚¹ãƒˆã§ãƒ—ãƒ¬ã‚¤',
            'btn_logout': 'ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ',
            'msg_initial_1': 'ã‚²ãƒ¼ãƒ ã‚’å§‹ã‚ã‚‹ã«ã¯ã€ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã«**ãƒ­ã‚°ã‚¤ãƒ³**ã™ã‚‹ã‹ã€**æ–°è¦ç™»éŒ²**ã‚’ã—ã¦ãã ã•ã„ã€‚',
            'msg_initial_2': 'é€²æ—ã‚’ä¿å­˜ã—ãªã„å ´åˆã¯ã€**ã‚²ã‚¹ãƒˆ**ã¨ã—ã¦ãƒ—ãƒ¬ã‚¤ã™ã‚‹ã“ã¨ã‚‚ã§ãã¾ã™ã€‚',
            'login_title': 'ãƒ­ã‚°ã‚¤ãƒ³',
            'signup_title': 'æ–°è¦ç™»éŒ²',
            'msg_signup_note': 'â€»ã‚µã‚¤ãƒ³ã‚¢ãƒƒãƒ—ã™ã‚‹ã¨ã‚²ãƒ¼ãƒ ã®é€²æ—ãŒä¿å­˜ã•ã‚Œã¾ã™ã€‚',
            'btn_signup_submit': 'ç™»éŒ²ã—ã¦ãƒ­ã‚°ã‚¤ãƒ³',
            'btn_cancel': 'ã‚­ãƒ£ãƒ³ã‚»ãƒ«',
            'placeholder_gamename': 'ã‚²ãƒ¼ãƒ å',
            'placeholder_new_gamename': 'æ–°ã—ã„ã‚²ãƒ¼ãƒ å (å¿…é ˆ)',
            'placeholder_password': 'ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰',
            'status_guest': 'ã‚²ã‚¹ãƒˆãƒ¢ãƒ¼ãƒ‰',
            'status_welcome': 'ã•ã‚“ã€ã‚ˆã†ã“ãï¼',
            'streak_text': 'ğŸ”¥é€£ç¶š%DAYS%æ—¥ç›®ï¼', 
            'points_text': 'â­ãƒã‚¤ãƒ³ãƒˆï¼š%POINTS%',
            'msg_login_fail': 'ã‚²ãƒ¼ãƒ åã¾ãŸã¯ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãŒé•ã„ã¾ã™ã€‚',
            'btn_kiso': 'ğŸ“<br>ã²ã‚‰ãŒãªãƒ»ã‚«ã‚¿ã‚«ãƒŠåŸºç¤',
            'btn_hiragana_video': 'ğŸ¥<br>ã²ã‚‰ãŒãªç·´ç¿’',
            'btn_keiyoshi_list': 'ğŸ“š<br>å½¢å®¹è©ãƒªã‚¹ãƒˆ',
            'btn_kanji_list': 'ğŸ“–<br>æ¼¢å­—ãƒªã‚¹ãƒˆ (å°1)',
            'btn_hiragana_drag': 'ğŸ§©<br>ã²ã‚‰ãŒãªå˜èªã‚ã‚ã›',
            'btn_hiragana_game': 'ğŸ®<br>ã²ã‚‰ãŒãªå˜èªã‚²ãƒ¼ãƒ ',
            'btn_hiragana_game2': 'â­<br>ã²ã‚‰ãŒãªã‚²ãƒ¼ãƒ 2 (ä¸¦ã³æ›¿ãˆ)',
            'btn_katakana_drag': 'ğŸ§©<br>ã‚«ã‚¿ã‚«ãƒŠå˜èªã‚ã‚ã›',
            'btn_shiritori': 'ğŸ—£ï¸<br>ã—ã‚Šã¨ã‚Šã‚²ãƒ¼ãƒ ',
            'btn_shiritori2': 'ğŸ—£ï¸<br>ã—ã‚Šã¨ã‚Šã‚²ãƒ¼ãƒ 2',
            'btn_clock': 'ğŸ—£ï¸<br>ã¨ã‘ã„ã‚²ãƒ¼ãƒ ',
            'btn_clock2': 'ğŸ—£ï¸<br>ã¨ã‘ã„ã‚²ãƒ¼ãƒ 2',
            'btn_keiyoshi_quiz': 'ğŸ¤”<br>å½¢å®¹è©ã‚¯ã‚¤ã‚º',
            'btn_adjective_quiz': 'ğŸ¤”<br>å½¢å®¹è©ã‚¯ã‚¤ã‚º2',
            'btn_kanji_quiz': 'ğŸˆ³<br>æ¼¢å­—ã‚¯ã‚¤ã‚º (å°1)',
            'btn_aisatsu_quiz': 'ğŸ—£ï¸<br>æŒ¨æ‹¶ã‚¯ã‚¤ã‚º',
            'btn_verb_game': 'ğŸ—£ï¸<br>å‹•è©ã‚²ãƒ¼ãƒ ',
            'btn_sentence_puzzle': 'ğŸ—£ï¸<br>æ–‡æ³•ä¸¦ã³æ›¿ãˆã‚²ãƒ¼ãƒ ',
            'btn_meteor_quiz': 'ğŸ—£ï¸<br>éš•çŸ³ã‚¯ã‚¤ã‚º',
            'btn_treasure_hunt': 'ğŸ—£ï¸<br>ãŸã‹ã‚‰ã•ãŒã—ã‚²ãƒ¼ãƒ ',
        },
        'en': {
            'main_title': 'Fun Learning Japanese',
            'group_kiso': 'Basics & Vocabulary Lists',
            'group_game': 'What would you like to play?',
            'auth_status_default': 'Not logged in',
            'btn_login': 'Login',
            'btn_signup': 'Sign Up',
            'btn_guest': 'Play as Guest',
            'btn_logout': 'Logout',
            'msg_initial_1': 'To start the game, please **Log in** to your account or **Sign up**.',
            'msg_initial_2': 'If you do not wish to save your progress, you can play as a **Guest**.',
            'login_title': 'Login',
            'signup_title': 'Sign Up',
            'msg_signup_note': 'Note: Signing up allows you to save your game progress.',
            'btn_signup_submit': 'Register and Login',
            'btn_cancel': 'Cancel',
            'placeholder_gamename': 'Game Name',
            'placeholder_new_gamename': 'New Game Name (Required)',
            'placeholder_password': 'Password',
            'status_guest': 'Guest Mode',
            'status_welcome': ', welcome!',
            'streak_text': 'ğŸ”¥Streak: %DAYS% days!', 
            'points_text': 'â­Points: %POINTS%',
            'msg_login_fail': 'Game Name or password incorrect.',
            'btn_kiso': 'ğŸ“<br>Hiragana/Katakana Basics',
            'btn_hiragana_video': 'ğŸ¥<br>Hiragana Practice',
            'btn_keiyoshi_list': 'ğŸ“š<br>Adjective List',
            'btn_kanji_list': 'ğŸ“–<br>Kanji List (Gr.1)',
            'btn_hiragana_drag': 'ğŸ§©<br>Hiragana Word Match',
            'btn_hiragana_game': 'ğŸ®<br>Hiragana Word Game',
            'btn_hiragana_game2': 'â­<br>Hiragana Game 2 (Order)',
            'btn_katakana_drag': 'ğŸ§©<br>Katakana Word Match',
            'btn_shiritori': 'ğŸ—£ï¸<br>Shiritori Game',
            'btn_shiritori2': 'ğŸ—£ï¸<br>Shiritori Game 2',
            'btn_clock': 'ğŸ—£ï¸<br>Clock Game',
            'btn_clock2': 'ğŸ—£ï¸<br>Clock Game 2',
            'btn_keiyoshi_quiz': 'ğŸ¤”<br>Adjective Quiz',
            'btn_adjective_quiz': 'ğŸ¤”<br>Adjective Quiz 2',
            'btn_kanji_quiz': 'ğŸˆ³<br>Kanji Quiz (Gr.1)',
            'btn_aisatsu_quiz': 'ğŸ—£ï¸<br>Greetings Quiz',
            'btn_verb_game': 'ğŸ—£ï¸<br>Verb Game',
            'btn_sentence_puzzle': 'ğŸ—£ï¸<br>Grammar Puzzle',
            'btn_meteor_quiz': 'ğŸ—£ï¸<br>Meteor Quiz',
            'btn_treasure_hunt': 'ğŸ—£ï¸<br>Treasure Hunt',
        }
    };

    function updateLanguageUI(lang) {
        const langData = translations[lang];

        document.querySelectorAll('[data-i18n]').forEach(el => {
            const key = el.getAttribute('data-i18n');
            if (langData[key]) {
                el.textContent = langData[key];
            }
        });

        document.querySelectorAll('[data-i18n-html]').forEach(el => {
            const key = el.getAttribute('data-i18n-html');
            if (langData[key]) {
                el.innerHTML = langData[key];
            }
        });
        
        document.querySelectorAll('[data-i18n-placeholder]').forEach(el => {
            const key = el.getAttribute('data-i18n-placeholder');
            if (langData[key]) {
                el.placeholder = langData[key];
            }
        });

        document.getElementById('lang-ja')?.classList.remove('active');
        document.getElementById('lang-en')?.classList.remove('active');
        document.getElementById(`lang-${lang}`)?.classList.add('active');
        
        updateAuthenticationUI();
    }

    window.setLanguage = function(lang) {
        if (!translations[lang]) return;
        localStorage.setItem('preferredLang', lang);
        updateLanguageUI(lang);
    };


    // ----------------------------------------------------
    // èªè¨¼ãƒ­ã‚¸ãƒƒã‚¯ (ã‚¹ãƒˆãƒªãƒ¼ã‚¯ãƒ»ãƒã‚¤ãƒ³ãƒˆåŸºç›¤)
    // ----------------------------------------------------

    const USER_STORAGE_KEY = 'user_accounts';
    const SESSION_STORAGE_KEY = 'current_user';
    const GUEST_NAME = 'ã‚²ã‚¹ãƒˆ'; 
    const LANG_DEFAULT = 'ja'; 
    const RANKING_MONTH_KEY = 'ranking_month_check'; // â˜… æœˆé–“ãƒªã‚»ãƒƒãƒˆãƒã‚§ãƒƒã‚¯ç”¨ã®ã‚­ãƒ¼

    const userInfoEl = document.getElementById('user-info');
    const streakDisplayEl = document.getElementById('streak-display'); 
    const pointsDisplayEl = document.getElementById('points-display'); 
    
    const loginBtn = document.getElementById('login-btn');
    const signupBtn = document.getElementById('signup-btn');
    const guestBtn = document.getElementById('guest-btn');
    const logoutBtn = document.getElementById('logout-btn');

    const initialMessageEl = document.getElementById('initial-message');
    const mainMenuEl = document.getElementById('main-menu');
    
    const modalOverlay = document.getElementById('auth-modal');
    const loginView = document.getElementById('login-view');
    const signupView = document.getElementById('signup-view');

    // â˜…ãƒ©ãƒ³ã‚­ãƒ³ã‚°è¡¨ç¤ºç”¨ã®DOM
    const rankingContainer = document.getElementById('ranking-container');
    const rankingList = document.getElementById('ranking-list');
    
    function getUsers() {
        const usersJson = localStorage.getItem(USER_STORAGE_KEY);
        return usersJson ? JSON.parse(usersJson) : {};
    }
    function saveUsers(users) {
        localStorage.setItem(USER_STORAGE_KEY, JSON.stringify(users));
    }
    function getCurrentLang() {
        return localStorage.getItem('preferredLang') || LANG_DEFAULT;
    }
    
    function getTodayDateString() {
        const now = new Date();
        const year = now.getFullYear();
        const month = String(now.getMonth() + 1).padStart(2, '0');
        const day = String(now.getDate()).padStart(2, '0');
        return `${year}-${month}-${day}`;
    }

    function parseDate(dateString) {
        if (!dateString) return null;
        const parts = dateString.split('-');
        return new Date(Date.UTC(parts[0], parts[1] - 1, parts[2]));
    }

    function updateStreak(user) {
        const todayStr = getTodayDateString();
        
        if (!user.streak || !user.last_login) {
            user.streak = 1;
            user.last_login = todayStr;
            return user;
        }

        if (user.last_login === todayStr) {
            return user;
        }

        const lastLoginDate = parseDate(user.last_login);
        const yesterday = new Date(parseDate(todayStr));
        yesterday.setUTCDate(yesterday.getUTCDate() - 1); 

        const yesterdayStr = `${yesterday.getUTCFullYear()}-${String(yesterday.getUTCMonth() + 1).padStart(2, '0')}-${String(yesterday.getUTCDate()).padStart(2, '0')}`;
        
        if (user.last_login === yesterdayStr) {
            user.streak += 1;
        } else {
            user.streak = 1;
        }
        
        user.last_login = todayStr;
        return user;
    }

    // --- æ”¹è‰¯: addPoints ã®å®Ÿè£… ---
    window.addPoints = function(amount, gameId) {
        const currentUser = sessionStorage.getItem(SESSION_STORAGE_KEY);
        if (!currentUser || currentUser === GUEST_NAME) {
            console.warn("ã‚²ã‚¹ãƒˆãƒ¢ãƒ¼ãƒ‰ã¾ãŸã¯æœªãƒ­ã‚°ã‚¤ãƒ³: ãƒã‚¤ãƒ³ãƒˆã¯åŠ ç®—ã•ã‚Œã¾ã›ã‚“ã€‚");
            return false;
        }

        if (typeof amount !== 'number' || amount <= 0) {
            console.error("ç„¡åŠ¹ãªãƒã‚¤ãƒ³ãƒˆæ•°ã§ã™ã€‚");
            return false;
        }

        let users = getUsers();
        let user = users[currentUser];

        if (!user) {
             console.error(`ãƒ¦ãƒ¼ã‚¶ãƒ¼ ${currentUser} ãŒlocalStorageã«è¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã€‚`);
             return false;
        }

        user.points = (user.points || 0) + amount; 

        if (gameId) {
            user.progress = user.progress || {};
            user.progress[gameId] = user.progress[gameId] || { total_points: 0 };
            user.progress[gameId].total_points = (user.progress[gameId].total_points || 0) + amount;
        }
        
        users[currentUser] = user;
        saveUsers(users);
        
        updateAuthenticationUI(); // UIæ›´æ–°
        displayRanking();         // ãƒ©ãƒ³ã‚­ãƒ³ã‚°ã®ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ æ›´æ–°
        
        console.log(`[ãƒã‚¤ãƒ³ãƒˆåŠ ç®—] ${currentUser}ã«${amount}ãƒã‚¤ãƒ³ãƒˆåŠ ç®—ã•ã‚Œã¾ã—ãŸã€‚åˆè¨ˆ: ${user.points}`);
        return true;
    };


    // --- ã‚»ãƒƒã‚·ãƒ§ãƒ³ç®¡ç† ---
    function setSession(gameName) {
        sessionStorage.setItem(SESSION_STORAGE_KEY, gameName);
        
        if (gameName !== GUEST_NAME) {
            let users = getUsers();
            let user = users[gameName];
            
            if (user) {
                user = updateStreak(user);
                users[gameName] = user;
                saveUsers(users);
            }
        }

        updateAuthenticationUI();
    }

    function logout() {
        sessionStorage.removeItem(SESSION_STORAGE_KEY);
        updateAuthenticationUI();
    }
    function playAsGuest() {
        setSession(GUEST_NAME);
    }


    // --- UIã®æ›´æ–° ---
    function updateAuthenticationUI() {
        const currentUser = sessionStorage.getItem(SESSION_STORAGE_KEY);
        const lang = getCurrentLang();
        const langData = translations[lang] || translations[LANG_DEFAULT];

        const isLoggedIn = !!currentUser;
        const isGuest = currentUser === GUEST_NAME;

        if (isLoggedIn && !isGuest) {
            const users = getUsers();
            const user = users[currentUser];
            
            if (!user) {
                 logout();
                 return;
            }

            const streak = user.streak || 0;
            const points = user.points || 0; 

            let streakText = langData['streak_text'].replace('%DAYS%', streak);
            let pointsText = langData['points_text'].replace('%POINTS%', points);
            
            userInfoEl.textContent = `${currentUser}${langData['status_welcome']}`;
            streakDisplayEl.textContent = streakText;
            pointsDisplayEl.textContent = pointsText;
            
            streakDisplayEl.style.display = 'block';
            pointsDisplayEl.style.display = 'block';

            loginBtn.style.display = 'none';
            signupBtn.style.display = 'none';
            guestBtn.style.display = 'none';
            logoutBtn.style.display = 'inline-block';
            
            initialMessageEl.style.display = 'none';
            mainMenuEl.classList.remove('locked');
        
        } else if (isGuest) {
            userInfoEl.textContent = langData['status_guest'];
            streakDisplayEl.style.display = 'none'; 
            pointsDisplayEl.style.display = 'none'; 

            loginBtn.style.display = 'none';
            signupBtn.style.display = 'none';
            guestBtn.style.display = 'none';
            logoutBtn.style.display = 'inline-block';

            initialMessageEl.style.display = 'none';
            mainMenuEl.classList.remove('locked');
            
        } else {
            userInfoEl.textContent = langData['auth_status_default'];
            streakDisplayEl.style.display = 'none';
            pointsDisplayEl.style.display = 'none';

            loginBtn.style.display = 'inline-block';
            signupBtn.style.display = 'inline-block';
            guestBtn.style.display = 'inline-block';
            logoutBtn.style.display = 'none';
            
            initialMessageEl.style.display = 'block';
            mainMenuEl.classList.add('locked');
        }
        
        // â˜… ãƒ©ãƒ³ã‚­ãƒ³ã‚°ã®è¡¨ç¤º/éè¡¨ç¤ºã¨æ›´æ–°ã‚’åˆ¶å¾¡
        if (isLoggedIn && !isGuest) {
            rankingContainer.style.display = 'block';
            displayRanking();
        } else {
            rankingContainer.style.display = 'none';
        }
    }

    // ============================================
    // â˜…â˜…â˜… ç¦æ­¢ãƒ¯ãƒ¼ãƒ‰ãƒªã‚¹ãƒˆã¨åˆ¤å®šé–¢æ•° (æ–°è¦è¿½åŠ ) â˜…â˜…â˜…
    // ============================================

    // (1) ç¦æ­¢ãƒ¯ãƒ¼ãƒ‰ãƒªã‚¹ãƒˆã®å®šç¾©ï¼ˆã™ã¹ã¦å°æ–‡å­—ã§å®šç¾©ã™ã‚‹ï¼‰
    const BANNED_WORDS = [
        // --- æ”»æ’ƒçš„ãªè¨€è‘‰ / ä¸‹å“ãªã‚¹ãƒ©ãƒ³ã‚° (Offensive / Vulgar) ---
        "kuso", "shinu", "kizu", "kusai", "hentai", "ero", "aho", "ahoka", 
        "bakayaro", "gomi", "kasu", "manuke", "busu", "chikan", "kimoi",
        "bitch", "fuck", "shit", "ass", "cunt", "penis", "vagina", "pussy", 
        "cock", "whore", "slut", "damn", "kill", "die", "nazi", "hitler", 
        "sex", "xxx", "porn", "rape", "nude", 

        // --- ã‚·ã‚¹ãƒ†ãƒ äºˆç´„èª / ç®¡ç†ç”¨ (Reserved / Admin) ---
        "admin", "administrator", "system", "mod", "guest", "root", "support", 
        "ç®¡ç†è€…", "ã‚·ã‚¹ãƒ†ãƒ ", 
        "admini", "systema", 
        
        // --- æ—¥æœ¬èªã®ä¸é©åˆ‡ãªè¨€è‘‰ (Japanese Inappropriate) ---
        "ã°ã‹", "ã‚ã»", "ãã", "ã—ã­", "ã†ã‚“ã“", "ãã‚‚ã„", "ã³ã‚“ã¼ã†", "ã’ã™ã¨",
        
        // --- ãã®ä»– (Other Inappropriate) ---
        "covid", "corona", 
        "virus", "drug", "weed", "alcohol", "drunk",
    ];

    /**
     * ã‚²ãƒ¼ãƒ åã«ç¦æ­¢ãƒ¯ãƒ¼ãƒ‰ãŒå«ã¾ã‚Œã¦ã„ãªã„ã‹ãƒã‚§ãƒƒã‚¯ã™ã‚‹
     * @param {string} name - ãƒã‚§ãƒƒã‚¯å¯¾è±¡ã®ã‚²ãƒ¼ãƒ å
     * @returns {string | null} - ç¦æ­¢ãƒ¯ãƒ¼ãƒ‰ãŒè¦‹ã¤ã‹ã£ãŸå ´åˆã¯ãã®ãƒ¯ãƒ¼ãƒ‰ã€è¦‹ã¤ã‹ã‚‰ãªã„å ´åˆã¯ null
     */
    function checkBannedWords(name) {
        if (!name) return null;
        
        // åˆ¤å®šã—ã‚„ã™ãã™ã‚‹ãŸã‚ã€å…¨è§’ã‚¹ãƒšãƒ¼ã‚¹é™¤å»ã€å°æ–‡å­—åŒ–ã€ã²ã‚‰ãŒãªåŒ–ã‚’è¡Œã†
        const normalizedName = name.trim()
                                   .toLowerCase()
                                   .replace(/[ï¼-ï¼™ï¼¡-ï¼ºï½-ï½š]/g, s => String.fromCharCode(s.charCodeAt(0) - 0xFEE0)) // å…¨è§’è‹±æ•°å­—ã‚’åŠè§’ã«
                                   .replace(/[ã€€\s]/g, ''); // ã‚¹ãƒšãƒ¼ã‚¹é™¤å»

        // ãƒªã‚¹ãƒˆå†…ã®å˜èªãŒå«ã¾ã‚Œã¦ã„ã‚‹ã‹ãƒã‚§ãƒƒã‚¯
        for (const word of BANNED_WORDS) {
            // ã‚«ã‚¿ã‚«ãƒŠãƒ»ã²ã‚‰ãŒãªå¤‰æ›ã‚’ç°¡æ˜“çš„ã«è¡Œã†ï¼ˆä¾‹: 'ï½±ï¾' -> 'ã‚ã»'ï¼‰
            let searchName = normalizedName;
            if (/[ã‚¡-ãƒ¶]/.test(word)) { // ã‚‚ã—ãƒªã‚¹ãƒˆã®ãƒ¯ãƒ¼ãƒ‰ãŒã‚«ã‚¿ã‚«ãƒŠã‚’å«ã‚“ã§ã„ãŸã‚‰ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼å…¥åŠ›ã‚‚ã‚«ã‚¿ã‚«ãƒŠã¨ã—ã¦å‡¦ç†ã™ã‚‹
                 // å®Ÿéš›ã«ã¯ã‚‚ã£ã¨è¤‡é›‘ãªå¤‰æ›ãŒå¿…è¦ã ãŒã€ã‚·ãƒ³ãƒ—ãƒ«ãªãƒã‚§ãƒƒã‚¯ã®ãŸã‚ã«å°æ–‡å­—åŒ–ã§å¯¾å¿œ
            }


            if (normalizedName.includes(word)) {
                return word; // è¦‹ã¤ã‹ã£ãŸç¦æ­¢ãƒ¯ãƒ¼ãƒ‰ã‚’è¿”ã™
            }
        }
        return null;
    }


    // ----------------------------------------------------
    // â˜…â˜…â˜… ãƒ©ãƒ³ã‚­ãƒ³ã‚°æ©Ÿèƒ½ (æœˆé–“ç´¯ç©ãƒ»æ¯æ—¥æ›´æ–°) â˜…â˜…â˜…
    // ----------------------------------------------------

    // æœˆãŒå¤‰ã‚ã£ãŸã‚‰ç´¯ç©ãƒã‚¤ãƒ³ãƒˆã‚’ãƒªã‚»ãƒƒãƒˆã™ã‚‹å‡¦ç† (æœˆé–“ãƒ©ãƒ³ã‚­ãƒ³ã‚°ã®ç¶­æŒ)
    function checkMonthlyReset() {
        const now = new Date();
        const currentYearMonth = now.getFullYear() + '-' + (now.getMonth() + 1);
        
        const lastResetDate = localStorage.getItem('last_ranking_reset');
        
        // å‰å›ã®ãƒã‚§ãƒƒã‚¯æ—¥ãŒä»Šæœˆã§ã¯ãªã„å ´åˆã€ãƒªã‚»ãƒƒãƒˆã‚’å®Ÿè¡Œ
        if (!lastResetDate || lastResetDate.split('-').slice(0, 2).join('-') !== currentYearMonth) {
            
            // å‰æœˆã‹ã‚‰ã®ãƒã‚¤ãƒ³ãƒˆç´¯ç©ã‚’ãƒªã‚»ãƒƒãƒˆ
            if (lastResetDate && new Date(lastResetDate).getMonth() !== now.getMonth()) {
                let users = getUsers();
                Object.keys(users).forEach(key => {
                    if (key !== GUEST_NAME) {
                        users[key].points = 0;         // ãƒã‚¤ãƒ³ãƒˆãƒªã‚»ãƒƒãƒˆ
                        users[key].progress = {};      // é€²æ—ãƒ‡ãƒ¼ã‚¿ã‚‚ãƒªã‚»ãƒƒãƒˆ
                    }
                });
                saveUsers(users);
                console.log(`[ãƒ©ãƒ³ã‚­ãƒ³ã‚°] æœˆãŒå¤‰ã‚ã£ãŸãŸã‚ã€å…¨ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ãƒã‚¤ãƒ³ãƒˆã‚’ãƒªã‚»ãƒƒãƒˆã—ã¾ã—ãŸã€‚æ–°æœˆ: ${currentYearMonth}`);
            }
            // æ–°ã—ã„ãƒªã‚»ãƒƒãƒˆæœˆã‚’ä¿å­˜
            localStorage.setItem('last_ranking_reset', now.toISOString().split('T')[0]);
        }
        
        if (sessionStorage.getItem(SESSION_STORAGE_KEY) && sessionStorage.getItem(SESSION_STORAGE_KEY) !== GUEST_NAME) {
             updateAuthenticationUI();
        }
    }
    
    // ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³èµ·å‹•æ™‚ã«ãƒªã‚»ãƒƒãƒˆãƒã‚§ãƒƒã‚¯ã‚’å®Ÿè¡Œ
    checkMonthlyReset();


    function displayRanking() {
        // ãƒã‚¤ãƒ³ãƒˆãŒåŠ ç®—ã•ã‚Œã‚‹ãŸã³ã«ã€ã‚½ãƒ¼ãƒˆã—ã¦è¡¨ç¤ºã—ç›´ã™ (ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ æ›´æ–°)
        
        const usersJson = localStorage.getItem(USER_STORAGE_KEY);
        if (!usersJson) return;

        const users = JSON.parse(usersJson);
        
        const sortedUsers = Object.keys(users).map(key => {
            return { name: key, points: users[key].points || 0 };
        })
        .filter(u => u.points > 0) 
        .sort((a, b) => b.points - a.points); 

        const top5 = sortedUsers.slice(0, 5);

        rankingList.innerHTML = '';
        top5.forEach((u, index) => {
            const li = document.createElement('li');
            let rankIcon = `${index + 1}. `;
            if (index === 0) rankIcon = 'ğŸ¥‡ ';
            if (index === 1) rankIcon = 'ğŸ¥ˆ ';
            if (index === 2) rankIcon = 'ğŸ¥‰ ';
            
            li.textContent = `${rankIcon}${u.name} : ${u.points} pt`;
            rankingList.appendChild(li);
        });
        
        if (top5.length === 0 || top5[0].points === 0) {
            const li = document.createElement('li');
            li.textContent = "ã¾ã  ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“";
            rankingList.appendChild(li);
        }
    }


    // ----------------------------------------------------
    // --- èªè¨¼ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ (æ—¢å­˜ + ç¦æ­¢ãƒ¯ãƒ¼ãƒ‰ãƒã‚§ãƒƒã‚¯) ---
    // ----------------------------------------------------
    document.getElementById('signup-submit-btn').addEventListener('click', (e) => {
        e.preventDefault();
        const gamenameInput = document.getElementById('signup-gamename');
        const passwordInput = document.getElementById('signup-password');
        const messageEl = document.getElementById('signup-message');

        const gamename = gamenameInput.value.trim();
        const password = passwordInput.value;
        const lang = getCurrentLang();
        const langData = translations[lang] || translations[LANG_DEFAULT];

        if (!gamename || !password) {
            messageEl.textContent = 'ã‚²ãƒ¼ãƒ åã¨ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã¯å¿…é ˆã§ã™ã€‚';
            return;
        }
        if (gamename === GUEST_NAME) {
            messageEl.textContent = 'ãã®ã‚²ãƒ¼ãƒ åã¯äºˆç´„ã•ã‚Œã¦ã„ã¾ã™ã€‚';
            return;
        }

        // â˜…â˜…â˜… ç¦æ­¢ãƒ¯ãƒ¼ãƒ‰ãƒã‚§ãƒƒã‚¯ã®å®Ÿè¡Œ â˜…â˜…â˜…
        const bannedWordFound = checkBannedWords(gamename);
        if (bannedWordFound) {
            messageEl.textContent = `ä¸é©åˆ‡ãªã‚²ãƒ¼ãƒ åã§ã™ã€‚ã€Œ${bannedWordFound}ã€ã«é–¢é€£ã™ã‚‹è¨€è‘‰ã¯ä½¿ãˆã¾ã›ã‚“ã€‚`;
            return;
        }
        // â˜…â˜…â˜…â˜…â˜…â˜…â˜…â˜…â˜…â˜…â˜…â˜…â˜…â˜…â˜…â˜…â˜…â˜…â˜…â˜…â˜…â˜…â˜…

        const users = getUsers();
        if (users[gamename]) {
            messageEl.textContent = 'ã“ã®ã‚²ãƒ¼ãƒ åã¯ã™ã§ã«ä½¿ç”¨ã•ã‚Œã¦ã„ã¾ã™ã€‚';
            return;
        }

        users[gamename] = { 
            password: password, 
            name: gamename,
            streak: 0, 
            last_login: null,
            points: 0, 
            progress: {} 
        };
        saveUsers(users);

        setSession(gamename);
        modalOverlay.style.display = 'none';
        messageEl.textContent = '';
        gamenameInput.value = '';
        passwordInput.value = '';
    });

    document.getElementById('login-submit-btn').addEventListener('click', (e) => {
        e.preventDefault();
        const gamenameInput = document.getElementById('login-gamename');
        const passwordInput = document.getElementById('login-password');
        const messageEl = document.getElementById('login-message');

        const gamename = gamenameInput.value.trim();
        const password = passwordInput.value;
        const lang = getCurrentLang();
        const langData = translations[lang] || translations[LANG_DEFAULT];

        const users = getUsers();
        const user = users[gamename];

        if (user && user.password === password) {
            setSession(gamename);
            modalOverlay.style.display = 'none';
            messageEl.textContent = '';
            gamenameInput.value = '';
            passwordInput.value = '';
        } else {
            messageEl.textContent = langData['msg_login_fail'] || 'ã‚²ãƒ¼ãƒ åã¾ãŸã¯ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãŒé•ã„ã¾ã™ã€‚'; 
        }
    });

    loginBtn.addEventListener('click', () => {
        loginView.style.display = 'block';
        signupView.style.display = 'none';
        modalOverlay.style.display = 'flex';
        document.getElementById('login-message').textContent = '';
        document.getElementById('signup-message').textContent = '';
    });

    signupBtn.addEventListener('click', () => {
        loginView.style.display = 'none';
        signupView.style.display = 'block';
        modalOverlay.style.display = 'flex';
        document.getElementById('login-message').textContent = '';
        document.getElementById('signup-message').textContent = '';
    });

    guestBtn.addEventListener('click', playAsGuest);
    logoutBtn.addEventListener('click', logout);

    modalOverlay.querySelectorAll('.btn-close').forEach(button => {
        button.addEventListener('click', () => {
            modalOverlay.style.display = 'none';
            document.getElementById('login-message').textContent = '';
            document.getElementById('signup-message').textContent = '';
        });
    });

    document.addEventListener('DOMContentLoaded', () => {
        const savedLang = localStorage.getItem('preferredLang') || LANG_DEFAULT;
        setLanguage(savedLang); 
    });
</script>